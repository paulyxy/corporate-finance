.allChapters<-function(){
"
 *-----------------------------------------------------*
 * Corporate Finance                                   *
 *-----------------------------------------------------*
 * .c1  Introduction                                   *
 * .c2  Present value                                  *
 * .c3  Stock & Bond valuation: Annuities/perpetuities *
 * .c4  Capital budgeting                              *
 * .c5  Interest rate and yield curve                  *
 * .c6  Uncertainty, default and risk                  *
 * .c7  A first look at investments                    *
 * .c8  Investor choice: Risk and Reward               *
 * .c9  Benchmarked cost of capital                    *
 * .c10 Capital Assett Pricing Model                   *
 * .c11 Market imperfections                           *
 * .c12 Perfect/Efficient Market, Behavioral finance   *
 * .c14 Financial Statements/cash flows                *
 * .c15 Ratio Analysis for Financial Statements        *
 *-----------------------------------------------------*

";.allChapters_()}

.allChapters_<-function(){
cat("
 *-----------------------------------------------------*
 * Corporate Finance                                   *
 *-----------------------------------------------------*
 * .c1  Introduction                                   *
 * .c2  Present value                                  *
 * .c3  Stock & Bond valuation: Annuities/perpetuities *
 * .c4  Capital budgeting                              *
 * .c5  Interest rate and yield curve                  *
 * .c6  Uncertainty, default and risk                  *
 * .c7  A first look at investments                    *
 * .c8  Investor choice: Risk and Reward               *
 * .c9  Benchmarked cost of capital                    *
 * .c10 Capital Assett Pricing Model                   *
 * .c11 Market imperfections                           *
 * .c12 Perfect/Efficient Market, Behavioral finance   *
 * .c14 Financial Statements/cash flows                *
 * .c15 Ratio Analysis for Financial Statements        *
 *-----------------------------------------------------*

")}

.all<-.allChapters

.asscii2chr <- function(n) {
 rawToChar(as.raw(n)) 
}

.ASSCII2chr<-.asscii2chr

.benford<-function(x,alpha=0.05){
"Objective: test if the first digits follow the Benford Law. 
    x     : a data set.  H0: data follow the Benford Law 

 Example 1: > load(url('http://datayyy.com/data_R/benford.RData'))
            > head(.x)
             [1]  1927.48 27902.31 86241.90 72117.46 81321.75 97473.96
            > .benford(.x)
               Chisq statistic= 108.1071 > 15.50731  = critical value, we conclude: 
               The data don't follow the Benford Law

 Example 2: Go to http://finance.yahoo.com and copy WMT's balance sheet 
            > .finS2num()
                Your data is saved as .x  
            > .benford(.x)
               Chisq statistic= 1.722566 < 15.50731  = critical value, we conclude: 
               The data follow the Benford Law

 Example 3:> .getBS10('ibm')
              # Balance Sheet for  IBM 
              # Launch Excel and paste
           > .copy2dotx()
              # Data saved at   .x     
           > .benford(.x)
              Chisq statistic= 1.754895 < 15.50731  = critical value, we conclude: 
              The data follow the Benford Law

";.benford_(x,alpha)} 

.benford_<-function(x,alpha){
   a<-1:9
   b<-log10((a+1)/a)
   benford<-data.frame(a,b)
   colnames(benford)<-c("DIGIT","BENFORD")

   a<-as.matrix(x)
   b<-c(a)
   g<-substr(b,1,1)
   h<-g[grep('[1-9]',g)]


   firstDigit<-substr(h,1,1)
   b<-table(firstDigit)
   d<-data.frame(b)
   d2<-data.frame(d[,1],d[,2]/sum(d[,2]))
   colnames(d2)<-c("DIGIT","MyFreq")

   final<-merge(benford,d2,all=T)
   final[is.na(final)]<-0
   dev<-(final$MyFreq-final$BENFORD)/final$BENFORD
   s<-sum(dev^2)
   chisqCritical<-qchisq(1-alpha,8)
   if(s>chisqCritical){
       cat("    Chisq statistic=",s,">",chisqCritical," = critical value, we conclude: \n    The data don't follow the Benford Law\n")
   }else{
       cat("    Chisq statistic=",s,"<",chisqCritical," = critical value, we conclude: \n    The data follow the Benford Law\n")   }
} 












.calendar<-function(){
"           Jan  2023               April 2023               July 2023
   Su Mo Tu We Th Fr Sa     Su Mo Tu We Th Fr Sa    Su Mo Tu We Th Fr Sa
    1  2  3  4  5  6  7      2  3  4  5  6  7  8                      1
    8  9 10 11 12 13 14      9 10 11 12 13 14 15    2  3  4  5  6  7  8
   15 16 17 18 19 20 21     16 17 18 19 20 21 22    9 10 11 12 13 14 15
   22 23 24 25 26 27 28     23 24 25 26 27 28 29   16 17 18 19 20 21 22
   29 30 31                 30                     23 24 25 26 27 28 29
                                                   30 31 
         Feb. 2023                 May 2023               August 2023
   Su Mo Tu We Th Fr Sa     Su Mo Tu We Th Fr Sa    Su Mo Tu We Th Fr Sa
             1  2  3  4         1  2  3  4  5  6           1  2  3 4   5 
    5  6  7  8  9 10 11      7  8  9 10 11 12 13     6  7  8  9 10 11 12 
   12 13 14 15 16 17 18     14 15 16 17 18 19 20    13 14 15 16 17 18 19 
   19 20 21 22 23 24 25     21 22 23 24 25 26 27    20 21 22 23 24 25 26
   26 27 28                 28 29 30 31             27 28 29 30 31 

      March 2023               June 2023              Step 2023
   Su Mo Tu We Th Fr Sa     Su Mo Tu We Th Fr Sa    Su Mo Tu We Th Fr Sa
             1  2  3  4                  1  2  3                    1  2 
    5  6  7  8  9 10 11     4   5  6  7  8  9 10     3  4  5  6  7  8  9
   12 13 14 15 16 17 18    11  12 13 14 15 16 17    10 11 12 13 14 15 16 
   19 20 21 22 23 24 25    18  19 20 21 22 23 24    17 18 19 20 21 22 23 
   26 27 28 29 30 31  1    25  26 27 28 29 30       24 25 26 27 28 29 30

";.calendar_()}

.calendar_<-function(){
cat(
"
           Jan  2023               April 2023               July 2023
   Su Mo Tu We Th Fr Sa     Su Mo Tu We Th Fr Sa    Su Mo Tu We Th Fr Sa
    1  2  3  4  5  6  7      2  3  4  5  6  7  8                      1
    8  9 10 11 12 13 14      9 10 11 12 13 14 15    2  3  4  5  6  7  8
   15 16 17 18 19 20 21     16 17 18 19 20 21 22    9 10 11 12 13 14 15
   22 23 24 25 26 27 28     23 24 25 26 27 28 29   16 17 18 19 20 21 22
   29 30 31                 30                     23 24 25 26 27 28 29
                                                   30 31 
         Feb. 2023                 May 2023               August 2023
   Su Mo Tu We Th Fr Sa     Su Mo Tu We Th Fr Sa    Su Mo Tu We Th Fr Sa
             1  2  3  4         1  2  3  4  5  6           1  2  3 4   5 
    5  6  7  8  9 10 11      7  8  9 10 11 12 13     6  7  8  9 10 11 12 
   12 13 14 15 16 17 18     14 15 16 17 18 19 20    13 14 15 16 17 18 19 
   19 20 21 22 23 24 25     21 22 23 24 25 26 27    20 21 22 23 24 25 26
   26 27 28                 28 29 30 31             27 28 29 30 31 

      March 2023               June 2023              Step 2023
   Su Mo Tu We Th Fr Sa     Su Mo Tu We Th Fr Sa    Su Mo Tu We Th Fr Sa
             1  2  3  4                  1  2  3                    1  2 
    5  6  7  8  9 10 11     4   5  6  7  8  9 10     3  4  5  6  7  8  9
   12 13 14 15 16 17 18    11  12 13 14 15 16 17    10 11 12 13 14 15 16 
   19 20 21 22 23 24 25    18  19 20 21 22 23 24    17 18 19 20 21 22 23 
   26 27 28 29 30 31  1    25  26 27 28 29 30       24 25 26 27 28 29 30

")}

.cal<-.calendar 

.clipr_installation<-function(){
"
  We need the 'clipr' R package for using the .usGDPquarterly and
       the  .data2excel functions (for both Mac and Windows users).
       To install the package, we have the following two ways. 

Method I:
---------
        Just issue the following line to install it
           install.packages('clipr')

Method II:
----------
         Click 'Packages' on the menu bar
              --> Install packages ...
              --> [choose a location] 
              --> [choose 'clipr' from the list]
      
";.clipr_installation_()}

.clipr<<-.clipr_installation

.clipr_installation_<-function(){
cat("
  We need the 'clipr' R package for using the .usGDPquarterly and
       the  .data2excel functions (for both Mac and Windows users).
       To install the package, we have the following two ways. 

Method I:
---------
        Just issue the following line to install it
           install.packages('clipr')

Method II:
----------
         Click 'Packages' on the menu bar
              --> Install packages ...
              --> [choose a location] 
              --> [choose 'clipr' from the list]
")}

.cls<-function(){
"Objective: clear R consol
   Input  : none
   Example:
            >.cls()




";.cls_()}

.cls_<-function() cat(rep("\n",50))

.currentEvents<-function(i){
"Objective: 

 i    Date       Description                      Type    Others
---   -------    ---------------               -----   ------------
 1   1/7/2022    Strong Dollar Index           video   (t3:42) 
 2   1/25/2022   Bond yields                   video   (t5:16)
 3   1/11/2022   Stocks vs. Fixed Income       video   (t1:1)
 4   1/23/2022   Biden economy-past,yet 2 come video   (t5:24) 
 5   1/27/2022   Fed Chair Powell 'has to walk video   (t7:33)
 6   1/26/2022   Powell                        video   (t1:01)

";.zcurrentEvents(keyword_or_ID)}

.currentEvent<<-.currentEvents

.zcurentEvents<-function(name){

}

.data2excel<-function(keyword_or_ID){
"Objective      : keyword or ID
   keyword_or_ID: such as 'c1_', 'c5_', 12, 44
                  Note: assume that the 'clipr' package is installed. 
                  install.packages('clipr')
          
 Example 1>.data2excel('c1_') # all images for chapter 1
              ID            NAME
            1  6 c1_place_holder
            2 28 data_c1_c16    
 
 Example 2>.d1('c1_')   # the same as the above 

 Example 3>.d1('c3_')   # for chapter 3
 
 Example 4>.d1('gdp)    # search by a keyword
              ID            NAME
            1 17 c4_GDPquarterly

 Example 5>.d1(17)      # get the data to Excel 
         For both Windows and Mac users:
             Launch Excel and paste! 

";.zdata2excel_(keyword_or_ID)}

.data2Excel<<-.data2excel
.d1<<-.data2excel


.zdata2excel_<-function(name){
     .path3<-"http://datayyy.com/if/data/"
     if(exists('.ifData')==FALSE){
          .tempPath<-paste0(.path3,"ifData",".RData")
          .ifData<<-get(load(url(.tempPath)))
     }

     if(typeof(name)=="character"){
          name<-toupper(name)
          out<-.ifData[grep(name,toupper(.ifData$NAME)),]
          rownames(out)<-NULL
          print(.leftAdj(out))
          
    }else{
         name2<-.ifData$NAME[name]
         infile<-paste0(.path3,name2,".csv")
         .x<-read.csv(infile)
         .write_clip(.x)
         cat("  For both Windows and Mac users:\n")
         cat("      Launch Excel and paste! \n")
    }
}
.data2excel_Mac<-function(keyword_or_ID){
"Objective      : keyword or ID
   keyword_or_ID: such as 'c1_', 'c5_', 12, 44
                  Note: assume that the 'clipr' package is installed. 
                  install.packages('clipr')
          
 Example 1>.data2excelMac('c1_') # all images for chapter 1
 
 Example 2>.d3('c1_')            # the same as the above
 
 Example 3>.d3(10)               # getting data to Excel

";.zdata2excel_Mac_(keyword_or_ID)}

.d3<<-.data2excel_Mac
.data2Excel_Mac<-.data2excel_Mac

.zdata2excel_Mac_<-function(name){
     .path3<-"http://datayyy.com/if/data/"
     if(exists('.ifData')==FALSE){
          .tempPath<-paste0(.path3,"ifData",".RData")
          .ifData<<-get(load(url(.tempPath)))
     }

     if(typeof(name)=="character"){
          name<-toupper(name)
          out<-.ifData[grep(name,toupper(.ifData$NAME)),]
          rownames(out)<-NULL
          print(.leftAdj(out))
          
    }else{
         name2<-.ifData$NAME[name]
         infile<-paste0(.path3,name2,".csv")
         .x<-read.csv(infile)
         .write_clip(.x)

         cat("  For Mac users:\n")
         cat("      Launch Excel and paste! \n")
    }
}


.data2excel_Windows<-function(keyword_or_ID){
"Objective      : keyword or ID
   keyword_or_ID: such as 'c1_', 'c5_', 12, 44
                  Note: assume that the 'clipr' package is installed. 
                  install.packages('clipr')
          
 Example 1>.data2excel_Windows('c1_') # all images for chapter 1
 
 Example 2>.d2('c1_')   # same as the above 
 
 Example 3>.d3('GDP')

";.zdata2excel_Windows_(keyword_or_ID)}

.d2<<-.data2excel_Windows
.data2Excel_Windows<<-.data2excel_Windows

.zdata2excel_Windows_<-function(name){
     .path3<-"http://datayyy.com/if/data/"
     if(exists('.ifData')==FALSE){
          .tempPath<-paste0(.path3,"ifData",".RData")
          .ifData<<-get(load(url(.tempPath)))
     }

     if(typeof(name)=="character"){
          name<-toupper(name)
          out<-.ifData[grep(name,toupper(.ifData$NAME)),]
          rownames(out)<-NULL
          print(.leftAdj(out))
          
    }else{
         name2<-.ifData$NAME[name]
         infile<-paste0(.path3,name2,".csv")
         .x<-read.csv(infile)
         .write_clip(.x)
         cat("  For both Windows and Mac users:\n")
         cat("      Launch Excel and paste! \n")
    }
}


.datacases<-function(i){
"Objective: show assigned HW or data cases 

  i  chapter  Explanation 
  -- -------  ----------
  0    all    Instructions
  1     2     NPV and Effective Rate  

 Example > .datacase(1)   # for the first data case 

";.zdatacases(i)}

.zdatacases<-function(i){
    if(i<=.whichDatacase){
       .x<-paste('cat(.dc',i,')',sep='')
       .runText(.x)
    }else{
      cat("Your request is not available\n")
    }
}

.dd<<-.datacases
.homework<<-.datacases
.hw<<-.datacases

.nDataCases<-1

.dc0<-"Instructions
///////////////////////////////////

 1) You can do your HW (data case) solo or form a
    small group (maximum 3 members)

 2) Before the deadline of each assignment, submit an 
    Excel file to the submission folder on Canvas. 

 3) Please write down the names of your group members on 
    the first page (worksheet) of your Excel file.

 4) For each question, use one spread sheet.
    For example, the first assignment has 4 questions. 
    Hence, submit one Excel file with 4 worksheets. 

 5) For each group, please make just one submission.

///////////////////////////////////
"

# https://paulyxy-conversions-between-apr-annual-percentage-ra-app-pyksxb.streamlit.app/


.dc1<-"Data case/HW #1
///////////////////////////////////

Q1: Q2.62 (p28) https://book.ivo-welch.info/read/source5.mba/02-npv.pdf    
    Using three methods
    a) apply the function: pv=fv/(1+R)^n
    b) apply the Excel function: =pv()
    c) apply the Excel function: =npv()

Q2: Q2.63 (p28)  https://book.ivo-welch.info/read/source5.mba/02-npv.pdf    

Q3: If the bank quotes a loan APR (Annual Percentage Rate) rate of 3%,
    compounded quarterly, what do you have to pay back in one year if 
    you borrow $500 from the bank?

Q4: APR (annual percentage rate) is 5%, compounded monthly.
    a) What is the equivalent EAR (Effective Annual Rate)?
    b) What is the equivalent effective quarterly rate?

////////////////////////////////
"

.dc2<-"Data case/HW #2
///////////////////////////////////

Q1: John Doe plans to buy a house in Rochester. If the price of the house 
     is $200,000 and the down payment is 20% of the price. Assume the 
      loan term is 15 years and the APR is 6.5% compounded monthly. 
      What is his monthly payment?

Q2: For the following cash flows
0,-100
1,-51
2,50
3,75
4,50
5,45
     a) Calculate the project's NPV (assume the annual discount rate is 11%).
     b) Calculate the project's IRR.
     c) Calculate its payback period.
     d) Based on NPV and IRR rules, should we accept or reject the project?

Q3: Q4.41,page 22, 
     https://book.ivo-welch.info/read/source5.mba/04-capbudg.pdf  
  
Q4: Q4.44 page 22, 
     https://book.ivo-welch.info/read/source5.mba/04-capbudg.pdf

////////////////////////////////
"


.dc33<-"Datacase #4 (Chapter 4: A First Encounter with Capital-Budgeting Rules)
////////////////////////////////
  Q1: On page 73, Q4.41 
 
  Q2: On page 73, Q4.42
  
  Q3: On page 74, Q4.44 
        Assume R=0.1. Calculate both  normal payback period and 
                      discounted payback period

  #4: On page 74, Q4.45
       Note: to get the chapter, issue the following code. 
   
    > .dc(4)
        The file called  chap04.pdf      was downloaded 
        and it is saved under  c:/temp/ 
   or
       http://book.ivo-welch.info/read/source.mba/chap04.pdf

   http://datayyy.com/doc_word/fin508datacase4f2019.docx

////////////////////////////////
"



.dc5<-"Data case #1: A real estate agent's tool
////////////////////////////////
  Task #1 (spreadsheet 1):
          John walked into your office asking for $300,000 to buy a house. 
          Your decision: accept or reject. 
  Task #2: (spreadsheet 2):
           If a person borrows $300,000, what is the monthly payment for a 
           30-year mortgage?  If transaction cost (closing cost) is $1770, 
           what it the true annual cost (APR)?
  Task #3: (spreadsheet 3):
            Generate an amortization table to show the client his/her annual 
            total interest payments. 
  More detail: 
       Task #1: 
           a) input area: name, home address, email address, telephone number, annual 
              income, other income, , how much to borrow, how much is the down payment,
              how many years to borrow, # of family members, saving, other debt, other 
              assets such as a house that could be used as a collateral, credit rating, etc.
          b)  estimate monthly cash available for a mortgage payment
              estimate how much (total loan) the person could support
          c) compare with what he/she wants to borrow and make your decision
         	=if(ability>asked, \"accept\",\"reject\")
       Task #2:
          a)  Input area: total price of the house, down payment (or % of down 
              payment), number of years, transaction cost, point (will be explained 
              in class), mortgage rates for 10, 15, 30 years
          b)  Estimate monthly payment first. Then factor in transaction cost 
              to get the true rate. 

              Note: in the above examples, $300,000, 30 years, etc. are used as an
              illustration.  A client might choose a different set of values. 

    A companionining Excel file:
             http://datayyy.com/data_excel/fin508datacase1.xlsx
                or 
             http://canisius.edu/~yany/data_excel/fin508datacase1.xlsx
    Submit an Excel file to the dropbox on the D2L
////////////////////////////////
"


.dc42<-"Data case #2: Financial Statement Analysis
////////////////////////////////
 Step #1 Download the leatest sveral years' Balance Sheet and Income Statements
          for the following companies
          Company name	                ticker
          ---------------------         -----
         International Business Machine	IBM
         Microsoft                      MSFT
         Wal-Mart                       WMT
         Johnson & Johnson              JNJ

 Step #2: Generate their Common-size Statements
 Step #3: Calculate the following financial ratios
		Current Ratio, 
		Debt/Equity Ratio
		ROA
		ROE 
 Step #4: Estimate the DuPont identity
 Step #5: Comment on your results
          Note #1: Source: Yahoo!finance  finance.yahoo.com
                   Retrieve financial statement from Yahoo!Finance 
                     a)  Go to http://finance.yahoo.com/
                     b) Enter ticker
                     c) Click Balance sheet or income statement from the left-hand side 
         Note #2: Submit an Excel to the dropbox on D2L
         Note #3: name of your file: firstName_lastName.xlsx

         http://datayyy.com/doc_pdf/fin508datacase2.pdf
             or
         http://canisius.edu/~yany/doc_pdf/fin508datacase2.pdf
    Submit an Excel file to the dropbox on the D2L
////////////////////////////////
"


.dc3<-"Data Case #3: 
////////////////////////////////

 Q1: What is the selling price for the following bond. 
     The bond will mature in 10 years with an 8% annual coupon rate. 
     The coupon payments will be distributed twice per year. 
     The discount rate is 12% and the face value is $1,000.
      a) method I: summation of all present values
      b) method II: apply a formula

 Q2: What is the duration of the above bond?
     Using at least two methods. 

 Q3: If the government increases the federal fund rate, then investors
     will demand a higher YTM (return). Assume that the YTM jumps to 13.5%.
     What is the impact on the price of the above bond?
       a) in terms of dollar amount (gain or loss)
       b) percentage gain or loss
 
////////////////////////////////
"



.dc33<-"Data Case #3: Fund raised from a new bond issue 
////////////////////////////////
 Currently, you are working as a financial analyst. You company plans to 
     issue 30-year corporate bonds with a total face value of $45 million in the US. 
     Each bond has a face value of $1,000. The annual coupon rate is 3.5%. The firm 
     plans to pay coupon once every year at the end of each year. Your boss asked 
     you to estimate how much fund the firm could raise today. 

     Basic concepts: 1) price is the summation of all its discounted future cash flows. 
                            C          C                     C + FV
         PV(bond)=price=   ------  + --------  + .....   +  ---------      (1)  
                          (1+R1)^1   (1+R2)^2                (1+Rn)^n
    2) find out the appropriate discount rate for each future cash flow. 
                            Ri=Rf(i)+Si                                     (2)
       where Ri is the discount rate for year i,Rfi is the risk-free rate at year i, 
       from the Government Treasury term structure of interest (yield curve) 
       for year i and Si the credit spread which depends on the credit raging 
       of your firm. For example, if an investor buys one bond, he/she will 
       expect $35 at the end of each year for the next 30 years. The present value of 
       $35 at the end of 5th year will be 35/(1+R_5)^5 . Note that all those discount 
       rates (R1, R2, R3 and etc.) are expected to be different. 

   Step 1: Draw a time line of 30 years and mark all future cash flows. 
              Hint #1: to simplify your notation, you could work with just one bond ($1,000 face value) first. 

   Step 2: Find Rf,i for i=1,2,3, .. 30. Go to http://finance.yahoo.com/bonds 
              (hint #2: you have to interpolate your values, see next page)
   Step 3: Find the relationship between spread (Si ) and the credit rating, i=1,2, ..., 30. 
             .showCreditSpread   
             Alternatively, download at http://datayyy.com/data_csv/creditSpread.csv

   Step 4: Find the credit rating of your company. For this data case, just assume that it is AA. 
   Step 5: Apply the following formula to estimate the present value of each future cash flow. 
                              Ci
                 pv(i)=      --------                                  (3)
                             (1+Ri)^i
    Step 6: Apply equation (1), i.e., take a summation. 
    Answer the following three questions:
        Q1: How much your company would receive today by issuing the above 30-year bonds?
        Q2: What is the YTM (Yield to Maturity) of the bond?
        Q3: How much extra money your company could receive if your company manages to 
            increase its credit rating by one notch?
////////////////////////////////
"

#http://datayyy.com/doc_pdf/fin508datacase3.pdf

.dc5<-"Event Study using Excel 
//////////////////////////////////////
 Based on Event Study, we test the impact of HSIC added to the S&P500 on March 18, 2015. 
 Source of data: http://canisius.edu/~yany/excel/eventStudy.xlsx
 The basic idea for Event Study is to test whether our AR (Abnormal Return) is 
     statistically significant. The definition of abnormal return is given below. 
           AP = realized return  - expected return        (1)
  To estimate our expected return, we apply the following linear regression. 
	y = alpha + beta* x                           (2)
   where, y is the expected return and x is the market return on that day. 
      To estimate two parameters, alpha and beta, we run a linear regression or apply 
      related formulae by choosing an evaluation period of 252-day long, 
      starting the day before our event window counting backward, see below. 
             Estimation period                          Event-window
    |-------------------------------|-------------|----------|
	                   n days before      event-day   m-day after
 Here is the design. 
     i) The event day is 3/18/2015			
    ii) Our event window: 10 days before and 10 days after			
   iii) The estimation period: from 253 days before to one-day before our event window

   Step 1: download daily price data from HSIC and S&P500 (^GSPC). 
   Step 2: Choose only adjusted price, see the left panel below.
             Then sort data from oldest to the latest, see the right panel below. 			
   Step 3: estimate daily returns, see the formula in D3.  				
   Step 4: Highlight our event day, a window around the event and the estimation period 
             For example, we could use red color for event day, 10-day before and 
             10-day after our event day. In addition, we could highlight our 
             estimation period green. 
   Step 5: Based on the estimation period, apply following formulae to estimate 
             intercept, slope, R2 and standard error				
             assume B column is for stock returns, C column is S&P500 returns
	    i) intercept      =intercept(B,C)
           ii) slope          =slope    (B,C)
          iii) R2             =rsq      (B,C)
           iv) standard error =steyx    (B,C)
   Step 6: Estimate, expected return, AR (abnormal return), 
            CAP (cumulative abnormal return) and T-AP (T-value for abnormal return)				
         Expected return            AP      CAR     T-value for AR
	  --------------            --      ---     --------------
	Expected return                        = intercept + slope * market			
	AR (abnormal return)                   = realized return - expected return			
	CAR (cumulative abnormal return)       = sum of all ARs up to today			
	T-value for AR                         = AR/standard error			
   Note: to make our spread sheet clean, we have two choices:
 	i) Hide many rows			
	ii) Copy above four output values to a place near our event window			
   Comment on your results. 			
//////////////////////////////////////
"

.dc6<-"add later 
////////////////////////////////

////////////////////////////////
"




.dataSearch<-function(chapterOrName){
"Objective: find the numbers for data set given a chapter
   chapterOrName: integer or a name 
                 A list of all data sets (add later)

 Example #1: > .dataSearch(1)    # for chapter 1
    
      
";.dataSearch_(chapterOrName)
}

.dataSearch_<-function(chapterOrName){
   if(exists('.chapterDataIDname')==FALSE){
       .tempPath<-paste(..path2,"RData/chapterDataIDname",".RData",sep='')
        load(url(.tempPath))
       .chapterDataIDname<<-.x
   }
   if(typeof(chapterOrName)=="double"){
       .n<-chapterOrName
       if(.n<1 | .n >19){
          cat("  Error message: chapter should be between 1 and 21 \n")
       }else{
          .z<-.chapterDataIDname[.chapterDataIDname$CHAPTER==.n,]
          .z2<-format(.z, justify = "left")
          rownames(.z2)<-NULL
          print(.z2)
        }
    }else{
       #.a<-paste("^",toupper(chapterOrName),sep='')
       .a<-paste(toupper(chapterOrName),sep='')
      .b<-toupper(.chapterDataIDname$NAME)
      .z<-.chapterDataIDname[grep(.a,.b),]
      .z2<-format(.z, justify = "left")
      rownames(.z2)<-NULL
      print(.z2)
   }
}




.download<-function(i){
"Objective: download a file to the current directory 
       i  : an integer

 Example #1: > .search('ff3m')
              DIR            NAME
     17  data_csv   ff3Monthly.csv 
     47  data_excel ff3Monthly.xlsx
     226 data_txt   ff3Monthly.txt 
             > .download(17)
            # File/data set called  ff3Monthly.csv  was successfully downloaded 
            # Your saved file/data is ==>c:/temp/tt/ff3Monthly.csv  

";.download_(i)}

.download_<-function(i){
     .outPath<-getwd()

     .path3<-"http://datayyy.com/cfe/"
     if(exists('.data508')==FALSE){
          .tempPath<-paste(.path3,"data508",".RData",sep='')
           load(url(.tempPath))
           #load(.tempPath)
          .data508<<-.x
      }
     .path0<-"http://datayyy.com/"
     .n<-nrow(.data508)
      if(i<1 | i >.n){
           cat("  Error message: input integer should be between 1 and ",.n,"\n")
      }else{
          .image=0    # for data  =1 for images 
          dir2<-as.character(.data508[i,1])
          name<-as.character(.data508[i,2])
          .infile<-paste0(.path0,dir2,"/",name)
          .outfile<-paste0(.outPath,"/",name)
          if(length(grep('IMAGES',toupper(dir2)))>0){
               .image=1
          }else if(length(grep('DOC',toupper(dir2)))>0){
               .image=1
          }else if(length(grep('EXE',toupper(dir2)))>0){
               .image=1
          }
          # note for CSV file is not use mode='wb', extra lines occur
          download.file(.infile, .outfile,quiet = TRUE,mode='wb')
          cat("   # File/data set called ",name, " was successfully downloaded","\n")
          .z<-paste("# Your saved file/data is ==>",.outfile,sep="")
          cat("  ",.z, "\n")
       }
}


.download<-function(i){
"Objective: download a data data set  
       i  : an integer

   i   Data set              i   Data set 
  --   -----------          --   -----------
   1   ct1day.csv            13  CD.BIN
   2   cq1day.csv            14  CQ.BIN
   3   ct3month.csv          15  CT.BIN
   4   cq3month.csv          16  SUD.BIN
   5   DTAQtrade50.csv       17  SUMDAT.BIN
   6   DTAQquote50.csv       

   7   ct1day.RData
   8   cq1day.RData
   9   ct3month.RData
  10   cq3month.RData
  11   DTAQtrade50.RData
  12   DTAQquote50.RData

 Example #1:
             setwd('c:/temp')
             .download(1)

";.download_(i)}

.download_<-function(i){
   .path3<-"http://datayyy.com/getfile/R/"
   if(exists('.dataIDnameTAQ')==FALSE){
       .tempPath<-paste(.path3,"dataIDnameTAQ",".RData",sep='')
        load(url(.tempPath))
        #load(.tempPath)
       .dataIDnameTAQ<<-.x
   }

   .path0<-"http://datayyy.com/"
   .n<-nrow(.dataIDname22)
    if(i<1 | i >.n){
          cat("  Error message: input integer should be between 1 and ",.n,"\n")
    }else{
       .image=0    # for data  =1 for images 
       dir2<-as.character(.dataIDname22[i,1])
       name<-as.character(.dataIDname22[i,2])

      .infile<-paste0(.path0,dir2,"/",name)
      .outPath<-getwd()
      .outfile<-paste0(.outPath,"/",name)

       if(length(grep('IMAGES',toupper(dir2)))>0){
            .image=1
      }else if(length(grep('DOC',toupper(dir2)))>0){
             .image=1
      }else if(length(grep('EXE',toupper(dir2)))>0){
             .image=1
      }

      if(.image==1){
           download.file(.infile, .outfile,quiet = TRUE,mode='wb')
      }else{
        download.file(.infile, .outfile,quiet = TRUE)
       }
      cat("   # File/data set called ",name, " was successfully downloaded","\n")
      .z<-paste("# Your saved file/data is ==>",.outfile,sep="")
      cat("  ",.z, "\n")

    }
}



.download2cTemp<-function(i){
"Objective: download a file to c:/temp 
       i  : an integer

 Example #1: > .search('ff3M')
                    DIR            NAME
           16  data_csv   ff3Monthly.csv 
           46  data_excel ff3Monthly.xlsx
           224 data_txt   ff3Monthly.txt 

         > .download2cTemp(16)
               # File/data set called  ff3Monthly.csv  was successfully downloaded 
               # Your saved file/data is ==>c:/temp/ff3Monthly.csv 

";.download2cTemp_(i)}

.download2cTemp_<-function(i){

  if(dir.exists("c:/temp/")==F){
         cat("  Please generate c:/temp directory \n")
         cat("  dir.create('c:/temp/') \n")
   }else{
      setwd("c:/temp")
      .path3<-"http://datayyy.com/cfe/"
      if(exists('.data508')==FALSE){
          .tempPath<-paste(.path3,"data508",".RData",sep='')
           load(url(.tempPath))
           #load(.tempPath)
          .data508<<-.x
      }
     .path0<-"http://datayyy.com/"
     .n<-nrow(.data508)
      if(i<1 | i >.n){
           cat("  Error message: input integer should be between 1 and ",.n,"\n")
      }else{
          .image=0    # for data  =1 for images 
          dir2<-as.character(.data508[i,1])
          name<-as.character(.data508[i,2])
          .infile<-paste0(.path0,dir2,"/",name)
          .outPath<-getwd()
          .outfile<-paste0(.outPath,"/",name)
          if(length(grep('IMAGES',toupper(dir2)))>0){
               .image=1
          }else if(length(grep('DOC',toupper(dir2)))>0){
               .image=1
          }else if(length(grep('EXE',toupper(dir2)))>0){
               .image=1
          }
          # note for CSV file is not use mode='wb', extra lines occur
          download.file(.infile, .outfile,quiet = TRUE,mode='wb')
          cat("   # File/data set called ",name, " was successfully downloaded","\n")
          .z<-paste("# Your saved file/data is ==>",.outfile,sep="")
          cat("  ",.z, "\n")
       }
    }  # when c:/temp exists 
}


.downloadAllpdf<-function(myDir='c:/temp/'){
"Objective: download all related pdf file
    Source: http://book.ivo-welch.info/read/source.mfe/
            chap01.pdf, ..., chap23.pdf
            part1.pdf, ..., part6.pdf
            preface.pdf,epilog.pdf and appa.pdf

 Example #1: .downloadAllpdf()
        1  File called  chap01.pdf        was downloaded 
        2  File called  chap02.pdf        was downloaded 

       30  File called  epilog.pdf        was downloaded 
       31  File called  appa.pdf          was downloaded 
           All files are saved under  c:/temp/ 

 Example #2: .downloadAllpdf('c:/temp/tt/')

";.downloadAllpdf_(myDir)
}

.downloadAllpdf_<-function(myDir){
   setwd(myDir)
   count<-0
   path<-'http://book.ivo-welch.info/read/source.mfe/'
   for(i in 1:21){
      extraSpace<-"     "
      if(i<10){
         name<-paste0("chap0",i,".pdf")
         #infile<-paste0(path,"chap0",i,".pdf")
      }else{
             name<-paste0("chap",i,".pdf")
     }
     infile<-paste0(path,name)
     outfile<-paste0("chap",i,".pdf")
     download.file(infile, outfile,quiet = TRUE,mode='wb')
     count<-count+1
     if(count>=10)extraSpace<-"    "
     cat(extraSpace,count," File called ",name," \twas downloaded \n")
   }
   extra<-c("preface","toc","part1","part2","part3","part4","part5","part6","epilog","appa")
   #extra<-c("epilog","appa")
   for(name0 in extra){
     name<-paste0(name0,".pdf")
     infile<-paste0(path,name)
     outfile<-paste0(name,".pdf")
     download.file(infile, outfile,quiet = TRUE,mode='wb')
     count<-count+1
     if(nchar(name)>8){
         cat(extraSpace,count," File called ",name," \twas downloaded \n")
     }else{
         cat(extraSpace,count," File called ",name,"    "," \twas downloaded \n")
     }
   }
   cat("\n  All files are saved under ", myDir, "\n")
}


.downloadChapter<-function(i,myDir=-9){
"Objective: download related Chapter files PDF)
  i  Description 
  -  ----------- 
  1  chapter01     intro.pdf
  2  chapter02     npv.pdf
  3  chapter03     perpetuities.pdf
  4  chapter04     capbudg.pdf
  5  chapter05     yieldcurve.pdf
  6  chapter06     uncertainty.pdf
  7  chapter07     invmotive.pdf
  8  chapter08     invchoice.pdf
  9  chapter09     benchmarking.pdf
 10  chapter10     capm.pdf
 11  chapter11     imperfect.pdf
 12  chapter12     effbehav.pdf
 13  chapter13     npvadvice.pdf
 14  chapter14     financials.pdf
 15  chapter15     comps.pdf
 16  chapter16     corpclaims.pdf
 17  chapter17     capideal.pdf
 18  chapter18     captaxes.pdf
 19  chapter19     capimperfect.pdf
 20  chapter20     payouts.pdf
 21  chapter21     proforma.pdf
 22                epilog.pdf
 23                appendix.pdf

 Example 1> # donwload chapter 1
           .downloadChapter(1)  

 Example 2> .dc(1) # same as above

 Example 3> .dc(1,'c://temp/') # to c://temp

";.zdownloadChapter(i, myDir)}

.dc<<-.downloadChapter  # download chapters 

.zdownloadChapter<-function(i, myDir){
   if(myDir!=-9){
      setwd(myDir)
   }else{
     myDir<-getwd()
   }
   count<-0

loc<-c(
'https://book.ivo-welch.info/read/source5.mba/01-intro.pdf',
'https://book.ivo-welch.info/read/source5.mba/02-npv.pdf',
'https://book.ivo-welch.info/read/source5.mba/03-perpetuities.pdf',
'https://book.ivo-welch.info/read/source5.mba/04-capbudg.pdf',
'https://book.ivo-welch.info/read/source5.mba/05-yieldcurve.pdf',
'https://book.ivo-welch.info/read/source5.mba/06-uncertainty.pdf',
'https://book.ivo-welch.info/read/source5.mba/07-invmotive.pdf',
'https://book.ivo-welch.info/read/source5.mba/08-invchoice.pdf',
'https://book.ivo-welch.info/read/source5.mba/09-benchmarking.pdf',
'https://book.ivo-welch.info/read/source5.mba/10-capm.pdf',
'https://book.ivo-welch.info/read/source5.mba/11-imperfect.pdf',
'https://book.ivo-welch.info/read/source5.mba/12-effbehav.pdf',
'https://book.ivo-welch.info/read/source5.mba/13-npvadvice.pdf',
'https://book.ivo-welch.info/read/source5.mba/14-financials.pdf',
'https://book.ivo-welch.info/read/source5.mba/15-comps.pdf',
'https://book.ivo-welch.info/read/source5.mba/16-corpclaims.pdf',
'https://book.ivo-welch.info/read/source5.mba/17-capideal.pdf',
'https://book.ivo-welch.info/read/source5.mba/18-captaxes.pdf',
'https://book.ivo-welch.info/read/source5.mba/19-capimperfect.pdf',
'https://book.ivo-welch.info/read/source5.mba/20-payouts.pdf',
'https://book.ivo-welch.info/read/source5.mba/21-proforma.pdf',
'https://book.ivo-welch.info/read/source5.mba/99-epilog.pdf',
'https://book.ivo-welch.info/read/source5.mba/99-appendix.pdf'
)

  if(i>=1 & i<=23){
     infile<-loc[i]
     outfile<-sub("https://book.ivo-welch.info/read/source5.mba/","",infile)
     download.file(infile, outfile,quiet = TRUE,mode='wb')
     k<-paste("     The file called ",outfile,"was downloaded.")
     cat(k,"\n")
     cat("     and it is saved under ",myDir,"\n")
  }else{
    cat("Error message: i should be between 1 and 23\n")
  }
}





.effectYan<-function(APR,method){
"Objective   : from one APR to another APR and its corresponding effective rate
         APR : value of the given Annual Percentage Rate
      method : Converting method, e.g., 's2a', 's2q', 's2c' 
                 a for annual
                 s for semi-annual
                 q for quarterly
                 m for monthly
                 d for daily
                 c for continuously

 Example 1: > .effectYan(0.1,'s2a')
           *----------------------------------------------------- *
           * Given information:                                   *
           *   APR (APR 1) is 0.1 compounded  semi-annually 
           *---- Two equivalent rates---------------------------- *
           *   Effective monthly rate  is  0.097978 --------------*
           *   APR (2) is                  0.008165 --------------*
           *----------------------------------------------------- *

 Example 2: > .effect(0.1,'s2a')  # same as above 

 Example 3:> .effectYan(0.05,'s2q')
           *----------------------------------------------------- *
           * Given information:                                   *
           *   APR (APR 1) is 0.05 compounded  semi-annually 
           *---- Two equivalent rates---------------------------- *
           *   Effective quarterly rate  is  0.049691 ------------*
           *   APR (2) is                  0.012423 --------------*
           *----------------------------------------------------- *

";.zeffectYan(APR,method)}

.effect<<-.effectYan
.effectyan<<-.effectYan

.zeffectYan<-function(APR,rateA2rateB){
     r=rateA2rateB
     if(nchar(r)!=3) stop("Wrong input for the 2nd variable")

     if(substr(r,1,1)=='a')        {
         n_in=1
         compounded<-"annually"
     } else if(substr(r,1,1)=='s') {
         n_in=2
         compounded<-"semi-annually"
     } else if(substr(r,1,1)=='q') {
         n_in=4
         compounded<-"quarterly"
     } else if(substr(r,1,1)=='m') {
         n_in=12
         compounded<-"monthly"
     } else if(substr(r,1,1)=='d') {
         n_in=365 
         compounded<-"daily"
     } else if(substr(r,1,1)=='c') {
         n_in=1 
         compounded<-"continusouly"
     }else{
        return(-99)
     }

     if(substr(r,3,3)=='a')        {n_out=1; label='annual'
     } else if(substr(r,3,3)=='s') {n_out=2;  label='semi-annual'
     } else if(substr(r,3,3)=='q') {n_out=4;  label='quarterly'
     } else if(substr(r,3,3)=='m') {n_out=12; label='monthly'
     } else if(substr(r,3,3)=='d') {n_out=365;label='daily'
     } else if(substr(r,3,3)=='c') {n_out=1;  label='continuously'
     }else{
        print('check your 2nd input. Tt should be s2a, s2q, etc')
        return(-99)
     }

     x=matrix(1,2)
     n=n_in/n_out


     if(substr(r,1,1)=='c') {
         x[1,1]<-exp(APR)^(1/n_out)-1
     } else{

          x[1,1]<-(1+APR/n_in)^n-1
     }

     if(substr(r,3,3)=='c') {
         x[1,1]<-n_in*log(1+APR/n_in)
     }

     x[2,1]<-x[1,1]*n_out

     out<-NULL
     out[1]<-"  *----------------------------------------------------- *\n"
     out[2]<-" * Given information:                                   *\n"
     out[3]<-paste(" *   APR (APR 1) is",APR,'compounded ',compounded,"\n")
     out[4]<-" *---- Two equivalent rates---------------------------- *\n"
     out[5]<-paste(' *   Effective',label,'rate',' is ',round(x[2,1],6),"--------------*\n")
     out[6]<-paste(' *   APR (2) is                 ',round(x[1,1],6),"--------------*\n")
     out[7]<-" *----------------------------------------------------- *\n"
     cat(out)
     #return(out)
}
.explain<-function(i){
"Objective: explain various concepts 
  i   Description 
 --   -----------------------------------------------
  1   A timeline 
  2   Future value function for one present value 
  3   Present value function for one future cash flow 
  4   Definition of a perpetuity
  5   Present value of a perpetuity 
  6   Present value of a growing perpetuity 
  7   Definition of annuity
  8   Derivation of the present value of an annuity
  9   relationship between pv_annuity and pv_f
 10   Future value of annuity
 11   relationship between fv_annuity and fv_f
 12   Definitions of perpetuity due and annuity due
 13   Formulae for perpetuity due and annuity due 
 14   Excel sign convention 
 15   Excel pv() function 
 16   Excel fv() function 
 17   Definition of NPV (Net Present Value) and NPV rule
 18   Converting effective rates: a 2-step approach

  .e  is the short-cut for .explain
";.explain_(i)}

.nExplain<-18

.e<-.explain 



.explain_<-function(i){
   if(i<=.nExplain){
      x<-paste('cat(.EXPLAINP',i,')',sep='')
      .runText(x)
   }else{
       cat("Invalid number: input should be 1 to ", .nExplain,"\n")
   }
}

.EXPLAINP1<-"A timeline 
////////////////////////////////
  Assume that we borrow $100 for two years
  the annual interest rate is 10%. 
  
  Below is a timeline with cash flows. 

   100         10          10+100
   |-----------|-----------|
   0           1           2

  We receive $100 at time zero and pay $10 
  for the next two years, plus $100 at the end of
  year two. 

////////////////////////////////
"

.EXPLAINP2<-"future value function
////////////////////////////////
Assume that we deposit $100 in the bank today. If the annual 
  deposit rate is 10%, what is the value at the end of the year?
  Note that 10% is a quite high rate and its usage is purely 
  for an easy calculation.    100         ?
                              |-----------|
                              0           1
   fv1 =  110
       = 100 + 10          (principal + interest)
       = 100 + 100*0.1
       = 100*(1+0.1)

 If we deposit $100 for 2 years with the same rate?
   100                    ?
   |-----------|----------|
   0           1          2

   We know that at the end of year 1, we have 110. 
   Apply the same formula above
      fv1=fv1*(1+0.1) = 100*(1+0.1)*(1+0.1) = 100*(1+0.1)^2     
                                            = 121
  How about 5 years or n year?
    fv(one future cash flow)= pv*(1+R)^n     

     where FV is the future value
        PV is the present value 
        R  is the period rate
        n is the number of periods

   For example, what is the future value at the end of year 10 when 
    we deposit $50 today with an annual interest rate of 1.05%?
   
////////////////////////////////
"

.EXPLAINP3<-"Present value function for one future cash flow
////////////////////////////////
 The present value for a given future value is 
                                  FV
    pv(one future cash flow)=  ----------
                                (1 + R) ^n
  where FV is the future value
        R  is the period rate
        n is the number of periods
             Note: R and n should be consistent, i.e., with the same frequencies. 

   For example, what is the present value of $100 received
    at the end of year 5 with an annual discount of 5%?
  
////////////////////////////////
"

.EXPLAINP4<-"Definition of a perpetuity
///////////////////////////////////////////
  1) same amouts of the cash flows

  2) happen at the same intervals 

  3) forever 

Case #1 
         c        c       c     --> c
         |--------|-------|-------
         0        1       2      -> infinity 
Case #2
                  c       c     --> c
         |--------|-------|-------
         0        1       2      -> infinity 
Case #3
                                    c      c    -> c
         |--------|-------|--... ---|----- |---- > infinity
         0        1       2  ...    n      n+1  -> infinity 

///////////////////////////////////////////
"

.EXPLAINP5<-"Definition of the formula for pv(perpetuity) 
///////////////////////////////////////////
  1) Same amounts of cash flows
  2) Happen at the same intervals
  3) Forever
  4) The first cash flow happens at the end of the first period
   
                c       c       c       c       c       c   --> c
       |--------|-------|-------|-------|-------|-------|-- --> infinity
       0        1       2       3       4       5       6   

 PV(perpetuity)= pv(1st c) + pv(2nd c) + pv(3rd c) + pv(4th c) + ....
                  c         c         c
               = ----   + -----   + ----   +  ...
                 (1+R)   (1+R)^2    (1+R)^3
Derivation: 
                  c       c         c
       pv     = ----   + -----   + ----   +  ...    (1)
                (1+R)   (1+R)^2    (1+R)^3

Multiply both sides of Equation (1) by (1+R)

               c(1+R)   c(1+R)     c(1+R)
  pv*(1+R) =   ------    ----   + -----   + ----    
                (1+R)   (1+R)^2    (1+R)^3

                          c           c
            =    c     ------   + --------   + ----    (2)
                        (1+R)^1    (1+R)^2

Equation (2) - equation (1)

     pv(1+R) - pv =    c                                (3)
    pv + pvR - pv =    c                                (4)
    pv* R      = c 
                 c 
       pv=   -----                                      (5)
                 R
///////////////////////////////////////////
"


.EXPLAINP6<-"Present value of a growing perpetuity 
///////////////////////////////////////////
1) time line and cash flows
  a) a constant cash flow
                c       c       c       c       c       c   --> c
       |--------|-------|-------|-------|-------|-------|-- --> infinity
       0        1       2       3       4       5       6   

                10     10      10      10      10       10   --> c
       |--------|-------|-------|-------|-------|-------|-- --> infinity
       0        1       2       3       4       5       6   

  b) cash flow with a constant growth rate (g)
               c    c(1+g)  c(1+g)^2 c(1+g)^3  c(1+g)^4  c(1+g)^5 --> 
       |--------|-------|-------|-------|-------|-------|-- --> infinity
       0        1       2       3       4       5       6   

  if c=10 and g=10%
                10     11     12.1    13.31    14.64   16.11 --> 
       |--------|-------|-------|-------|-------|-------|--- --> infinity
       0        1       2       3       4       5       6   
 Formula
                                   c
    pv(growing perpetuity) =  -----------
                                  R-g

    Note: c, R and g should be consistent. 
///////////////////////////////////////////
"

.EXPLAINP7<-"Definition of an annuity
///////////////////////////////////////////
The definition of an annuity is:
-----------------------------------
    1) Same cash flows,
    2) happen at the same intervals, 
    3) for n periods.

Case #1 
         c        c       c       c
         |--------|-------|---... |
         0        1       2       n-1
Case #2
                  c       c        c
         |--------|-------|---=... |
         0        1       2        n

Case #3
                                    c      c
         |--------|-------|--... ---|----- |
         0        1       2  ...    m      m+n-1

Case #4: For my mortgage, I will pay $800 per month 
             for the next 30 years. 

Case #5: I will deposit $250 dollar per year for 
             the next 5 years. 

///////////////////////////////////////////
"

.EXPLAINP8<-"Derivation of the present value of an annuity
///////////////////////////////////////////
  1) Same amounts of cash flows
  2) Happen at the same intervals
  3) for n periods 
  4) 1st cash flow happens at the end of the 1st period
                c       c       c       c             c     
       |--------|-------|-------|-------|---.....-----|
       0        1       2       3       4             n     
Formula: 
                  c           1
   pv_annuity=  -----*(1 -  ----- )
                  R         (1+R)^n
Just image that the above cash flows are the summation of two perpetuities 
  Assume that n =5
                c       c       c       c       c     
       |--------|-------|-------|-------|--------|
       0        1       2       3       4        5

Equivalent to two perpetuities shown below. 
                c       c       c       c       c       c   --> c
       |--------|-------|-------|-------|-------|-------|-- --> infinity
       0        1       2       3       4       5       6   
                                                       -c   --> c
       |--------|-------|-------|-------|-------|-------|-- --> infinity
       0        1       2       3       4       5       6   
Case #1: receive $10 at the end of each year for the next 5 years
Case #2: receive $10 at the end of each year forever, plus pay $10 forever starting year 6
  pv(annuity) = pv(perpetuity #1) - pv(perpetuity #2)
                     c            c        
              =     ----   - pv (----)  = 
                     R            R       
                     c          c    1    
              =     ---   -   ----* ---
                     R          R   (1+R)^n
                   c            1
              =  ---- [ 1 -   ----    ]
                   R          (1+R)^n
///////////////////////////////////////////
"

.EXPLAINP9<-"Future value of an annuity
///////////////////////////////////////////
 If the first cash flow happens at the end of the first period, 
     we have the following formula. 
                   c
     fv_annuity = ---*[ (1+R)^n -1 ]
                   R

     c: a constant cash flow 
     R: period rate
     n: the number of periods

  What is the future value if we will receive $15 at the end of 
     each year for the next 20 years? Assume that the annual discount
     rate is 3%. 
     > 15/0.03*((1+0.03)^20-1) 
       [1] 403.0556

///////////////////////////////////////////
"

.EXPLAINP10<-"relationship between fv_annuity and fv_f
///////////////////////////////////////////
  To calculate the future value for a given present value, 
      we have the following formula

      fv_f= pv*(1+r)^i                   (1)

           Note that i is used instead of n to avoid confusion. 

 To calculate the futur value of an annuity (n periods), we 
      have the following formula
                   c
     fv_annuity = ---*( (1+R)^n -1 )      (2)
                   R

To calculate the future value of an annuity:
     Method I: apply Equation (2)             

     Method I: apply Equation (1)  n times, then summarize those
               n future values. 

///////////////////////////////////////////
"


.EXPLAINP11<-"Definition of annuity due, perpetuity due 
///////////////////////////////////////////
 When discussing perpetuity and annuity above, 
      we assume that each cash flow happens at 
      the end  of each  period. 
 However, for perpetuity due or annuity due
      those cash flows happen at the beginning of each
      period, show below. 

Normal perpetuity 
                  c       c     --> c
         |--------|-------|-------
         0        1       2      -> infinity 

perpetuity due
         c        c       c     --> c
         |--------|-------|-------
         0        1       2      -> infinity 

Normal annuity 
                  c       c        c
         |--------|-------|---=... |
         0        1       2        n

annuity due
         c         c       c       
         |--------|-------|---=... |
         0        1       2       n-1

///////////////////////////////////////////
"

.EXPLAINP12<-"Formulae for perpetuity due and annuity due 
///////////////////////////////////////////
 A 2-step approach
    1) Treat it as a normal perpetuity or annual
    2) Multiply the above result by (1+R)

   pv(perpetuity due) = pv(perpetuity) *(1+R)

   pv(annuity due) = pv(annuity) *(1+R)

   fv(annuity due) = fv(annuity) *(1+R)

///////////////////////////////////////////
"

.EXPLAINP13<-"Excel sign convention 
////////////////////////////////
There are two ways to explain the Excel sign conversion. 

1) Accounting approach: cash inflows vs cash outflows 
-----------------------------------------------------
 Example #1: we deposit $100 for 1 year. If the interest 
             rate is 10%, how much is the value 1 year later?

        When deposit $100, it is a cash output

     =fv(0.1,1,0,-100)   => 110   (a positive value)

2) Excel is designed this way
-----------------------------
  positive future value  -- > negative present value 

  negative future value  -- > positive present value 

  positive present value -- > negative future value 

  negative present value -- > positive future value 

////////////////////////////////
"

.EXPLAINP14<-"Excel pv() function 
///////////////////////////////////////////
 Excel present value function 
      =pv(rate, nper, pmt,[fv],[type]) 

                                     fv
    =pv(rate,nper,0,[fv]) -> pv = -  ----                    [ a negative sign]
                                    (1+R)^n 

                                          pmt      1
    =pv(rate,nper,pmt)-> pv(annuity) = -  ---*(1 - -----)    [ a negative sign]
                                           R      (1+R)^m

                                                  pmt      1
    =pv(rate,nper,pmt,0,1)->pv(annuity due)= -  ---*(1 - ----)*(1+R)
                                                  R      (1+R)^m

///////////////////////////////////////////
"

.EXPLAINP15<-"Excel fv() function 
///////////////////////////////////////////
 Excel present value function 
      =fv(rate, nper, pmt,[fv],[type]) 

    =fv(rate,nper,0,[pv]) -> fv = - pv(1+R)^n                  

                                         pmt     
    =fv(rate,nper,pmt)-> fv(annuity) = - ---*((1+R)^n - 1)
                                          R      

    =fv(rate,nper,pmt,0,1)->fv(annuity due)= above*(1+R)

///////////////////////////////////////////
"


.EXPLAINP16<-"Definition of NPV (Net Present Value) and NPV rule 
///////////////////////////////////////////
Method I: 
           NPV = PV(all benefits) - pv(all costs)

Method II: 
          if cash outflow is defined as a negative value
             cash inflow  is defined as a positive value

          NPV = PV(all cash flows)

  NPV Rule: for an independent project

        if NPV(Project) > 0 accept
        if NPV(Project) < 0 reject

////////////////////////////////
"

.EXPLAINP17<-" Excel's npv() is actually a pv function 
////////////////////////////////
Example 1: 
    If We invest $100 today and will get $120 at the end of year one. 
    if the discount rate is 10%, what is the NPV?

   1) Manually calculate the result =(120)/(1+0.1) -100 = 9.090909091
   2) Using the NPV function()
        we enter the following two values at A1 and A2
           -100
            120

           =NPV(0.1,A1:A2)   ==> 8.26 

     The correct formula should be 
           =NPV(0.1,A2)+A1   ==> 9.09 

Example 2: 
time cashflow
0   -100
1    40
2    30
3    40
4    20
5   -10
////////////////////////////////
"

.EXPLAINP18<-"Converting effective rates: a 2-step approach
////////////////////////////////

  .explain2stepApproach()

////////////////////////////////
"


.explain2stepApproach<-function(){
"
  Objective: explain the so-called 2-step approach to 
             convert APR to effective rate (APR) 
  
    input   : none
  
    Example :>explainHedging()
             Note 1: the output is not shown here. 
             Note 2: after the above command, just hit the Enter-key several times
             Note 3: If you don't get it first time, run it again. 

";.explain2stepApproach_()}

.oneLine<-function(){
 cat("* ------------------------------------------------------------- *\n")
}
.hitEnter<-function(){
  cat("Enter!")
  x<-readline()
}

.explain2stepApproach_<-function(){
 .oneLine();.oneLine()
 cat("* Explain the 2-step approach to convert effective interest rates*"); .hitEnter();
 .oneLine()
 cat("* Step 1: which effective rate is given?                        *"); .hitEnter()
 cat("*         Enter your APR now: such as 0.1 then [enter][enter]   *\n")
 APR<-scan()
 cat("*         Enter your frequency, such as 2 then [enter][enter]   *\n")
 m1<-scan()
 cat("* Your inputs:  APR=",APR,"m=",m1,"                                  *\n")
 if(m1==1){
    word<-'annually'
    freq<-'annual' 
  }else if(m1==2){
    word<-'semi-annually'
    freq<-'semi-annual' 
  }else if(m1==4){
    word<-'quarterly'
    freq<-'quarterly' 
  }else if(m1==12){
    word<-'monthly'
    freq<-'monthly' 
  }else{
    stop("Compouding frequency is not correct\n")
  }
  cat('*     Since compounded',word,',the effectiv ',freq, "*\n")
  cat("*     rate is given and its value is ", APR/m1,"\n");
 .oneLine()
 cat("* Step 2: from one effective rate to another effective rate     *"); .hitEnter()
 cat("*         enter 2nd compouding frequency, such as 1,2,4,12,356  *\n")
 m2<-scan()
 R<-(1+APR/m1)^(m1/m2)-1
 a<-"annual"
 if(m2==2){
   a<-"semi-annual"
 }else if(m2==4){
   a<-"quarterly"
 }else if(m2==12){
   a<-"monthly"
 }else if(m2==365){
   a<-"daily"
 }else{
   a<-"xxx"

 }
 cat("*         your ",a," effective rate is ", R,"       *\n")
.oneLine();.oneLine()
}

.extraCredit<-function(){
"Extra credit:

   1) You can do it solo or form a small group with maximum
      3 group members. 

   2) This is optional. 
      
   3) Extra credit plays a role on your final grade only when 
      your grade is a marginal one. 

   4) Due date: 5/20

   5) Homework #7 (or homework #8) is optional 
      and could be served as extra credit. 

      .hw(7)

          or

      .hw(8)

";.extraCredit_()}


.extracredit<<-.extraCredit
.ec<-.extraCredit

.extraCredit<-function(){
cat(
"Extra credit:

   1) You can do it solo or form a small group with maximum
      3 group members. 

   2) This is optional. 
      
   3) Extra credit plays a role on your final grade only when 
      your grade is a marginal one. 

   4) Due date: 5/20 

   5) Homework #7 (or homework #8) is optional 
      and could be served as extra credit. 

      .hw(7)

          or

      .hw(8)
")}
.finalExam<-function(){
"Objective: launch your exam by enter 
            1) your first name, and
            2) the last two digits of your ID

   Example:>.final()

            Input your first name
               john

            Input the last two digits of  your student ID
               89

           # Your exam will be launched automatically 

";.zfinalExam()}

.final<-.finalExam

.zfinalExam<-function(){
     .path<-'http://datayyy.com/cfremote1/'
     cat("\n  Input your first name\n   ")
     name0<-readline()
     name<-tolower(name0)
     cat("\n  Input the last two digits of  your student ID\n   ")
     id<-readline()
     x<-paste0("source('",.path,name,id,".txt')")
     eval(parse(text=x))
}


.finalTXT<-function(){
"Objective: launch your exam by enter 
            1) your first name, and
            2) the last two digits of your ID

   Example:>.finalTXT()

            Input your first name
               john

            Input the last two digits of  your student ID
               89

           # Your exam will be launched automatically 

  Note: short-cut .ftxt()

";.zfinalTXT()}

.finaltxt<<-.finalTXT
.finalTxt<<-.finalTXT
.ftxt<<-.finalTXT

.zfinalTXT<-function(){
     .path<-'http://datayyy.com/cfremote2/'
     cat("\n  Input your first name\n   ")
     name0<-readline()
     name<-tolower(name0)
     cat("\n  Input the last two digits of  your student ID\n   ")
     id<-readline()

     infile<-paste0(.path,name,id,".txt")
     browseURL(infile)
}


.finStatement<-function(){
"
 *---------------------------------------------------------*
 * Financial Statement Analysis                            *
 *---------------------------------------------------------*
 *  Functions       short-cut  Utilities         short-cut *
 *---------------------------------------------------------*
 * .readme_finS       .a      .saveFinStatement    .k      *
 * .getBS20           .b      .getCIKgivenTicker   .m      *
 * .getIS20           .c      .fromList2num        .n      *
 * .getCF20           .d      .list2num            .o      *
 * .getBS20better     .e                                   *
 * .getIS20better     .f                                   *
 * .getCF20better     .g                                   *
 * .getBSannual       .h                                   *
 * .getISannual       .i                                   *
 * .getCFannual       .j                                   *
 *---------------------------------------------------------*
 * >.b                 # find the usage of this function   *
 * >.finS              # back to this menu                 *
 * >.fm                # back to the main menu             *
 *---------------------------------------------------------*

";.finStatement_()
}

.finStatement_<-function(){
cat(
"
 *---------------------------------------------------------*
 * Financial Statement Analysis                            *
 *---------------------------------------------------------*
 *  Functions       short-cut  Utilities         short-cut *
 *---------------------------------------------------------*
 * .readme_finS       .a      .saveFinStatement    .k      *
 * .getBS20           .b      .getCIKgivenTicker   .m      *
 * .getIS20           .c      .fromList2num        .n      *
 * .getCF20           .d      .list2num            .o      *
 * .getBS20better     .e                                   *
 * .getIS20better     .f                                   *
 * .getCF20better     .g                                   *
 * .getBSannual       .h                                   *
 * .getISannual       .i                                   *
 * .getCFannual       .j                                   *
 *---------------------------------------------------------*
 * >.b                 # find the usage of this function   *
 * >.finS              # back to this menu                 *
 * >.fm                # back to the main menu             *
 *---------------------------------------------------------*
"
)
}

.finS<-.finStatement

.readme_finS<-function(){
"
Objective: Financial Statement Analysis 

Part I: Retrieving data (three ways) 
-----------------------------
    Method I: manually go to Yahoo!Finance, Google finance, MarketWatch 
              1) go to https://finance.yahoo.com
              2) entier ibm in the search box
              3) choose 'Financial'
              4) [default: income statement] BS, IS, CF annual and quarterly 

    Method II: using .getBS20, .getIS20, .getCF20 functions 
    -------------------
              1) x<-.getBS20('ibm')
                 Note: limited to 20 compnies
 
    Method III: using .getBSannual, .getISannual and .getCFannual functions 
               Note: you have to install 2 R packages first. 
               install.packages('tidyverse')
               install.packages('rvest')

Part II: Saving your data
-----------------------------

";.readme_finS_()
}

.readme_finS_<-function(){
cat("
Objective: Financial Statement Analysis 

Part I: Retrieving data (three ways) 
-----------------------------
    Method I: manually go to Yahoo!Finance, Google finance, MarketWatch 
             a) 

    Method II: using .getBSannual20 function 
    -------------------
 
    Method III: using .getBSannual, .getISannual and .getCFannual functions 

Part II: Saving your data
-----------------------------


")}

.formula<-function(keyword_or_ID){
"Objective      : search ID for a code image
   keyword_or_ID: such as 'c1_', 'c5_', 12, 44
                 Note that a 'png' R package is required
                 install.packages('png')

 Example 1>.formula('c1_') # all images for chapter 1
              ID               NAME
            1  1 c1_fv             
            2  2 c1_value_of_a_firm

 Example 2>.formula('c3_')
              ID                  NAME
           1  16 c3_APR1toAPR2        
           2  17 c3_APR2EAR           
           3  18 c3_APR2Rc            
          ..  .............
           14 29 c3_pvPerpetuity      
           15 30 c3_they_are_all_equal

 Example 3>.formula('pv_f')
              ID           NAME
            1 13 c2_NPV_formula

 Example 4:>.f('pv_f')  # same as the above 

 Example 5:>.f(13)      # see the formula with ID = 13

";.zformula(keyword_or_ID)}

.f<<-.formula

.zformula<-function(name){
     .path3<-"http://datayyy.com/data_R/"
     if(exists('.formulaData')==FALSE){
          .tempPath<-paste0(.path3,"formulaData",".RData")
          .formulaData<<-get(load(url(.tempPath)))
     }

      if(typeof(name)=="character"){
          name<-toupper(name)
          out<-.formulaData[grep(name,toupper(.formulaData$NAME)),]
          rownames(out)<-NULL
          #print(.leftAdj(out))
          print(.leftAdj(out),row.names=F)
          
    }else{

       if("png" %in% .packages(all.available=T)){
          .formulaShowImage(name)
       }else{
           cat("Please install the 'png' R package\n")
           cat("   install.packages('png')\n")
       }
    }

}

.formulaShowImage<-function(name){
"Objective: show formula

 Example #1>

 Example 2:>

";.zformulaShowImage(name)}

.zformulaShowImage<-function(i){
   library(png)
   .td = tempdir()        
   .tf = tempfile(tmpdir=.td, fileext=".png")

    .path3<-"http://datayyy.com/data_R/"
    if(exists('.formulaData')==FALSE){
         .tempPath<-paste0(.path3,"formulaData",".RData")
         .formulaData<<-get(load(url(.tempPath)))
    }
    n<-nrow(.formulaData)

    if(i>=1 & i<=n){
        path<-"http://datayyy.com/cf/images/"
        .myPNG <- paste0(path,.formulaData$NAME[i])
        download.file(.myPNG, .tf, quiet = TRUE,mode = 'wb')
        graphics.off()
       .img <- readPNG(.tf)
       grid::grid.raster(.img)
   }else{
       cat(" Input interger should be between 1 and ", n,"\n")
  }

}




.geneseo<-function(){
"Objective: launch your exam by enter 
            1) your first name, and
            2) the last two digits of your ID

   Example:>.geneseo()

            Input your first name
               john

            Input the last two digits of  your student ID
               89

           # Your exam will be launched automatically 

";.zgeneseo()}

.zgeneseo<-function(){
     .path<-'http://geneseo.edu/~pyan/cfremote1/'
     cat("\n  Input your first name\n   ")
     name0<-readline()
     name<-tolower(name0)
     cat("\n  Input the last two digits of  your student ID\n   ")
     id<-readline()
     x<-paste0("source('",.path,name,id,".txt')")
     eval(parse(text=x))
}


.geneseoTXT<-function(){
"Objective: Get the link for a text file 
     Example:>.geneseoTxt()
          Input your first name
            john
          Input the last two digits of  your student ID
             89

";.zGeneseoTXT()}

.geneseoTxt<<-.geneseoTXT
.geneseotxt<<-.geneseoTXT
.gTXT<<-.geneseoTXT

.zGeneseoTXT<-function(){
     .remoteDir1<-'http://geneseo.edu/~pyan/cfremote1/'
     .remoteDir2<-'http://geneseo.edu/~pyan/cfremote2/'
     .path<-.remoteDir2  
     cat("\n  Input your first name\n   ")
     name0<-readline()
     name<-tolower(name0)

     cat("\n  Input the last two digits of  your student ID\n   ")
     id<-readline()
     out<-paste0(.path,name,id,".txt")
     browseURL(out)
}
.getBS10<-function(ticker){
"Objective: retrieve annual Balance Sheet for 10 companies
   input  : ticker (limited to the following tickers
              .tickers<-c('ibm', 'wmt', 'msft', 'c','aapl','jnj', 'bac','F','MA','MAA')

 Example #1 >.getBS10('ibm')
              # Launch Excel and paste

 Example #2 >.getBS10('jnj')
              # Launch Excel and paste

 Example #3: >.getBS10('aaa')
             Error message:
             Ticker of  'aaa' is not valid. Limited to the following tickers:
             IBM WMT MSFT C AAPL JNJ BAC F MA MAA  
 
";.zgetBS10(ticker)}

.zgetBS10<-function(ticker){
    options(warn=-1);
    .tickers<-c('ibm', 'wmt', 'msft', 'c','aapl','jnj', 'bac','f','ma','maa')

    ticker<-tolower(ticker)
    if(length(grep(ticker,.tickers))>0){
         path<-"http://datayyy.com/data_csv/"
         infile<-paste0(path,ticker,'BSannual.csv')
         x<-read.csv(infile)
        .showNobs(x,0)
   }else {
     cat('Error message:\n')
     ticker2<-paste("'",ticker,"'",sep='');
     cat("      Ticker of ", ticker2, "is not valid. Limited to the following tickers:\n     ",toupper(.tickers),"\n")
   }
}


 
.getBS20datayyy<-function(ticker){
"Objective: retrieve Balance Sheet from Yan's website 
   input  : ticker (limited to ibm, wmt, msft, c,aapl,jnj, bac,a,aa,b,d,F,G,GAB,L,M,MA,MAA)

 Example #1 
             x<-.getBS20datayyy('ibm')    
              The BS for  ibm was successfully downloaded!
              head(x,3) 
                                 Period/Ending 12/31/2017 12/31/2016 12/31/2015 12/31/2014
            1 Current Assets                                -          -          -          -
            2 Cash And Cash Equivalents              11972000    7826000    7686000    8476000
            3 Short Term Investments                   608000     701000     508000          -

 Example #2:> # save your file 
             y<-.getBSannual('aapl')  
             .saveFinStatement(y,'c:/temp/aaplBS.csv')
             [1] 'Your saved file is ==>c:/temp/aaplBS.csv'

";.getBS20datayyy_(ticker)
}
.getBS20datayyy_<-function(ticker){
   ticker<-tolower(ticker)
  .tickers<-"ibm, wmt, msft, c,aapl,jnj, bac,a,aa,b,d,F,G,GAB,L,M,MA,MAA"
   if(length(grep(ticker,.tickers))>0){
   .path<-"http://datayyy.com/finStatements/"
   .pathTemp<-paste(.path,'BS_',ticker,'.csv',sep='')
   x<-read.csv(.pathTemp)
   names<-colnames(x)
   names2<-gsub("\\.","/",names)
   colnames(x)<-gsub("^X","",names2)
   cat("The BS for ",ticker, "was successfully downloaded!\n")
   return(x)
   }else {
    cat('Error message:\n')
    ticker2<-paste("'",ticker,"'",sep='');
    cat("      Ticker of ", ticker2, "is not valid. Limited to the following tickers:\n     ",toupper(tickers),"\n")
   }
}

# this function will get you the latest annual BL (5 quarters)
# https://github.com/bergant/finstr

.getBSannual<-function(ticker){
"Objective: getting Balance sheet for a given ticker
            Copy and paste the following 2 lines to install packages
              a<-c('httr','rvest','xml2','quantmod','stringr')
              for(i in a)install.packages(i)

 Example #1:> .getBSannual('AMZN')

";.zgetBSannual(ticker)}

.zgetBSannual<-function(ticker){
  #ticker = "AMZN"
  require("httr");require("rvest");require("xml2");require("quantmod");require("stringr")
  url = paste0("https://www.barchart.com/stocks/quotes/",ticker,"/balance-sheet/annual")
  pg = read_html(url)
  
  df = pg %>% html_nodes("table") %>% html_table() %>% as.data.frame()
  VAL = pg %>% html_nodes(xpath=paste0("/html/body/main/div/div[2]/div[2]/",
                                       "div/div[2]/div/div/div/div[3]/div[1]",
                                       "/span/span")) %>% html_text()
  
  if(VAL == "thousands"){VAL = "000"}
  # change 1st value of df - for colname change
  df[1,1] <- "Description"
  colnames(df) <- df[1,]
  # subset df to remove colnames
  df = df[2:nrow(df),]
  # TOTAL appears 5 different times
  df$Description[str_detect(df$Description,"TOTAL")] <- c("Total Current Assets",
                                                          "Total Non-Current Assets",
                                                          "Total Current Liabilities",
                                                          "Total Non-Current Liabilities",
                                                          "Total Shareholder's Equity")
  # get rid of special characters
  df[,2] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,2])))
  df[,3] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,3])))
  df[,4] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,4])))
  df[,5] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,5])))
  df[,6] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,6])))
  
  # add VAL to each numeric variable in BL statement otherwise NA
  for(ii in 2:ncol(df)){
    df [,ii]<- as.numeric(suppressWarnings(ifelse(is.na(as.numeric(df[,ii])*0), 
                                                  df[,ii], 
                                                  as.numeric(paste0(df[,ii],VAL))
    )
    )
    )
  }
  # remove ALL empty rows
  df = df[!(rowSums(is.na(df)) == 5),]
  # remove duplicated rows
  df <- unique(df) %>% as.data.frame()
  # make sure it is data.frame
  df <- data.frame(df[,2:6],row.names = df$Description)
  # return data.frame

  names<-colnames(df)
  names2<-gsub("X","Year",names)
  colnames(df)<-names2

   # repalce comma with semicolon
   names3<-rownames(df)
   names4<-gsub(",",";",names3)
   rownames(df)<-names4

   df2<-data.frame(names4,df)

   names5<-c("NAME",colnames(df))
   colnames(df2)<-names5
   rownames(df2)<-NULL
   # write.csv(x,file="c://temp/ibmBS.csv")

   .showNobs(df2,0)
   #  return(df)
}




# this function will get you the latest quarterly BL (5 quarters)
# https://github.com/bergant/finstr

.getBSquarterly<-function(ticker){
"Objective: getting Balance sheet for a given ticker
            Copy and paste the following 2 lines to install packages
              a<-c('httr','rvest','xml2','quantmod','stringr')
              for(i in a)install.packages(i)

 Example #1:> .getBSquarterly('AMZN')

";.zgetBS2(ticker)}

.zgetBS2= function(ticker){
  #ticker = "AMZN"
  require("httr");require("rvest");require("xml2");require("quantmod");require("stringr")
  url = paste0("https://www.barchart.com/stocks/quotes/",ticker,"/balance-sheet/quarterly")
  pg = read_html(url)
  
  df = pg %>% html_nodes("table") %>% html_table() %>% as.data.frame()
  VAL = pg %>% html_nodes(xpath=paste0("/html/body/main/div/div[2]/div[2]/",
                                       "div/div[2]/div/div/div/div[3]/div[1]",
                                       "/span/span")) %>% html_text()
  
  if(VAL == "thousands"){VAL = "000"}
  # change 1st value of df - for colname change
  df[1,1] <- "Description"
  colnames(df) <- df[1,]
  # subset df to remove colnames
  df = df[2:nrow(df),]
  # TOTAL appears 5 different times
  df$Description[str_detect(df$Description,"TOTAL")] <- c("Total Current Assets",
                                                          "Total Non-Current Assets",
                                                          "Total Current Liabilities",
                                                          "Total Non-Current Liabilities",
                                                          "Total Shareholder's Equity")
  # get rid of special characters
  df[,2] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,2])))
  df[,3] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,3])))
  df[,4] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,4])))
  df[,5] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,5])))
  df[,6] <- gsub("N/A",NA,gsub("\\$","",gsub("\\,","",df[,6])))
  
  # add VAL to each numeric variable in BL statement otherwise NA
  for(ii in 2:ncol(df)){
    df [,ii]<- as.numeric(suppressWarnings(ifelse(is.na(as.numeric(df[,ii])*0), 
                                                  df[,ii], 
                                                  as.numeric(paste0(df[,ii],VAL))
    )
    )
    )
  }
  # remove ALL empty rows
  df = df[!(rowSums(is.na(df)) == 5),]
  # remove duplicated rows
  df <- unique(df) %>% as.data.frame()
  # make sure it is data.frame
  df <- data.frame(df[,2:6],row.names = df$Description)
  # return data.frame

  names<-colnames(df)
  names2<-gsub("X","Year",names)
  colnames(df)<-names2

   # repalce comma with semicolon
   names3<-rownames(df)
   names4<-gsub(",",";",names3)
   rownames(df)<-names4
   # write.csv(x,file="c://temp/ibmBS.csv")

   .showNobs(df,0)
   #  return(df)
}




.tickers<-c('ibm', 'wmt', 'msft', 'c','aapl','jnj', 'bac','F','MA','MAA')
.getCF10<-function(ticker){
"Objective: retrieve Cashflow Statement from Yan's website 
   input  : ticker (limited to the following tickers
              .tickers<-c('ibm', 'wmt', 'msft', 'c','aapl','jnj', 'bac','F','MA','MAA')

 Example #1 >.getCF10('ibm')
             # Launch Excel and paste

 Example #2 >.getCF10('jnj')
             # Launch Excel and paste

 Example #3: >.getCF10('aaa')
             Error message:
             Ticker of  'aaa' is not valid. Limited to the following tickers:
             IBM WMT MSFT C AAPL JNJ BAC F MA MAA  

";options(warn=-1);.getCF10_(ticker)}

.getCF10_<-function(ticker){
   ticker<-tolower(ticker)
   if(length(grep(ticker,.tickers))>0){
   .path<-"http://canisius.edu/~yany/data/finStatements/"
   .pathTemp<-paste(.path,'CF_',ticker,'.csv',sep='')
   x<-read.csv(.pathTemp)
   names<-colnames(x)
   names2<-gsub("\\.","/",names)
   colnames(x)<-gsub("^X","",names2)
      ticker<-toupper(ticker)
      cat("  # Cashflow Statement for ",ticker,"\n")
     .copy2Excel(x)
   }else {
    cat('Error message:\n')
    ticker2<-paste("'",ticker,"'",sep='');
    cat("      Ticker of ", ticker2, "is not valid. Limited to the following tickers:\n     ",toupper(.tickers),"\n")
   }

}


.getDailyDatayyy<-function(ticker){
"Objective: get historical daily price data 
   ticker : stock symbol (limited to ibm, wmt, c, msft,aapl, sp500,^gspc)

 Example 1:>x<-.getDailyDatayyy('ibm')
       > head(x)
            Date     Open     High      Low    Close Adj.Close Volume
     1 1962-01-02 7.713333 7.713333 7.626667 7.626667  0.670064 387200
     2 1962-01-03 7.626667 7.693333 7.626667 7.693333  0.675921 288000
     3 1962-01-04 7.693333 7.693333 7.613333 7.616667  0.669185 256000
     4 1962-01-05 7.606667 7.606667 7.453333 7.466667  0.656007 363200
     5 1962-01-08 7.460000 7.460000 7.266667 7.326667  0.643707 544000
     6 1962-01-09 7.360000 7.506667 7.360000 7.413333  0.651321 491200
       > tail(x,3)

";.getDailyDatayyy_(ticker)
}

.getDailyDatayyy_<-function(ticker){
   .availableTickers<-"ibm, wmt, c, msft, aapl, sp500,gspc"
   ticker<-tolower(ticker)
   ticker2<-ticker
   if(ticker=="^gspc")ticker2<-"gspc"
   if(grepl(ticker2,.availableTickers)==TRUE){
        t1<-"http://datayyy.com/csv/"
        t2<-paste(t1,ticker,'Daily.csv',sep='')
       x<-read.csv(t2,header=T)
      return(x)
   }else{
   cat("ticker should be one of :",.availableTickers,"\n")
   }
}





.getDailyRetDatayyy<-function(ticker){
"Objective: get historical daily price data 
   ticker : stock symbol (limited to ibm, wmt, c, msft,aapl, sp500,^gspc)

 Example 1:>x<-.getDailyRetDatayyy('ibm')

";.getDailyRetDatayyy_(ticker)
}

.getDailyRetDatayyy_<-function(ticker){
  x<-.getDailyDatayyy(ticker)
  p<-x$Adj.Close
  n<-length(p)
  ret<-p[2:n]/p[1:(n-1)]-1
  final<-data.frame(x[2:n,],ret)
  return(final)
}


.getdata<-function(){
"
 *-----------------------------------------------------------------------*
 * .getdata                                                              *
 *-----------------------------------------------------------------------*
 *  Economics               -------------  Finance   -----------------   *
 *-----------------------------------------------------------------------*
 * .show_usGDPannual        .showff3Monthly           .show_ct1day       *
 * .show_usGDPquarterly     .showff3Daily             .show_cq1day       *
 * .show_usUnemployRate     .showffc4Monthly          .show_ct3month     *
 * .show_usDebt_annual      .showffc4Daily            .show_cq3month     *
 * .show_usCPI_annual       .showff5Monthly           .show_sp500monthly *
 * .show_usCPI_monthly      .showff5Daily             .show_sp500daily   *
 * .show_euroDollar_1m      .showAaaYieldDaily                           *
 * .show_dollarIndexMonthly .showBaaYieldMonthly      .getYahooDaily     *
 * .show_goldPrice          .showBaaYieldDaily                           *
 * .show_fedFundRate        .showTradingDaysDaily                        *
 * .show_vix                .showTradingDaysMonthly                      *
 *-----------------------------------------------------------------------*
 * >.show_usGDPannual       # find its usage                             *
 * >.getdata                # back to this menu                          *
 * >.fm                     # back to the main menu                      *
 *-----------------------------------------------------------------------*

";.getdata_()
}

.getdata_<-function(){
cat(
"
 *-----------------------------------------------------------------------*
 * .getdata                                                              *
 *-----------------------------------------------------------------------*
 *  Economics               -------------  Finance   -----------------   *
 *-----------------------------------------------------------------------*
 * .show_usGDPannual        .showff3Monthly           .show_ct1day       *
 * .show_usGDPquarterly     .showff3Daily             .show_cq1day       *
 * .show_usUnemployRate     .showffc4Monthly          .show_ct3month     *
 * .show_usDebt_annual      .showffc4Daily            .show_cq3month     *
 * .show_usCPI_annual       .showff5Monthly           .show_sp500monthly *
 * .show_usCPI_monthly      .showff5Daily             .show_sp500daily   *
 * .show_euroDollar_1m      .showAaaYieldDaily                           *
 * .show_dollarIndexMonthly .showBaaYieldMonthly      .getYahooDaily     *
 * .show_goldPrice          .showBaaYieldDaily                           *
 * .show_fedFundRate        .showTradingDaysDaily                        *
 * .show_vix                .showTradingDaysMonthly                      *
 *-----------------------------------------------------------------------*
 * >.show_usGDPannual       # find its usage                             *
 * >.getdata                # back to this menu                          *
 * >.fm                     # back to the main menu                      *
 *-----------------------------------------------------------------------*

"
)
}

.gd<-.getdata

.tickers<-c('ibm', 'wmt', 'msft', 'c','aapl','jnj', 'bac','F','MA','MAA')
.getIS10<-function(ticker){
"Objective: retrieve Income Statement from Yan's website 
   input  : ticker (limited to the following tickers
              .tickers<-c('ibm', 'wmt', 'msft', 'c','aapl','jnj', 'bac','F','MA','MAA')

 Example #1 >.getIS10('ibm')
             # Launch Excel and paste

 Example #2 > a=.getIS10('jnj')
             # Launch Excel and paste

 Example #3:> .getIS10('aaa')
             Error message:
             Ticker of  'aaa' is not valid. Limited to the following tickers:
             IBM WMT MSFT C AAPL JNJ BAC F MA MAA  

";.zgetIS10(ticker)}

.zgetIS10<-function(ticker){

   options(warn=-1);

  .tickers<-c('ibm', 'wmt', 'msft', 'c','aapl','jnj', 'bac','f','ma','maa')
   ticker<-tolower(ticker)
   if(length(grep(ticker,.tickers))>0){

     path<-"http://datayyy.com/data_csv/"
     infile<-paste0(path,ticker,'ISannual.csv')
     x<-read.csv(infile)
    .showNobs(x,0)
  
   }else {
    cat('Error message:\n')
    ticker2<-paste("'",ticker,"'",sep='');
    cat("      Ticker of ", ticker2, "is not valid. Limited to the following tickers:\n     ",toupper(.tickers),"\n")
   }
}


# (Updated 2/15/2022) - Modified thanks to @heyitsfred on GitHub
# fixes some issues with not all rows not scraping from barChart &
# not filtering pages without daata
# ticker to get IS
#ticker = "RBLX"
# https://github.com/jgQuantScripts/getIncomeStatements

.getISannual<-function(ticker){
"Objective: getting several years' income statements for a given ticker
            Copy and paste the following 2 lines to install several R packages

            a<-c('httr','rvest','xml2','quantmod','stringr')
            for(i in a)install.packages(i)

 Example #1:> .getISannual('AMZN')

";.zgetISannual(ticker)}

.zgetISannual<-function(ticker){
  require("httr");require("rvest");require("xml2");require("quantmod")
  url = paste0("https://www.barchart.com/stocks/quotes/",ticker,"/income-statement/annual")
  pg = read_html(url)
  
  df = pg %>% html_nodes("table") %>% html_table() %>% as.data.frame()
  VAL = pg %>% html_nodes(xpath=paste0("/html/body/main/div/div[2]/div[2]/",
                                       "div/div[2]/div/div/div/div[3]/div[1]",
                                       "/span/span")) %>% html_text()
  
  if(VAL == "thousands"){VAL = "000"}
  # change 1st value of df - for colname change
  df[1,1] <- "Description"
  colnames(df) <- df[1,]
  # subset df to remove colnames
  df = df[2:nrow(df),]
  
  # get rid of special characters
  for (j in 2:ncol(df)){
    df[,j] <- gsub("\\$","",gsub("\\,","",df[,j]))
  }
  
  # select rows only
  ROWS = c("Sales","Cost of Goods","Gross Profit","Operating Expenses",                   
           "Operating Income","Interest Expense","Other Income","Pre-tax Income",
           "Income Tax","Net Income","EPS Basic Total Ops",
           "EPS Diluted Total Ops","Ebitda")
  
  df = lapply(as.list(1:length(ROWS)), function(ii){
    tmp = subset(df, df$Description == ROWS[ii])
    if(nrow(tmp) == 0 ) {   
      tmp_names = colnames(tmp)
      tmp = data.frame(matrix(rep('N/A',ncol(df)),nrow=1) )   
      colnames(tmp) = tmp_names
      tmp[1]= ROWS[ii] #want the missing expense type put into the names column
    }else{
      tmp[1,2:ncol(tmp)] = paste0(tmp[1,2:ncol(tmp)],VAL) 
    }
    tmp
  })
  # remove any empty cases
  df = df[lapply(df, length)>0]
  # rbind list
  df = do.call(rbind,df)
  # remove NA row
  INT = which(is.na(df[,1]))
  if(length(INT)!=0){df= df[-INT,]}
  
  # make sure it is data.frame
  df <- as.data.frame(df)
  # convert to numeric
  df[,2:ncol(df)]<- round(sapply(df[,2:ncol(df)], as.numeric),2)
  
  # make sure it is data.frame
  df = as.data.frame(df)
  
  names<-colnames(df)
  names2<-gsub("X","Year",names)
  colnames(df)<-names2

   # repalce comma with semicolon
   names3<-rownames(df)
   names4<-gsub(",",";",names3)
   rownames(df)<-names4

   df2<-data.frame(names4,df)

   names5<-c("NAME",colnames(df))
   colnames(df2)<-names5
   rownames(df2)<-NULL
   # write.csv(x,file="c://temp/ibmBS.csv")
   .showNobs(df,0)
   #  return(df)
}
.getMonthly<-function(ticker){
"Objective: get historical Monthly price data 
   ticker : stock symbol (limited to ibm, wmt, c, msft,aapl, sp500,^gspc)

 Example 1:>x<-.getMonthly('ibm')
  


";.zgetMonthly(ticker)}

.zgetMonthly<-function(ticker){
   .availableTickers<-"ibm, wmt, c, msft, aapl, sp500,gspc"
   ticker<-tolower(ticker)
   ticker2<-ticker
   if(ticker=="^gspc")ticker2<-"gspc"
   if(grepl(ticker2,.availableTickers)==TRUE){
        t1<-"http://datayyy.com/data_csv/"
        t2<-paste(t1,ticker,'Monthly.csv',sep='')
        x<-read.csv(t2,header=T)
        .showNobs(x,0)
   #      return(x)
   }else{
       cat("ticker should be one of :",.availableTickers,"\n")
   }
}





.getMonthlyRetDatayyy<-function(ticker){
"Objective: get historical Monthly price data 
   ticker : stock symbol (limited to ibm, wmt, c, msft,aapl, sp500,^gspc)

 Example 1:>x<-.getMonthlyRetDatayyy('ibm')

";.getMonthlyRetDatayyy_(ticker)
}

.getMonthlyRetDatayyy_<-function(ticker){
  x<-.getMonthlyDatayyy(ticker)
  p<-x$Adj.Close
  n<-length(p)
  ret<-p[2:n]/p[1:(n-1)]-1
  final<-data.frame(x[2:n,],ret)
  return(final)
}





# https://conjugateprior.org/2015/06/identifying-the-os-from-r/
# a<-.getOS()     a=="windows"   
#                 a=="osx"

.getOS<- function(){

  sysinf <- Sys.info()
  if (!is.null(sysinf)){
      os <- sysinf['sysname']
      if (os == 'Darwin')
       os <- "osx"
  } else { ## mystery machine
        os <- .Platform$OS.type
      if (grepl("^darwin", R.version$os))
         os <- "osx"
       if (grepl("linux-gnu", R.version$os))
         os <- "linux"
  }
 
  final<-tolower(os)
  return(final)
}
.getTxt<-function(){
"Objective: Get the link for a text file 
     Example:>.gettxt()
          Input your first name
            john
          Input the last two digits of  your student ID
             89
";.zgetTxt()}

.gettxt<<-.getTxt

.zgetTxt<-function(){

     .remoteDir1<-'http://datayyy.com/cfremote1/'
     .remoteDir2<-'http://datayyy.com/cfremote2/'
     .path<-.remoteDir2  
     cat("\n  Input your first name\n   ")
     name0<-readline()
     name<-tolower(name0)

     cat("\n  Input the last two digits of  your student ID\n   ")
     id<-readline()
     out<-paste0(.path,name,id,".txt")
     browseURL(out)
}
.image<-function(keyword_or_ID){
"Objective      : search ID for a code image
   keyword_or_ID: such as 'c1_', 'c5_', 12, 44
                 Note that a 'png' R package is required

                 install.packages('png')
                 install.packages('jpeg')

 Example 1>.image('c1_') # all images for chapter 1
 
 Example 2>.image('c3_')
 
 Example 3>.image('pv_f')

";.zimage(keyword_or_ID)}

.images<<-.image

.zimage<-function(name){

     .path<-"http://datayyy.com/cf/images/"
     if(exists('.imageData')==FALSE){
          .tempPath<-paste0(.path,"imageData",".RData")
          .imageData<<-get(load(url(.tempPath)))
     }

     if(typeof(name)=="character"){
         name<-toupper(name)
         out<-.imageData[grep(name,toupper(.imageData$NAME_NEW)),]
         out2<-data.frame(out$ID, out$NAME_NEW)
         colnames(out2)<-c("ID","NAME")
         rownames(out2)<-NULL
         print(.leftAdj(out2))
    }else{
           name2<-toupper(.imageData$NAME_NEW[name])
           a<-grep("PNG", name2)
           if(length(a)>0){
                .showImageCF(name)
           }else{
                infile<-.show_jpg0(name)
                .show_jpg(infile)
           }
    }
}
# setwd('c://yan/teaching/cf/imagesMy/hwImages/')
# a<-dir(pattern="png")

.image2excel<-function(infile){
"Objective: Paste an image to Work, Excel or clipboard
   infile : location of an image
            Note that this function depends on two packages
            require(grDevices)
            require(imager)
            # install.packages('grDevices')
            # install.packages('imager')

  Example #1:>
              infile<-'https://cran.r-project.org/Rlogo.jpg'
              .image2excel(infile)
              Launch Excel and paste
            
  Example #2:>infile<-'https://cran.r-project.org/Rlogo.jpg'
             .i2e(infile)

  Example #3:> # from a local file 
             infile<-'http://datayyy.com/images/leaf.jpg'
             outfile<-'leaf.jpg'
             download.file(infile,outfile,mode='wb')
             .i2e(outfile)

  Example #4:>infile<-'http://datayyy.com/images/fun.png'
            .i2c(infile)

";.zimage2excel(infile)}

.image2Excel<-.image2excel
.i2e<-.image2excel

.zimage2excel<-function(infile){
    library(grDevices)
    require(imager)
    a<-grep("http",infile)
    if(length(a)>0){
         tf = tempfile()
         download.file(infile, tf, quiet = TRUE,mode = 'wb')
         b<-load.image(tf)
     }else{
       b<-load.image(infile)
     }
     plot(b)
     savePlot("clipboard", type = "wmf")
     cat('\n  Launch Excel and paste\n')
}

source("c://yan/teaching/cf/inClassEx/inClassEx.txt")




.is404<-function(remoteFile){
"Objective: Check the existence of a remote file
  remoteFile: a remote file
              output value:200   yes
                           404   no
              Note: this program uses an R 'httr' package.
                    You can install it by issing the following code. 
                    install.packages('httr')

 Example #1>.is404('http://datayyy.com/if.txt') 
            [1] 200

 Example #2>url<-'http://datayyy.com/data_excel/ff3Monthly.xxx'
           >.is404(url)  
             [1] 404

";.zis404(remoteFile)}

.zis404<-function(remoteFile){
    x<-typeof(remoteFile)
    if(x!="character"){
       error<-"Error message: input should be a string"
       return(error)
    }

   x<-"httr" %in% .packages(all.available=T)
   if(x==FALSE){
     error<-'Please install the "httr" R package:\ninstall.packages("httr")\n'
     return(error)
   }

   library(httr)
   status <- HEAD(remoteFile)
   a<-status$status_code
   return(a)
}

.launchPrograms<-function(){
     options(warn=-1)

     .loadChapters(.whichChapters)
     .loadgetdata(.whichgetdata)
     .loadUtility(.whichUU)
     .uu<<-.utilities
     .u<<- .utilities
     .loadInClassEx(.whichInClassEx)
     .loadFun(.whichFun)
     .cls()
     .cf()
}

.leftAdj<-function(x){
   format(x, justify = "left")

}
.load_yan<-function(name){
   "Objective: tload an R data set from http://canisius.edu/~yany/RData
     e.g., 
            To load sec10k1993_20130906.RData
            >.load_yan('sec10k1993_20130906')

   "
   .load_yan_(name)
}

.load_yan_<-function(name){
     #print(name)
     if(name=='sec10k'){
         name='sec10k1993_20130906'
     }

     ..pathRData<-"http://datayyy.com/data_R/"
     #print(t1)

     t2<-paste(..pathRData,name,'.RData',sep='')
     con<-url(t2)
     #print(t2)

     load(con)
     close(con)

     if(name=='stockMonthly.RData'){
            stockMonthly<<-stockMonthly 

     }else if(name=='name_cik'){
          name_cik<<-name_cik 

     # ----- add here -------------------

        }else if(name=='benford'){
             .benfordData<<-.x

        }else if(name=='sharesOutstanding'){
             .sharesOutstanding<<-.x

      }else if(name=='formulae'){
             .formulae<<-.x

      }else if(name=='sp500addedDeleted'){
             .sp500addedDeleted<<-.x

      }else if(name=='allRpackages'){
             .allRpackages<<-.x

      }else if(name=='titanic'){
             .titanic<<-.x

    }else if(name=='ff3_ibmMonthly'){
          .ff3_ibmMonthly<<-.x

     }else if(name=='sp500annual'){
          .sp500annual<<-.x

     }else if(name=='rosco'){
          .rosco<<-.x

     }else if(name=='fogIndex1994_2011'){
          .fogIndex<<-.x

     }else if(name=='positiveWords'){
          .positiveWords<<-.x

     }else if(name=='negativeWords'){
          .negativeWords<<-.x

     }else if(name=='finalExam2'){
          .finalExam<<-.x


     }else if(name=='hsicDaily'){
          .hsicDaily<<-.x

     }else if(name=='chickEgg'){
          .chickEgg<<-.x

     }else if(name=='putCallRatio'){
          .putCallRatio<<-.x



     }else if(name=='bondSpread'){
          .bondSpread<<-.x

     }else if(name=='DTAQtrade50'){
          .DTAQtrade50<<-.x



     }else if(name=='ibmMonthly'){
          .ibmMonthly<<-.x

     }else if(name=='wmtMonthly'){
          .wmtMonthly<<-.x



     }else if(name=='populationGDP2019'){
          .populationGDP2019<<-.x

     }else if(name=='sp500monthly'){
          .sp500monthly<<-.x

     }else if(name=='sp500daily'){
          .sp500daily<<-.x

     }else if(name=='fail2deliver201810a'){
          .fail2deliver201810a<<-.x

    }else if(name=='economicFreedomIndex'){
          .economicFreedomIndex<<-.economicFreedomIndex


    }else if(name=='vix'){
          .vix<<-.vix


     }else if(name=='cikticker'){
          .cikticker<<-.cikticker

     }else if(name=='ff10VWindustryMonthly'){
          .ff10VWindustryMonthly<<-.ff10VWindustryMonthly


     }else if(name=='ff5industryVW'){
          .ff5industryVW<<-.x
     }else if(name=='ff5industryEW'){
          .ff5industryEW<<-.x


     }else if(name=='ibmDaily'){
          .ibmDaily<<-.x

     }else if(name=='marketCap'){
          .marketCap<<-.x

     }else if(name=='tradingDaysDaily'){
          .tradingDaysDaily<<-.tradingDaysDaily


     }else if(name=='tradingDaysMonthly'){
          .tradingDaysMonthly<<-.tradingDaysMonthly


     }else if(name=='ff3Monthly'){
          .ff3Monthly<<-.x
     }else if(name=='ff3Daily'){
          .ff3Daily<<-.x

     }else if(name=='ffc4Monthly'){
          .ffc4Monthly<<-.ffc4Monthly
     }else if(name=='ffc4Daily'){
          .ffc4Daily<<-.ffc4Daily


     }else if(name=='ff5Monthly'){
          .ff5Monthly<<-.ff5Monthly
     }else if(name=='ff5Daily'){
          .ff5Daily<<-.ff5Daily

     }else if(name=='ff5EWindustry'){
          .ff5EWindustry<<-.x

     }else if(name=='ff5VWindustry'){
          .ff5VWindustry<<-.x

     }else if(name=='ct1day'){
          .ct1day<<-.ct1day 
     }else if(name=='cq1day'){
          .cq1day<<-.cq1day 


     }else if(name=='TORQct'){
          .TORQct<<-.TORQct
     }else if(name=='TORQcq'){
          .TORQcq<<-.TORQcq 


     }else if(name=='ffMonthly'){
          .ffMonthly<<-.ffMonthly

    }else if(name=='stock11monthly'){
          .stock11monthly<<-.stock11monthly


     }else if(name=='dollarIndex'){
          .dollarIndex<<-.dollarIndex 

     }else if(name=='qq2'){
          .qq2<<-.qq2 

     }else if(name=='creditSpread'){
          .creditSpread<<-.x 

     }else if(name=='nyseListing'){
          .nyseListing<<-.nyseListing 


     }else if(name=='fedFundRate'){
          .fedFundRate<<-.x 


     }else if(name=='euroDollarDeposit1m'){
          .euroDollarDeposit1m<<-.euroDollarDeposit1m 


     }else if(name=='indexDaily'){
          .indexDaily<<-.indexDaily 

     }else if(name=='sec10k1993_20130906'){
          .sec10k1993_20130906<<-.sec10k1993_20130906 
    
     }else if(name=='ff'){
          .ff_daily_factors<<-.ff_daily_factors
          .ff_monthly_factors<<-.ff_monthly_factors

     }else if(name=='ff_daily_factors'){
          .ff_daily_factors<<-.ff_daily_factors

     }else if(name=='ff_monthly_factors'){
          .ff_monthly_factors<<-.ff_monthly_factors

     }else if(name=='cik'){
          .cik<<-.cik

     }else if(name=='sec10k'){
          .sec10k1993_20130906<<-.sec10k1993_20130906

     }else if(name=='usCPImonthly'){
          .usCPImonthly<<-.usCPImonthly

     }else if(name=='usCPIannual'){
          .usCPIannual<<-.usCPIannual


     }else if(name=='moody_credit_yield'){
         # credit<<-credit
           #print("haha")
            .moody_AAA_yield_daily   <<-.moody_AAA_yield_daily 
            .moody_AAA_yield_monthly <<-.moody_AAA_yield_monthly 
            .moody_AAA_yield_annual  <<-.moody_AAA_yield_annual 
            .moody_Baa_yield_daily   <<-.moody_Baa_yield_daily 
            .moody_Baa_yield_monthly <<-.moody_Baa_yield_monthly 
            .moody_Baa_yield_annual  <<-.moody_Baa_yield_annual


      }else if(name=='credit'){
          .credit<<-.credit

     }else if(name=='AaaYieldMonthly'){
          .AaaYieldMonthly<<-.AaaYieldMonthly


      }else if(name=='AaaYieldDaily'){
          .AaaYieldDaily<<-.AaaYieldDaily

      }else if(name=='BaaMonthly'){
          .BaaMonthly<<-.BaaMonthly


      }else if(name=='BaaDaily'){
          .BaaDaily<<-.BaaDaily
 
      }else if(name=='usGDPannual'){
          .usGDPannual   <<-.usGDPannual

      }else if(name=='usGDPquarterly'){

          .usGDPquarterly<<-.usGDPquarterly


     }else if(name=='usDebt'){
          .usDebt<<-.usDebt

     }else if(name=='usUnemploymentRate'){
          .usUnemploymentRate<<-.usUnemploymentRate

     }else if(name=='sp500'){
          .sp500<<-.sp500

     }else if(name=='zipdata'){
          .zipdata<<-.zipdata

     }else if(name=='goldDailyPrice'){
          .goldDailyPrice<<-.goldDailyPrice

     }else if(name=='goldPriceAnnual'){
          .goldPriceAnnual<<-.x


     }else if(name=='goldPrice'){
          .goldPrice<<-.x


     }else if(name=='EDM1'){
          .EDM1<<-.EDM1
    }


}



# assume that ..path and ..path2 are defined

.loadChapters<-function(.nn){
  .pathChapters<-paste(..path2,'chapters/chapter',sep='')
  for(.i in .nn){
     .aa<-paste(.pathChapters,.i,".txt",sep='')
     source(.aa)
   }
}

.loadOneChapter<-function(.n){
  .pathChapters<-paste(..path2,'/chapters/chapter',sep='')
  .aa<-paste(.pathChapters,.n,".txt",sep='')
  source(.aa)
}

.loadUtility<-function(.n){
  #.pathTemp<-paste(..path2,'/R/uu0.txt',sep='')
  #  source(.pathTemp)
  .uu<-paste(..path2,'uu/uu',.n,'.R',sep='')
  source(.uu)
}

.loadInClassEx<-function(.n){
  .ex<-paste(..path2,'/inClassEx/ice',.n,'.R',sep='')
  source(.ex)
}

.loadAllChapters<-function(){
    .pathTemp<-paste(..path2,"/chapters/allChapters.txt",sep='')
    source(.pathTemp)
}

.loadLectures<-function(){
    .pathTemp<-paste(..path2,'/R/lectures.txt',sep='')
     source(.pathTemp)
}

.loadFun<-function(.i){
    if(.i!=0){
       .pathTemp<-paste(..path2,'fun/fun',.i,'.R',sep='')
       source(.pathTemp)
    }
}

.loadgetdata<-function(.i){
    if(.i!=0){
       .pathTemp<-paste(..path2,'getdata/getdata',.i,'.R',sep='')
       source(.pathTemp)
    }
}
.loadData<-function(dataIDorName,printMessage=TRUE){
"Objective: load a given data set 
      i: integer 
   A list of all data sets (add later)

 Example #1: > .loadData(3)
       
 Example #2: > .loadData('ff5industryEW')
               Note: Data set called  'ff5industryEW' downloaded 
               Use head(.x) and tail(.x) to view the data set.
       
";.loadData_(dataIDorName,printMessage)
}

.loadData_<-function(dataIDorName,printMessage){

   # check .dataIDname 
   if(exists('.dataIDname')==FALSE){
       .tempPath<-paste(..path2,"RData/dataIDname",".RData",sep='')
        load(url(.tempPath))
       .dataIDname<<-.x
   }

   if(typeof(dataIDorName)=="double"){
      d<-toString(.dataIDname$NAME[dataIDorName])
      e<-paste0(..path2,"RData/",d,".RData")
      load(url(e))
      .x<<-.x
      t<-paste0("'",d,"'")
      if(printMessage==TRUE){
        cat("   Note: Data set called ",t, "downloaded \n")
        cat("         Use head(.x) and tail(.x) to view the data set.\n")
      }
   }else{
      n1<-nchar(dataIDorName)
      .a<-toupper(dataIDorName)
      .b<-toupper(.dataIDname$NAME)
      .c<-.dataIDname[grep(.a,.b),]

      if(nrow(.c)==0){
           cat("  \nSorry: no such data set called ",dataIDorName, "\n")
           cat("       please check the spelling.","\n\n")
      }else{
          if(length(.c)>1){
             n1<-nchar(dataIDorName)
             #.d<-.c[nchar(.c$NAME)==n1]
             .d<-.c[nchar(matrix(.c$NAME))==n1,]
           }else{
             .d<-.c
           }
           e<-paste0(..path2,"RData/",.d$NAME,".RData")
           load(url(e))
           .x<<-.x
           t<-paste0("'",.d$NAME,"'")
           if(printMessage==TRUE){
              cat("   Note: Data set called ",t, "downloaded \n")
              cat("         Use head(.x) and tail(.x) to view the data set.\n")
           }
      }
   }
}


.m2_4_m1<-function(){
"Objective: Apply the Excel average(), var.p(), stdev.p()
            for data set when probabily and return vectors are given. 
            This is for boty Mac and Windows users. Assume that the 
            R package called 'clipr' is installed. 
 
            install.package('clipr')

";.zm2_4_m1()}

.hitAnyKey<-function(){
    cat('  Hit the enter-key to continue:  \n')
    a<-readline()
}

.zm2_4_m1<-function(){

    library(clipr)

    cat("  Copy the probability vector from your Excel file,  
       or copy the following four lines.
prob
0.2
0.3
0.5
")

     .hitAnyKey()
     probs<<-read.table('clipboard',header=T)
     #print(prob)
     cat("  Copy the return vector from your Excel file,  
       or copy the following four lines.
returns
-0.10
0.23
0.15
")

     .hitAnyKey()
     returns<-read.table('clipboard',header=T)
     #print(returns)
     colnames(probs)<-"prob"
     returns<<-returns
     n1<-nrow(probs)
     n2<-nrow(returns)

    #    n3<-100 total obs
    three<-c(10,100,1000,10000,100000)
    for(j in 1:length(three)){
       n3<<-three[j]
       #s<-sum(probs[,1]*n3)
       s<-sum(as.integer(probs[,1]*n3))

       if(s==n3){
              break
       }
    }

    if(n1==n2){
          #n3<-100
          final<-NULL
          for(i in 1:n1){
              k<-rep(returns[i,1],n3*probs[i,1])
              final<-c(final,k)
          }
          #write.table(final,file="clipboard",row.names=F)
          write_clip(final)
          cat("  Launch Excel and paste!\n")
         }else{
            cat(" Two columns have different numbers of observations.\n")
         }
 }
.m2_4_m1_Mac<-function(){
"Objective: there are two methods to estimate expected mean and stadard deviation
            Method 1: when prob and returns are given 
                       exp(R)= p1*R1 + p1* R2 + ...
                       var   =p1*(R1-exp_R)^2 + ... 
            Method 2: we are given individual returns, R1, R2, ..., Rn

   Method 2 is much simpler than Method 2. How to use Method 2 to solve the cases when prob 
            and returns are given? This is an interactive program and just type
           .m2_4_m1()

";.zm2_4_m1_Mac()}

.hitAnyKey<-function(){
    cat('  Hit the enter-key to continue:  \n')
    a<-readline()
}

.zm2_4_m1_Mac<-function(){
cat("  Copy the probability vector from your Excel file,  
       or copy the following four lines.
prob
0.2
0.3
0.5
")

.hitAnyKey()
probs<<-read.table('clipboard',header=T)
#print(prob)

cat("  Copy the return vector from your Excel file,  
       or copy the following four lines.
returns
-0.10
0.23
0.15
")

.hitAnyKey()
returns<<-read.table('clipboard',header=T)
#print(returns)

n1<-nrow(probs)
n2<-nrow(returns)


  #    n3<-100 total obs
    three<-c(10,100,1000,10000,100000)
    for(j in 1:length(three)){
       n3<<-three[j]
       #s<-sum(probs[,1]*n3)
       s<-sum(as.integer(probs[,1]*n3))

       if(s==n3){
              break
       }
    }


  if(n1==n2){
       #n3<-100
       final<-NULL
       for(i in 1:n1){
          k<-rep(returns[i,1],n3*probs[i,1])
          final<-c(final,k)
       }
    #    write.table(final,file="clipboard",row.names=F)
     clip <- pipe("pbcopy", "w")                       
     write.table(final, file=clip)                               
     close(clip)
     cat("  Launch Excel and paste!\n")
   }else{
       cat(" Two columns have different numbers of observations.\n")
   }
}





.m2_4_m1_PC<-function(){
"Objective: there are two methods to estimate expected mean and stadard deviation
            Method 1: when prob and returns are given 
                       exp(R)= p1*R1 + p1* R2 + ...
                       var   =p1*(R1-exp_R)^2 + ... 
            Method 2: we are given individual returns, R1, R2, ..., Rn

   Method 2 is much simpler than Method 2. How to use Method 2 to solve the cases when prob 
            and returns are given? This is an interactive program and just type
           .m2_4_m1_PC()

";.zm2_4_m1_PC()}

.hitAnyKey<-function(){
    cat('  Hit the enter-key to continue:  \n')
    a<-readline()
}

.zm2_4_m1_PC<-function(){
cat("  Copy the probability vector from your Excel file,  
       or copy the following four lines.
prob
0.2
0.3
0.5
")

.hitAnyKey()
probs<<-read.table('clipboard',header=T)
#print(prob)

cat("  Copy the return vector from your Excel file,  
       or copy the following four lines.
returns
-0.10
0.23
0.15
")

.hitAnyKey()
returns<<-read.table('clipboard',header=T)
#print(returns)

n1<-nrow(probs)
n2<-nrow(returns)


  #    n3<-100 total obs
    three<-c(10,100,1000,10000,100000)
    for(j in 1:length(three)){
       n3<<-three[j]
       #s<-sum(probs[,1]*n3)
       s<-sum(as.integer(probs[,1]*n3))

       if(s==n3){
              break
       }
    }


  if(n1==n2){
     #  n3<-100
       final<-NULL
       for(i in 1:n1){
          k<-rep(returns[i,1],n3*probs[i,1])
          final<-c(final,k)
       }
       write.table(final,file="clipboard",row.names=F)
       cat("  Launch Excel and paste!\n")
   }else{
       cat(" Two columns have different numbers of observations.\n")
   }
}





"

cat('When estimating an expected value and variance, we have two method
        Method 1: when the probability and return vectors are given: 
                  exp_R= p1*R1           +  p1* R2       + ...
                  var =p1*(R1-exp_R)^2 + p1*(R2-exp_R)^2 + ... 

        Method 2: When individual returns are given, R1, R2, ..., Rn
                  Excel two functions: average(), stdev()
')

.hitAnyKey()
cat('
  Method 2 is much simpler than Method 2.
    How to use Method 2 to solve the cases when prob and returns are given?
')
.hitAnyKey()

"
.macro<-function(i){
" i  Meaning                       i  Description 
  -  --------------------------   --  --------------------------------!
  1  Developer not available       21 Macro 4 cleaning 
  2  Record the simplest Macro     22 Macro 4 hiding   columns
  3  How to run a Marco?           23 Macro 4 unhiding columns
  4  How to edit a macro           24 Macro 4 hiding   rows
  5  A simple macro                25 Macro 4 unhiding rows
  6  Recording: short-cut: Ctrl-a  26 Macro 4 creating a pie
  7  Assign a shortcut key         27 Macro 4 adding 10
  8  Message box: Hello World!     28 Macro 4 copying from one cell to another 
  9  Copy others' macros           29 Macro 4 copying to current cell 
 10  Ctrl-d to clean               30 Macro 4 generating five 9
 11  Ctrl-h to hide                31 Macro 4 generating 1,3, 5, ...,  
 12  Ctrl-u to unhide              32 Macro 4 double loops
 13  Extension should be *.xlsm    33 Macro 4 assigning z to (x,y): x,y,z in A1,A2,A3
 14  Link a button to a Macro      34 Macro 4 printing a mutiple-line message box 
 15  call Macros from a Macro      35 Macro 4 printing your instruction 
 16  If left cell empty-> Done     36 Macro 4 (input box and save to A1)
 17  Move 1 cell to the right      37 Macro 4 deleting the range of A1:Z100
 18  Move down/up/right/left       38 Macro 4 unhide 1st column/1st row 
 19  A set of one-line commands    39 Macro 4 add_row_column (Binomial tree option model)
 20  Links                         40 Macro 4 clean (Binomial tree option model)

 Example #1:>.macro  # see the above list
 Example #2:>.macro(1) # see the 1st explanation

";.macro_(i)}

.nMacros<-40
.macro_<-function(i){
   if(i<=.nMacros){
      x<-paste0('cat(.macro',i,')')
      .runText(x)
   }else{
      cat("Invalid number: input value should between 1 and ",.nMacros, "\n")
   }
}

.mm<<-.macro

.macro1<-"If \"Developer\" is not available on your menu bar
/////////////////////////
Windows users
--------------
  Step 1: click 'File' 
  Step 2: click 'Options' 
  Step 3: click 'Customize Ribbon' 
  Step 4: Activate 'developer' and click 'OK'

Mac users
-------------------------
    Select Excel > Preferences > Ribbon & Toolbar.
    Under Customize the Ribbon, select Main Tabs and then check Developer.
    Click Save and then close Excel Preferences.

    http://datayyy.com/webs/developerMac.html

  Video: Enable Developer Tab In Excel 2016 for Mac
         (53second)
          https://www.youtube.com/watch?v=KZ4xTecAxZ4
    
/////////////////////////
"

.macro2<-"Record the simplest Macro
/////////////////////////
 Step 1: Click \"Developer\"

 Step 2: click \"Record Macros\"

 Step 3: Macro1  [or another name]
         shortCut Key  + [a]

 Step 4: choose cell B2, type 1 then enter

 Step 5: Click \"Stop Recording\"

  Now delete the value in B2 and hit Ctrl-a to see the result. 
/////////////////////////
"


.macro3<-"How to run a Macro?
/////////////////////////
Method I: 
---------
  Step 1: Click \"Developer\"
  Step 2: Click \"Macros\"
  Step 3: choose a macro 
  Step 4: Click \"Run\"

Method II: 
----------
   If a macro is linked with a key such as a, 
      then hit Ctrl-a to run related macro
      see 27(3) for an example

Method III: 
-----------
   Click a linked button see c27(13) on how to 
      generate such a button
    >c27(13)

/////////////////////////
"

.macro4<-"How to edit a macro? 
/////////////////////////

 Step 1: Click \"Developer\"

 Step 2: Click \"Macros\"

 Step 3: choose a macro 

 Step 4: Click \"Edit\"

/////////////////////////
"

.macro5<-"The simplest Macro
/////////////////////////

 Step 1: Click \"Developer\"
 Step 2: click \"Macros\"
 Step 3: enter a name 
         [assume that you enter test]
 Step 4: click  \"Creat\"
 Step 5: [you will see, the following three lines
          the second line is a blank line]

         Sub test()

         End Sub

 Step 6: [replace the 2nd blank line with the following one]

         Range(\"B10\").Value = \"No\"
  
 Step 7: close 

 Meaning of the macro?
 Enter No for Cell B10
/////////////////////////
"

.macro6<-"When recording, short cut: Ctrl-a
/////////////////////////
 Step 1: Click \"Developer\"

 Step 2: click \"Record Macros\"

 Step 3: enter a name 
         Shortcut key:
                Ctrl + [a]

 Step 4: [your action here]

 Step 5: Click \"Stop Recording\"

 Now,  you can use Ctrl-a to run your recorded macro. 

/////////////////////////
"

.macro7<-"Assign a short-cut key 
/////////////////////////
Assume that you have a macro already and you want to 
 assign a shortcut key to it. 

 Step 1: Alt-F8
         [Alternatively]  \"Developer\" -> \"Macros\"

 Step 2: [ choose your macro ]

 Step 3: Click \"Options...\"

 Step 4: Assign a key

/////////////////////////
"


.macro8<-"Message box: Hello World!
/////////////////////////
 Step 1: Click \"Developer\"
 Step 2: Click \"Macros\"
 Step 3: enter a name, such as \"hello\"
 Step 4: Click \"Create\"
         You will see the following 3 lines:
         Note the 2nd line is a black line. 

   Sub hello()

   End Sub

 Step 5: [Replace the 2nd blank line with the following line]

   MsgBox \"Hello World!\"

 Step 6: Click \"File\" -> Close and return Microsoft Excel.


  Note that the Macro has 3 lines. 
    Sub hello()
        MsgBox \"Hello World!\"
    End Sub

/////////////////////////
"


.macro9<-"copy-and-paste others' Macro
/////////////////////////
 Step 1: Copy a macro. For example, copy the following 
         three lines

Sub test()
    Range(\"B10\").Value = \"No\"
End Sub

 Step 2: click \"Developer\" on your menu bar
 Step 3: click \"Macros\"
 Step 4: Enter any name such as tt, click \"Create\"
          Assume that youn entered \"tt\" as your macro 
          name. You will see the following lines. 

Sub tt()

End Sub

  Step 5: Replace all of them with your copied Macro
  Step 6: Click \"File\", \"Close and Return to Microsoft Excel\"

/////////////////////////
"


.macro10<-"ctrl-d to clean our spread sheet
/////////////////////////

 Step 1: click \"Developer\" on the menu bar

 Step 2: click \"Record Macro\"
 
 Step 3: for Short-cut enter
         d
         then click \"OK\"

 Step 4: choose a big area to delete 

 Step 5: move your cursor to cell A1

 Step 6: Click \"Stop Recording\"

     Now, you can hit Ctrl-d to clean your spreadsheet

/////////////////////////
"

.macro11<-"ctrl-h to unhide 
/////////////////////////

 Step 1: click \"Developer\" on the menu bar

 Step 2: click \"Record Macro\"
 
 Step 3: for Short-cut enter
         d
         then click \"OK\"

 Step 4: chose several columns to hide 

 Step 5: move your cursor to cell A1

 Step 6: Click \"Stop Recording\"

     Now, you can hit Ctrl-d to clean your spreadsheet

 Q: How about hide rows?

/////////////////////////
"


.macro12<-"ctrl-u to hide 
/////////////////////////

 Step 1: click \"Developer\" on the menu bar

 Step 2: click \"Record Macro\"
 
 Step 3: for Short-cut enter
         u
         then click \"OK\"

 Step 4: chose several columns to unhide

 Step 5: move your cursor to cell A1

 Step 6: Click \"Stop Recording\"

     Now, you can hit Ctrl-u to unhide your spreadsheet

 Q: How about unhide rows?

/////////////////////////
"

.macro13<-"File extension should be *.xlsm
/////////////////////////

When saving your Excel file which contains macros or VBAs

   the correct extension should be *.xlsm

/////////////////////////
"

.macro14<-"Link a button with a macro
/////////////////////////
Assume that we have a macro called \"clean\", see c27(21), 
which cleans our spreadsheet from A1 to N31. Now, 
we want to create a button linked to this macro. 

  Step 1: click \"Developer\" on your menu bar
  Step 2: click \"Insert\"
  Step 3: Under \"Form Controls\", choose the first image 
  Step 4: Move your cursor to a location beyond H columns, 
          highlight an area

  Step 5: Link your button to a macro name, i.e., the clean macro
          then click \"OK\"

          Now, you can use your macro by clicking it to clean an area of 
          A1 to H35. 

  Step 6: (optional) format your button 
           Right click the button you will see the following entries

           Cut
           Copy 
           Paste
           Edit Text
           Group
           Order
           Assign Macro
           Format Control

/////////////////////////
"


.macro15<-"Call Macros from a macro 
/////////////////////////

  Call another Macro from your macro


For example, we call a macro call two macros named, \"clean\" and \"hide\"
     from \"macro1\"


Sub macro1()
    call clean
    call hide
End Sub

/////////////////////////
"

.macro16<-"If left cell empty-> Done
/////////////////////////

Sub ifEmptyDone()
    If IsEmpty(ActiveCell.Offset(0, -1).Value) = True Then
      MsgBox \"Done\"
   Else:
       
       ActiveCell.Offset(1).Select
   End If
End Sub

/////////////////////////
"

.macro17<-"Move 1 cell to the right 
/////////////////////////

Sub move2right()
    ActiveCell.Offset(0, 1).Select
 End Sub

/////////////////////////
"

.macro18<-"Move n cell down/up and m cell right/left 
/////////////////////////

    ActiveCell.Offset(n,m).Select

Rule #1: n is for up or down
         m is for left or right 
             
Rule #2: n>0 for down, n=0 for current, n<0 for up 
         m>0 for right m=0 for current, m<0 for left 

Test the following one

Sub moveNandM()
    ActiveCell.Offset(4, -3).Select
 End Sub

/////////////////////////
"

.macro19<-"A set of one-line commands
/////////////////////////
Many simple commands
--------------------
  1) Select a cell            -> Range(\"B2\").Select
  2) Select columns           -> Columns(\"B:F\").Select
  3) Select rows              -> Rows(\"2:9\").Select
  4) Select cell/enter value  -> Range(\"B10\").Value = \"No\"
  5) value to current cell    -> ActiveCell.FormulaR1C1 = \"1\"
  6) Message box              -> MsgBox \"Hello World!\"
  7) Hide selected columns    -> Selection.EntireColumn.Hidden = True
  8) Hide selected rows       -> Selection.EntireRow.Hidden = True
  9) unhide selected columns  -> Selection.EntireColumn.Hidden = False
 10) unhide selected rows     -> Selection.EntireRow.Hidden = False
 11) call a macro             -> call MacroName
 12) move one cell below      -> ActiveCell.Offset(1).Select
 13) move one cell below      -> ActiveCell.Offset(1,0).Select
 14) move one cell up         -> ActiveCell.Offset(-1).Select
 15) move one cell up         -> ActiveCell.Offset(-1,0).Select
 16) move one cell right      -> ActiveCell.Offset(0,1).Select
 17) move one cell left       -> ActiveCell.Offset(0,-1).Select
 18) 5 down, 4 right          -> ActiveCell.Offset(5,4).Select
 19) Select  columns          -> Columns(\"A:P\").Select
 20) Select rows              -> Columns(\"2:100\").Select
 21) Copy from one to another -> Range(\"B5\") = Range(\"A1\")
 22) Copy to the current cell -> ActiveCell.FormulaR1C1 = Range(\"A1\")

/////////////////////////
"


.macro20<-"Links 
/////////////////////////

   https://analysistabs.com/excel-vba/chart-examples-tutorials/

   http://www.java2s.com/Code/VBA-Excel-Access-Word/Excel/MovetheactivecellbyusingActiveCellOffset.htm

Free Excel macros
   http://www.ozgrid.com/download/
 
   http://www.sowsoft.com/excel-macros.htm

   http://chandoo.org/wp/excel-vba/examples/

/////////////////////////
"

.macro21<-"Macro 4 clean
/////////////////////////

Sub clean()
    Range(\"A1:N31\").Select
    Selection.Delete Shift:=xlToLeft
    Range(\"A1\").Select
End Sub




 Note: to link Ctrl-d   to this macro, see c27(7)
       to link a buttom to this macro, see c27(14)

/////////////////////////
"

.macro22<-"Using Ctrl-a to run a macro
/////////////////////////

 Step 1: Click \"Developer\"

 Step 2: click \"Macros\"

 Step 3: enter a name  [assume that you enter 'test' as your name]

 Step 4: Click \"Option\" -> choose letter a

 Step 5: Create  [you will see]

         Sub test()

         End Sub

 Step 6: copy and paste the following one line
             
          Range(\"B10\").Value = \"No\"

         Note 1: the final result will be 
  
            Sub test()
                  Range(\"B10\").Value = \"No\"
            End Sub
  
        Note 2: using ctrl-a would call this macro

/////////////////////////
"





.macro22<-"Macro 4 hiding columns 
/////////////////////////

Sub hideColumns()
    Columns(\"B:F\").Select
    Selection.EntireColumn.Hidden = True
End Sub


/////////////////////////
"

.macro23<-"Macro 4 unhide columns 
/////////////////////////

Sub unhide()
    Columns(\"A:P\").Select
    Selection.EntireColumn.Hidden = False
End Sub

/////////////////////////
"

.macro24<-"Macro 4 hide rows
/////////////////////////

Sub hideRows()
    Rows(\"2:9\").Select
    Selection.EntireRow.Hidden = True
End Sub

/////////////////////////
"

.macro25<-"Macro 4 unhide rows
/////////////////////////

Sub unhideRows()
    Rows(\"2:9\").Select
    Selection.EntireRow.Hidden = False
End Sub

/////////////////////////
"

.macro26<-"Macro 4 creating a pie 
/////////////////////////

Sub PieB5B10()
  Dim cht As Object
  Set cht = ActiveSheet.ChartObjects.Add(Left:=300, Width:=300, Top:=10, Height:=300)
  With cht
  .Chart.SetSourceData Source:=Sheets(\"Sheet1\").Range(\"B5:B10\")
  .Chart.Type = xlPie
  End With
End Sub

/////////////////////////
"

.macro27<-"Macro: add 10 
/////////////////////////
Step 1: generte a column of value
Step 2: move the cursor to the first value
Step 3: run the following macro


Sub addTen()
 
 Do While IsEmpty(ActiveCell.Offset(0, -1)) = False
   Dim ticker As String
   Value = ActiveCell.Offset(0, -1).Value
   If IsEmpty(Value) = True Then
      MsgBox \"Done!!!\"
   Else:
       ActiveCell.Value = Value + 10
       ActiveCell.Offset(1).Select
   End If
 Loop
  
End Sub

/////////////////////////
"


.macro28<-"Macro 4 copying from anoter cell
/////////////////////////

Sub CopyCell1()
    Range(\"B5\") = Range(\"A1\")
End Sub

/////////////////////////
"

.macro29<-"Macro 4: copying to current cell 
/////////////////////////

Sub toCurrentCell()
    ActiveCell.FormulaR1C1 = Range(\"A1\")
End Sub

/////////////////////////
"

.macro30<-"Macro 4 generating five 9
/////////////////////////

Sub tt()
   Dim i As Integer
   For i = 1 To 5
       Cells(i, 1).Value = 9
   Next i
End Sub


/////////////////////////
"

.macro31<-"Macro 4 gerating 1, 3, 5, ..., 
/////////////////////////

Sub tt()

   Dim i As Integer
   For i = 1 To 100
         Cells(i, 1).Value = (i - 1) * 2 + 1
   Next i

End Sub

/////////////////////////
"

.macro32<-"Macro for doube loops
/////////////////////////

Sub tt()

   Dim i As Integer, j As Integer
   For i = 1 To 7
       For j = 1 To 2
           Cells(i, j).Value = 8
       Next j
   Next i

End Sub

/////////////////////////
"

.macro33<-"Macro for double loops
/////////////////////////
enter three values in A1, A2, and A3, e.g., 
5
4
90


Sub tt()
    Dim i As Integer, j As Integer, x As Integer
    i = Range(\"A1\").Value
    j = Range(\"A2\").Value
    x = Range(\"A3\").Value
    Cells(i, j).Value = x
    
End Sub

/////////////////////////
"

.macro34<-"Message box:mutiple lines 
/////////////////////////

Sub getVarCovMatrixHelp()

Dim t1 As String
Dim t2 As String
Dim t3 As String
Dim t4 As String
Dim t5 As String

t1 = \"1) Assume: exists a return matrix (n by k)\"
t2 = \"2) Name it as retMatrix\"
t3 = \"    note: if the name of retMatrix exists, then delete it\"
t4 = \"3) Select k by k cells\"
t5 = \"4) Click getVarCovMatrix\"

    MsgBox (t1 & vbCrLf & t2 & vbCrLf & t3 & vbCrLf & t4 & vbCrLf & t5)
    
End Sub

/////////////////////////
"

.macro35<-"Macro for printing your instruction 
/////////////////////////

Sub printInstruction()

Dim t1 As String
Dim t2 As String
Dim t3 As String
Dim t4 As String
Dim t5 As String

t1 = \"1) Assume: exists a return matrix (n by k)\"
t2 = \"2) Name it as retMatrix\"
t3 = \"    note: if the name of retMatrix exists, then delete it\"
t4 = \"3) Select k by k cells\"
t5 = \"4) Click getVarCovMatrix\"

    ActiveCell.FormulaR1C1 = t1
    ActiveCell.Offset(1, 0).Select
    ActiveCell.FormulaR1C1 = t2
    ActiveCell.Offset(1, 0).Select
    ActiveCell.FormulaR1C1 = t3
    ActiveCell.Offset(1, 0).Select
    ActiveCell.FormulaR1C1 = t4
    ActiveCell.Offset(1, 0).Select
    ActiveCell.FormulaR1C1 = t5
    ActiveCell.Offset(1, 0).Select
    
   
End Sub

/////////////////////////
"

.macro36<-"Input box and save it to A1 
/////////////////////////

Sub inputValue()
   Dim myValue As Variant
   myValue = InputBox(\"Give an input and save it to A1\")
   Range(\"A1\").Value = myValue
End Sub

/////////////////////////
"

.macro37<-"Macro 4 delete (A1:Z100)
/////////////////////////
Sub delete()
    Range(\"A1:Z100\").Select
    Selection.ClearContents
    Range(\"A1\").Select
End Sub

/////////////////////////
"

.macro38<-"Macro 4 unhide the 1st column and 1st row
/////////////////////////

Sub unhideFirst_col_row()
    Application.Goto Reference:=\"R1C1\"
    Selection.EntireColumn.Hidden = False
    Application.Goto Reference:=\"R1C1\"
    Selection.EntireRow.Hidden = False
    Range(\"A1\").Select
End Sub

/////////////////////////
"


.macro39<-"Macro 4 add_rwo_column (Binomial Tree option model)
/////////////////////////
' note: B1 contains the starting cell, such as f10
'       B2 contains the number of steps such as 7

Sub Add_row_column()
    Dim a As String
    Dim i, n As Integer
    Dim Range1 As Range
    a = Range(\"B1\").Value
    n = Range(\"B2\").Value
    For i = 1 To n
        Range(a).Offset(-1 - n, i).Value = i
    Next i
    For i = 1 To n + 1
        Range(a).Offset(i - n - 1, -1).Value = n - i + 1
    Next i
    For i = 1 To n
        Range(a).Offset(i, -1).Value = -i
    Next i
End Sub

/////////////////////////
"

.macro40<-"Macro 4 clean (Binomial tree option model)
/////////////////////////
' Example: 1) enter f10 in B1
'          2) enter 7   in B2 
'          3) click the Macro add_row_column
'          4) copy 40 to all cells
'          5) run this macro 

Sub clean()
    Dim a As String
    Dim i, b, n As Integer
    Dim Range1 As Range
    a = Range(\"B1\").Value
    n = Range(\"B2\").Value
    For j = 1 To n - 1  ' clean up/down triangle
        For i = 1 To n - j
           Range(a).Offset(-i - j, j).Value =\"\"
           Range(a).Offset(i + j, j).Value =\"\"
        Next i
        Range(a).Offset(0, j).Value =\"\" 'clean row 0
    Next j
    For i = 1 To n 'clean the last column and S0 column
            Range(a).Offset(-n + 2 * i - 1, n).Value =\"\"
            Range(a).Offset(i, 0).Value =\"\"
            Range(a).Offset(-i, 0).Value =\"\"
    Next i
    For j = 1 To n ' clean between last column
        For i = 1 To n
           b = -j + 2 * i - 1
           If b <= j Then
                Range(a).Offset(b, j).Value =\"\
           End If
         Next i
    Next j
End Sub

/////////////////////////
"


.macro441<-"Macro 4 for downloading financial statements
/////////////////////////
1) enter a ticker in cell A2, such as ibm
2) enter a staring position in cell A3, e.g., C10

Sub getFinStatements()
 sTicker = Range(\"A2\").Value
  If sTicker = \"\" Then
    MsgBox \"No ticker in A2\"
    Exit Sub
  End If
  
  starting = Range(\"A3\").Value
  If starting = \"\" Then
    MsgBox \"No starting cell in A3, such as C10\"
    Exit Sub
  End If

  Path = \"URL;http://www.advfn.com/stock-market/NASDAQ/\" & sTicker
  Path2 = Path & \"/financials?btn=annual_reports&mode=company_data\"
  With ActiveSheet.QueryTables.Add(Connection:=Path2, Destination:=Range(starting))
    .Name = \"financials?btn=annual_reports&mode=company_data\"
    .FieldNames = True
    .RowNumbers = False
    .FillAdjacentFormulas = False
    .PreserveFormatting = False
    .RefreshOnFileOpen = False
    .BackgroundQuery = True
    .RefreshStyle = xlInsertDeleteCells
    .SavePassword = False
    .SaveData = True
    .AdjustColumnWidth = True
    .RefreshPeriod = 0
    .WebSelectionType = xlSpecifiedTables
    .WebFormatting = xlWebFormattingAll
    .WebTables = \"6\"
    .WebPreFormattedTextToColumns = True
    .WebConsecutiveDelimitersAsOne = True
    .WebSingleBlockTextImport = False
    .WebDisableDateRecognition = False
    .WebDisableRedirections = False
    .Refresh BackgroundQuery:=False
End With
End Sub

//////////////////////////
"

.macUsers<-function(i){
"Objective: help Mac users

  i    Explanation
 ---   -------------
  1    How to install R
  2    clear your R consol
  3    Virtual Lab
  4    Chroombook, PC and Mac
  5    New security app install for macOS users
  6    'developer': how to enable the developer tab in excel for mac
  7    'developer': video (53seconds)
  8    'data analytics': Solver and Data Analysis Add-ins for Excel for Mac 2019
  9    'data analytics': (video) Data Analysis TookPak on Excel for a Mac

";.macUsers_(i)}

.mac<-.macUsers
.nMac<-9

.macUsers_<-function(i){
   if(i<=.nMac){
      x<-paste0('cat(.MAC', i,')')
      .runText(x)
   }else{
      cat("Invalid number: input value should between 1 and ",.nMac, "\n")
   }
}

.MAC1<-"How to install R on a Mac machine
/////////////////////////////////////////////////

 1) Agrawal,Abhinav, 2014, Programming in R - Getting Started - Installing R and RStudio on a Mac (5m59s)
     (v42k,s4k,t5:59)
       https://www.youtube.com/watch?v=Ywj6yNfc5nM

 2) Data Science with Tom, 2020, How to install R & RStudio on Mac in 2021 - step-by-step walkthrough
    (s1k,v5k,t4:40)
    https://www.youtube.com/watch?v=LanBozXJjOk

 3) Merchant,Emily, 2019, Installing R and RStudio on a Mac (Jan. 2019)
    (v36k,s58,t3:01)
    https://www.youtube.com/watch?v=EmZqlcKkJMM&t=1s

//////////////////////////////////////////////////
"


.MAC2<-"Clear R console 
/////////////////////////////////////////////////
For Mac users: 4 methods
------------------------
    a) source('http://datayyy.com/rpy.txt')
      .cls()

    b) # define your own function
       cls<-function()cat(rep(\"\\n\",50))
       cls()

    c) cat(\"\\014\")   # ??

    d) cat(\"\\f\")     # ??

For windows users: 
-----------------
   a) Ctrl-l         # combination of the Ctrl-key and letter L key

   b) source('http://datayyy.com/rpy.txt')
      .cls()

   c) # define your own function
      cls<-function()cat(rep(\"\\n\",50))
      cls()

//////////////////////////////////////////////////
"

.MAC3<-"Virtual Lab for Mac users 
/////////////////////////////////////////////////
 The Virtual Lab is a cloud-based Windows computer lab that provides users 
     remote access to hardware and software that they would otherwise have to 
     install themselves on their own systems, or visit a computer lab to use. 
 
 Type the following command to see more

   .virtualLab   # or 

   .vl           # short-cut for .virtualLab, where l is lowercase of letter L)

   .v1           # short-cut for .virtualLab, where 1 is number 1 

//////////////////////////////////////////////////
"

.MAC4<-"Laptop vs. Chromebook
/////////////////////////////////////////////////
 Laptop vs. Chromebook: What's the difference and which best fits your needs
    Some Chromebooks can go toe-to-toe with Mac and Windows laptops, but they
    may not be best for everyone. Here's how to choose what's right for you.

  Chromebooks are laptops and two-in-ones running on Google's Chrome operating 
     system. The hardware might look like any other laptop, but the minimalistic,
     web-browser-based Chrome OS is a different experience from the Windows 
     and MacOS laptops you're likely used to. Whether you're considering 
     switching to one from a Windows laptop or MacBook, your kid received 
     one from their school or you're simply Chrome OS curious, here's everything you need to know. 

 For more, see the following link
     https://www.cnet.com/tech/computing/laptop-vs-chromebook-whats-the-difference-and-which-best-fits-your-needs/

//////////////////////////////////////////////////
"

.MAC5<-"New security app install for macOS users
/////////////////////////////////////////////////
 CIT will install a new app, called Nudge, on campus-owned macOS 
     computers on Tuesday, October 26. Nudge reminds users to 
     install critical macOS security patches in a timely manner.

 It will become increasingly persistent as a CIT-defined deadline 
     to install an update approaches. Nudge is also configured to 
     not interrupt active classroom work in an effort to minimize 
     disruption. For more on what to expect with Nudge, please 
     review the following Self Help article. Thank you for your
     help in keeping our campus-managed macOS devices as secure as possible.

//////////////////////////////////////////////////
"

.MAC6<-"How to enable the developer tab in excel for mac
/////////////////////////////////////////////////
Instructions

  Step 1: Open Excel for Mac.

  Step 2: Click the Excel tab at the top of the screen.

  Step 3:Choose the Preferences option.

  Step 4: Select the Ribbon & Toolbar option.

  step 5: Check the box to the left of Developer in the right column.

  Step 6: Click the Save button.

 Notes: When you are adding the Developer tab in Excel for Mac, the Main 
        Tabs column on the Ribbon & Toolbar menu lets you edit or remove 
        some of the other tabs as well. If there is something that you 
        want to add, or something that you never use, it's possible to 
        edit the ribbon as needed.

     https://www.solveyourtech.com/how-to-enable-the-developer-tab-in-excel-for-mac/

//////////////////////////////////////////////////
"

.MAC7<-"video:Enable Developer Tab In Excel 2016 for Mac
/////////////////////////////////////////////////
  
 UrBizEdge,2016,Enable Developer Tab In Excel 2016 for Mac
     (v58k,t0:53,s4.1k)
     https://www.youtube.com/watch?v=KZ4xTecAxZ4

//////////////////////////////////////////////////
"

.MAC8<-"Solver and Data Analysis Add-ins for Excel for Mac 2019
/////////////////////////////////////////////////
 
 Solver and Data Analysis Add-ins for Excel for Mac 2019
 
   https://support.ivey.ca/s/article/Solver-and-Data-Analysis-Add-ins-for-Excel-for-Mac-2019

//////////////////////////////////////////////////
"

.MAC9<-"video:
/////////////////////////////////////////////////

 Carbone,Christopher,2020,Data Analysis TookPak on Excel for a Mac
     (v10k,t1:00,s137)
     https://www.youtube.com/watch?v=BvgCKKq6FRE

//////////////////////////////////////////////////
"




.mimicExcel<-function(){
"
 *-----------------------------------------------------*
 * Mimic Excel      by Yuxing Yan (modifed 1/2/2020)   *
 *-----------------------------------------------------*
 * Functions        Utilities                          *
 *-----------------------------------------------------*
 * .pvExcel         .pvExcelNoSignConvention           *
 * .fvExcel         .fvExcelNoSignConvention           *
 * .pmtExcel        .pmtExcelNoSignConvention          *
 * .nperExcel       .nperExcelNoSignConvention         *
 * .rateExcel       .rateExcelNoSignConvention         *
 * .npvExcel        .npv_f                             *
 * .effectExcel     .effectYan                         *
 * .days360Excel                                       *
 * .priceExcel      .shortCut                          *
 * .yieldExcel                                         *
 *-----------------------------------------------------*
 * >.pvExcel         # find out the usage of pvExcel   *
 * >.mimicExcel      # back to this menu               *
 * >.cf              # back to the main menu           *
 *-----------------------------------------------------*

";.mimicExcel_()}

.mimicexcel_<-function(){
cat(

" 
 *-----------------------------------------------------*
 * Mimic Excel      by Yuxing Yan (modifed 1/2/2020)   *
 *-----------------------------------------------------*
 * Functions        Utilities                          *
 *-----------------------------------------------------*
 * .pvExcel         .pvExcelNoSignConvention           *
 * .fvExcel         .fvExcelNoSignConvention           *
 * .pmtExcel        .pmtExcelNoSignConvention          *
 * .nperExcel       .nperExcelNoSignConvention         *
 * .rateExcel       .rateExcelNoSignConvention         *
 * .npvExcel        .npv_f                             *
 * .effectExcel     .effectYan                         *
 * .days360Excel                                       *
 * .priceExcel      .shortCut                          *
 * .yieldExcel                                         *
 *-----------------------------------------------------*
 * >.pvExcel         # find out the usage of pvExcel   *
 * >.mimicExcel      # back to this menu               *
 * >.cf              # back to the main menu           *
 *-----------------------------------------------------*

")
}

.me<-.mimicExcel


.officeHours<-function(){
"Topic: DANL100, FNCE311 and FNCE316 
Time: Jan 26, 2022 10:00 AM Eastern Time (US and Canada)
        Every week on Mon, Wed, Fri, until May 18, 2022, 49 occurrence(s)
        Jan 26, 2022 10:00 AM,       Jan 28, 2022 10:00 AM,       Jan 31, 2022 10:00 AM
        Feb 2, 2022 10:00 AM,        Feb 4, 2022 10:00 AM,        Feb 7, 2022 10:00 AM
        Feb 9, 2022 10:00 AM,        Feb 11, 2022 10:00 AM,       Feb 14, 2022 10:00 AM
        Feb 16, 2022 10:00 AM,       Feb 18, 2022 10:00 AM,       Feb 21, 2022 10:00 AM
        Feb 23, 2022 10:00 AM,       Feb 25, 2022 10:00 AM,       Feb 28, 2022 10:00 AM
        Mar 2, 2022 10:00 AM,        Mar 4, 2022 10:00 AM,        Mar 7, 2022 10:00 AM
        Mar 9, 2022 10:00 AM,        Mar 11, 2022 10:00 AM,       Mar 14, 2022 10:00 AM
        Mar 16, 2022 10:00 AM,       Mar 18, 2022 10:00 AM,       Mar 21, 2022 10:00 AM
        Mar 23, 2022 10:00 AM,       Mar 25, 2022 10:00 AM,       Mar 28, 2022 10:00 AM
        Mar 30, 2022 10:00 AM,       Apr 1, 2022 10:00 AM,        Apr 4, 2022 10:00 AM
        Apr 6, 2022 10:00 AM,        Apr 8, 2022 10:00 AM,        Apr 11, 2022 10:00 AM
        Apr 13, 2022 10:00 AM,       Apr 15, 2022 10:00 AM,       Apr 18, 2022 10:00 AM
        Apr 20, 2022 10:00 AM,       Apr 22, 2022 10:00 AM,       Apr 25, 2022 10:00 AM
        Apr 27, 2022 10:00 AM,       Apr 29, 2022 10:00 AM,       May 2, 2022 10:00 AM
        May 4, 2022 10:00 AM,        May 6, 2022 10:00 AM,        May 9, 2022 10:00 AM
        May 11, 2022 10:00 AM,       May 13, 2022 10:00 AM,       May 16, 2022 10:00 AM
        May 18, 2022 10:00 AM

Join Zoom Meeting
https://geneseo.zoom.us/j/82259544407?pwd=eWNnQWl5ZUpqWVd5dzlGNTJWcHo2dz09

Meeting ID: 822 5954 4407
Passcode: aaa

     Alternatively, http://datayyy.com/doc_txt/officeHours2022sring.txt 

";.officeHours_()}

.oh<-.officeHours

.officeHours_<-function(){
cat("

Topic: DANL100, FNCE311 and FNCE316 
Time: Jan 26, 2022 10:00 AM Eastern Time (US and Canada)
        Every week on Mon, Wed, Fri, until May 18, 2022, 49 occurrence(s)
        Jan 26, 2022 10:00 AM,        Jan 28, 2022 10:00 AM,        Jan 31, 2022 10:00 AM
        Feb 2, 2022 10:00 AM,        Feb 4, 2022 10:00 AM,        Feb 7, 2022 10:00 AM
        Feb 9, 2022 10:00 AM,        Feb 11, 2022 10:00 AM,        Feb 14, 2022 10:00 AM
        Feb 16, 2022 10:00 AM,        Feb 18, 2022 10:00 AM,        Feb 21, 2022 10:00 AM
        Feb 23, 2022 10:00 AM,        Feb 25, 2022 10:00 AM,        Feb 28, 2022 10:00 AM
        Mar 2, 2022 10:00 AM,        Mar 4, 2022 10:00 AM,        Mar 7, 2022 10:00 AM
        Mar 9, 2022 10:00 AM,        Mar 11, 2022 10:00 AM,        Mar 14, 2022 10:00 AM
        Mar 16, 2022 10:00 AM,        Mar 18, 2022 10:00 AM,        Mar 21, 2022 10:00 AM
        Mar 23, 2022 10:00 AM,        Mar 25, 2022 10:00 AM,        Mar 28, 2022 10:00 AM
        Mar 30, 2022 10:00 AM,        Apr 1, 2022 10:00 AM,        Apr 4, 2022 10:00 AM
        Apr 6, 2022 10:00 AM,        Apr 8, 2022 10:00 AM,        Apr 11, 2022 10:00 AM
        Apr 13, 2022 10:00 AM,        Apr 15, 2022 10:00 AM,        Apr 18, 2022 10:00 AM
        Apr 20, 2022 10:00 AM,        Apr 22, 2022 10:00 AM,        Apr 25, 2022 10:00 AM
        Apr 27, 2022 10:00 AM,        Apr 29, 2022 10:00 AM,        May 2, 2022 10:00 AM
        May 4, 2022 10:00 AM,        May 6, 2022 10:00 AM,        May 9, 2022 10:00 AM
        May 11, 2022 10:00 AM,        May 13, 2022 10:00 AM,        May 16, 2022 10:00 AM
        May 18, 2022 10:00 AM

Join Zoom Meeting
https://geneseo.zoom.us/j/82259544407?pwd=eWNnQWl5ZUpqWVd5dzlGNTJWcHo2dz09

Meeting ID: 822 5954 4407
Passcode: aaa

     Alternatively, http://datayyy.com/doc_txt/officeHours2022sring.txt 
")}













# https://book.ivo-welch.info/slides/c02-tvm-1.pptx
.powerPointSlide<-function(i){
"Objective: get a PowerPoint slide
  i  chapter                 i     chapter
  -  ------------------     ---  -----------------------
  1  c02-tvm-1               19    c12-effmkts              
  2  c02-tvm-2               20    c13-1-npv-moments        
  3  c03-1-perpetuities      21    c13-2-npv-cocavg         
  4  c03-2-annuities         22    c13-3-npv-seqchoice      
  5  c04-capbudgrules        23    c13-4-npv-externalities  
  6  c05-inflation           24    c13-5-npv-biases         
  7  c05-yieldcurve          25    c14-valuation            
  8  c06-1-uncertainty       26    c15-comparables          
  9  c06-2-riskypayoffs      27    c16-capstruct-intro      
 10 c07-1-invintro           28    c17-capstruct-perfectmkt 
 11 c07-2-egguilibrium       29    c18-1-capstruct-corptaxes
 12 c08-invest               30    c18-2-capstruct-bothtaxes
 13 c09-benchmarking         31    c19-1-lean               
 14 c10-1-capmbasics         32    c19-2-fat                
 15 c10-2-capmevidence       33    c19-3-rest               
 16 c11-1-imperfect-concepts 34    c20-payout               
 17 c11-2-imperfect-tour     35    c21-proformas            
 18 c11-3-imperfect-taxes     
    Source: https://book.ivo-welch.info/slides/

 Example 1>.powerPoointSlide(2)
 Example 2>.ppt(4) 
 
";powerPointSlide_(i)}

.ppt<-.powerPointSlide

powerPointSlide_<-function(i){
   .path3<-"http://datayyy.com/cf/"
    path<-'https://book.ivo-welch.info/slides/'

    if(exists('.slidePPTX')==FALSE){
        .tempPath<-paste0(.path3,"slidePPTX.RData")
        .slidePPTX<-get(load(url(.tempPath)))
    }

    n<-nrow(.slidePPTX)
    if(i>0 & i<=n){
        infile<-paste0(path,.slidePPTX[i,1],".pptx")
        browseURL(infile)
    }else{
       cat(" Input should be between 1 and ", n, "\n")
    }
}

.preFinal<-function(i){
" i  Pre Final 
  -  -------------------------------------
  1  Chapters covered and how to prepare?
  2  Date, time, and computational tools
  3  Format of the final exam 
  4  Prepare your own formula sheet
  5  Submit an Excel file to the Canvas Dropbox
  .  ...
  .  ...
  .  ... 
  .  ... 
 18  Part I:  Example  #13 
 19  Part I:  Example  #14 

 26  Part II: Example  #1
 27  Part II: Example  #2
 28  Solutions to MCs

 Example #1:> .preFinal  # find out the list 
              .pf        # short-cut 

 Example #2:> .pf(1)     # see the first explanation 

 Example #3:> .pf(20)    # the last one 

";.preFinal_(i)}

.nPreFinal<-28
.pf<-.preFinal

.prefinal<-.preFinal

.preFinal_<-function(i){
   if(i<=.nPreFinal){
      .x<-paste('cat(.preFinalP',i,')',sep='')
      .runText(.x)
   }else{
     cat("Invalid number: input value should between 1 ",.nPreFinal, " \n")
   }
}

.preFinalP1<-"Chapters covered and how to prepare?
///////////////////////////////////////////
   %40   before the midTerm 
   %60   after  the midTerm

   %40   chapters: 1 - 6
   %60   Chapters: 7-12, 14, and 15

How to prepare?
-------------
   1) Read related chapters  

   2) Read those entries, such as .c7(2) 

   3) Understand several related Excel functions 

   4) Try a few end-of-chapter problems 

///////////////////////////////////////////
"

.preFinalP2<-"Date,time, zoom link, and computational tools
///////////////////////////////////////////
Date and time
----------------
     Tuesday, May 17th at 3:30pm
        http://datayyy.com/doc_txt/finalExam311.txt 

Computation tools
-----------------
  1) Excel 
  2) Financial calculator
  3) Ordinary calculator
  4) R 
///////////////////////////////////////////
"

.preFinalP3<-"Format of the mid-term
/////////////////////////////////////
There are two parts:

Part I: multiple choice questions
---------------------------------
       There about 20 multiple choice questions (1 point each) 

       A, B, C
       or True False

Part II:  
-------------------
      Question: usually 2 questions plus one bonus 
                Each regular question is worth 5 points
                The bonus has 2 points 
                (you can switch the bonus with a regular one)
  
Weighting scheme. 
----------------
      50% of Part I and 50% of Part II

/////////////////////////////////////
"

.preFinalP4<-"prepare your own formula sheet
/////////////////////////////////////
It is a good idea to have a formula sheet 

You can write 

    1) formulae

    2) definitions

    3) examples

    4) virtually anything

/////////////////////////////////////
"

.preFinalP5<-"submit an Excel file to the Dropbox on Canvas
/////////////////////////////////////
For your Excel file name, it should be 

  firstName_last_name.xlsx

          or 

  firstName_last_name.xlsm

  Warning: don't submit a csv file. 

           John_Doe.csv  [wrong!!!!]
  
/////////////////////////////////////
"

.preFinalP6<-"Part I: example #1
/////////////////////////////////////
 Putting two risky investments (projects) together, 
     we cannot possibly form a risk-free investment 
     (portfolio). 

  a. True

  b. False

/////////////////////////////////////
"

.preFinalP7<-"Part I: example #2
/////////////////////////////////////
  For a big firm, its market risk is higher 
     than its firm specific risk.

     a. True

     b. False

     c. Not comparable

     d. It is true for a small firm.

     e. None of the above 

///////////////////////////////////////////
"

.preFinalP8<-"Part I: example #3 
///////////////////////////////////////////
  You bought a stock two years ago for $50 per share 
      and sold it today for $55 per share. It paid a $1 per 
      share dividend today. What is your average annual return?

     a. 10%

     b. 12%

     c. 5.8%

     d. 6.0% 
 
     e. None of the above 

///////////////////////////////////////////
"

.preFinalP9<-"Part I: example #4 
/////////////////////////////////////
   What is the name of the model that determines the present value of 
        a stock based on its next dividend, the dividend growth rate, and 
        the applicable discount rate?
   
     a) zero growth
 
     b) dividend growth

     c) capital pricing

     d) earnings capitalization

     e) discounted dividend

///////////////////////////////////////////
"

.preFinalP10<-"Part I: example #5 
/////////////////////////////////////
 Which one of following is the rate at which a stock's
      price is expected to appreciate? 

      a. current yield

      b. total return

      c. dividend yield
   
      d. capital gains yield

      e. coupon rate

///////////////////////////////////////////
"

.preFinalP11<-"Part I: example #6 
///////////////////////////////////////////

  The average beta for individual stocks is equal to

       a. 0

       b. 1

       c. Unable to answer since we don't know the market expected return. 

       d. Unable to answer since we don't know the market volatility

       e. None of the above 

///////////////////////////////////////////
"

.preFinalP12<-"Part I: example #7 
/////////////////////////////////////

  Standard deviation measures which type of risk? 

    a. total risk

    b. non-diversifiable

    c. unsystematic

    d. systematic

    e. None of the above 

/////////////////////////////////////
"

.preFinalP13<-"Part I: example #8 
/////////////////////////////////////
 Last year, T-bills returned 1.2% while your investment in 
    large-company stocks earned an average of 7.5%
    Which one of the following terms refers to the difference 
    between these two rates of return? 

    a) 	geometric return

    b) 	risk premium

    c) 	arithmetic

    d) 	standard deviation

    e) 	variance

/////////////////////////////////////
"

.preFinalP14<-"Part I: example #9
///////////////////////////////////////////
 Which one of the following categories of securities 
     has had the most volatile returns over the period 1926-2007?

    a) long-term corporate bonds  
    
    b) large-company stocks

    c) intermediate-term government bonds

    d) US Treasury bills

///////////////////////////////////////////
"

.preFinalP15<-"Part I: example #10
///////////////////////////////////////////
  Which of the following statements is false?

     a. The variance increases with the magnitude of the 
            deviations from the mean

     b. The variance is the expected squared deviation from the mean

     c. Two common measures of the risk of a probability 
            distribution are its variance and standard deviation

     d. If the return is riskless and never deviates from 
            its mean, the variance is equal to one. 

///////////////////////////////////////////
"

.preFinalP16<-"Part I: example #11
///////////////////////////////////////////

 The definition of big or small firms 
      is based on

     a. the number of employees

     b. the total sales

     c. the market capitalization 

     d. the price of stock 

     e. None of the above 

///////////////////////////////////////////
"

.preFinalP17<-"Part I: example #12
///////////////////////////////////////////
  To calculate an annualized risk (standard deviation), 
     we can download historical monthly or daily price data. 
     To annualize a standard deviation, we use the following method. 

     a) std_annual=   12 *std_monthly
        std_annual=  365 *std_daily

     b) std_annual= sqrt(12) *std_monthly
        std_annual= sqrt(365) *std_daily

     c) std_annual=   12 *std_monthly
        std_annual=  252 *std_daily

     d) std_annual= sqrt(12)  *std_monthly
        std_annual= sqrt(252) *std_daily

     e) None of the above

///////////////////////////////////////////
"

.preFinalP18<-"Part I: example #13
///////////////////////////////////////////
  DuPont's Identity is used to measure
 
     a) ROE (profitability)
 
     b) The impact of two ratios: ROE vs. A/E

     c) The impact of three ratios: NI/S, S/A and A/E

     d) None of the above 

///////////////////////////////////////////
"

.preFinalP19<-"Part I: example #14
///////////////////////////////////////////

  ROA is defined as 

    a) Return of Annual

    b) Rate of Asset

    c) Real Open Asset

    d) Return on Asset

    e) None of the above 

///////////////////////////////////////////
"

.preFinalP20<-"Part I: example #15
///////////////////////////////////////////
  CAPM is defined as

   a) Capital All Price Mode

   b) Capital Asset Price Model

   c) Capital Asset Pricing Model

   d) None of the above 

///////////////////////////////////////////
"

.preFinalP21<-"Part I: example #16
///////////////////////////////////////////
  The formula for CAPM is given below. Below, 
      IBM is used as an example. 

   a)  R(ibm) = Rf - beta* (Rm-Rf)

   b)  R(ibm) = Rf + beta* (Rm-Rf)

   c)   Rm = alpha + beta* R(ibm)

   d)   None of the above 

///////////////////////////////////////////
"

.preFinalP22<-"Part I: example #17
///////////////////////////////////////////
   Total risk and market risk are defined by two Greek letters. 

     a) beta is for total risk, sigma is for market risk

     b) sigma is for total risk, sigma-beta is for market risk

     c) sigma-beta is for total risk, beta is for market risk

     d) sigma is for total risk, beta is for market risk

     e) None of the above

///////////////////////////////////////////
"

.preFinalP23<-"Part I: example #18
///////////////////////////////////////////
 The beta of a portfolio will be the 
     weighted individual stock's beta.

   a)   True

   b)   False

///////////////////////////////////////////
"

.preFinalP24<-"Part I: example #19
///////////////////////////////////////////
  Assume that w_debt (w_equity) is the weight of debt (equity) 
    and R_debt (R_equity) is the required rate of return for 
    debt (equity). For companies, the cost of capital, Rc, 
    could be defined as 

     a) Rc= w_debt*R_debt + R_equity

     b) Rc= w_equity*R_debt + w_debt*R_equity

     c) Rc= w_debt*R_debt + w_equity*R_equity

     d) Rc= R_debt + w_equity*R_equity

     e) None of the above

///////////////////////////////////////////
"

.preFinalP25<-"Part I: example #20
///////////////////////////////////////////

 If the Market Efficient Hypothesis (MEH) is true,
   we should not expect the 'January Effect'. 

   a) True

   b) False

///////////////////////////////////////////
"

.preFinalP26<-"Part II: example #1
///////////////////////////////////////////
 You find a stock that had returns of 4 percent, -5 percent, -15 percent, 
     and 16  percent for four of the last five years. 

  The average return of the stock for the 5-year period was 13 percent. 

  What is the total risk of the stock based on this five-year period?

///////////////////////////////////////////
"

.preFinalP27<-"Part II: example #2
///////////////////////////////////////////
 For IBM, download its latest several years' balance-sheet 
    and income statements. 

  1) Estimate its ROA and ROE
  2) Comment on your above results
  3) Estimate Dupont's Identity
  4) Comment on your results

 Source of data: .getBS10
                 .getIS10

 Alternatively, 
                .getBSannual
                .getISannual
///////////////////////////////////////////
"

.preFinalP28<-"Solutions to MCs
////////////////////////////////

.pf(6)   example #1:  b
.pf(7)   example #2:  c
.pf(8)   example #3:  c
.pf(9)   example #4:  b
.pf(10)  example #5:  c

.pf(11)  example #6:  b
.pf(12)  example #7:  a
.pf(13)  example #8:  b
.pf(14)  example #9:  b
.pf(15)  example #10: d

.pf(16)  example #11:  c
.pf(17)  example #12:  b
.pf(18)  example #13:  c
.pf(19)  example #14:  d
.pf(20)  example #15:  c

.pf(21)  example #16:  b
.pf(22)  example #17:  d
.pf(23)  example #18:  a 
.pf(24)  example #19:  c
.pf(25)  example #20:  a

///////////////////////////////////////////
"
.preMidTerm<-function(i){
" i  Pre midterm 
  -  -------------------------------------
  1  Chapters covered and how to prepare?
  2  Computational tools
  3  Format of the mid-term 
  4  prepare your own formula sheet
  5  submit an Excel file to the D2L Dropbox
  6  Part I: example #1
  .  ...
 19  Part I: example #14
 20  Part II: Example #1 
 21  Answers to the multiple-choice questions

 Example #1:> .pmt     # find out the list 

 Example #2:> .pmt(1)  # see the first explanation 

 Example #3:> .pmt(20) # the last one 

 Example #4:> .pmt(21) # Answers to the multiple-choice questions

";.preMidTerm_(i)}

.nPreMidTerm<-21
.pmt<-.preMidTerm

.premidterm<<-.preMidTerm

.preMidTerm_<-function(i){
   if(i<=.nPreMidTerm){
      .x<-paste('cat(.pmtP',i,')',sep='')
      .runText(.x)
   }else{
     cat("Invalid number: input value should between 1 ",.nPreMidTerm, " \n")
   }
}

.pmt<-.preMidTerm

.pmtP1<-"Chapters covered and how to prepare?
///////////////////////////////////////////
The midterm would cover
------------------------
   Chapters: 1 - 6

How to prepare?
-------------
   1) Read related chapters 
   2) Read lecture notes (slides) 
   3) Read those entries, such as .c1(2) 
   4) Understand related Excel functions 
   5) Try a few similar questions 
   6) Understand assigned data cases 

  Date:  3/9/2022
  Time:  4:00pm - 5:15pm
  Location: SH338

///////////////////////////////////////////
"

.pmtP2<-"Computational tools
///////////////////////////////////////////

  1) Excel 

  2) Financial calculator

  3) Ordinary calculator

  4) R 

///////////////////////////////////////////
"

.pmtP3<-"Format of the mid-term
/////////////////////////////////////
There are two parts:

Part I: multiple choice questions
---------------------------------
       There about 20 multiple-choice questions (1 point each) 

       A, B, C
       or True False

Part II:  
-------------------
      Question: 2 questions 

      Each question is worth 5 points
   
Weighting scheme. 
----------------
      50% of Part I and 50% of Part II

/////////////////////////////////////
"

.pmtP4<-"Prepare your own formula sheet
/////////////////////////////////////
You can bring a page of formula sheet 

You can write 
    1) formulae

    2) definitions

    3) examples

    4) virtually anything

The page should be  

   1) one-sided

   2) measuring 8.5\" by 11\"

   Hand-in your formula sheet at the end of the mid-term. 

/////////////////////////////////////
"

.pmtP5<-"Submit an Excel to the Dropbox on Canvas
/////////////////////////////////////
  For your Excel file name, it should be 

         firstName_last_name.xlsx

  Submit your Excel file to the Dropbox on Canvas

         Warning: Do not submit a csv file. 
            John_Doe.csv  (wrong!!!!!!)
  
/////////////////////////////////////
"
.pmtP6<-"Part I: Example #1
/////////////////////////////////////
 For finance, we have many implied assumptions. 

   I)  Stock markets are efficient
  II)  A typical investor is rational
          (Most investors are rational)
  III) No arbitrage opportunity
         (Arbitrage opportunities will vanish very quickly)
  IV)  Law of one price

   a) I and IV
  
   b) I, II and III

   c) I and IV

   d) II and IV

   e) All of the above 

/////////////////////////////////////
"

.pmtP7<-"Part I: Example #2
/////////////////////////////////////
  When the interest rate is a non-negative value, present 
      value is always lower than a future value. 

   a) True

   b) False

/////////////////////////////////////
"

.pmtP8<-"Part I: example #3
/////////////////////////////////////
 A normal project is defined as:

  a) Cash inflow(s) first, then cash outflow(s)

  b) One cash outflow then cash outflow(s), and cash inflow

  c) Cash outflow(s) first, then cash inflow(s)
 
  d) The direction of future cash flows have to change twice

  e) None of the above

/////////////////////////////////////
"

.pmtP9<-"Part I: example #4 
///////////////////////////////////////////

 Aassume that we will receive $100 in 5 years. 
 The annual rate is 1.3%. What is the correct 
 Excel formula for estimating a present value?

  a.  =pv(1.3, 5, 100)

  b.  =pv(5, 1.3, 100)

  c.  =pv(0.13, 5, 0, 100)

  d.  =pv(0.013, 5, 100)

  e.  None of the above 

/////////////////////////////////////
"

.pmtP10<-"Part I: example #5 
/////////////////////////////////////
 NPV Rule is defined as when the Net Present Value of a 
     project is  higher than 1, we accept it (the project).
     Otherwise, we reject it (the project). 

  a) True

  b) False

/////////////////////////////////////
"

.pmtP11<-"Part I: example #6 
/////////////////////////////////////
 When the NPV and IRR rules have different results 
    (one accepts the project while the second one 
    rejects it), the IRR rule dominates the NPV rule. 

  a) True

  b) False 

/////////////////////////////////////
"

.pmtP12<-"Part I: example #7 
///////////////////////////////////////////
 Assume that we have infinite constant payments of $100 
   per month. The annual rate is 2.3%. We can apply the 
   following formula to estimate  its present value:   

                 100
           pv=-------
               0.023/12

   a) True
 
   b) False   

///////////////////////////////////////////
"

.pmtP13<-"Part I: example #8 
/////////////////////////////////////
   If our investment was tripled in 5 years, 
    what is the implied annual rate?

    a)  10% per year

    b)  30% per year 

    c)  60% per year

    d)  24.57%

    e)  We don't have enough information. 

/////////////////////////////////////
"

.pmtP14<-"Part I: example #9
///////////////////////////////////////////
  For a zero coupon bond, since the coupon rate is 
      zero, its annual average return is zero as well. 

   a) True

   b) False 

///////////////////////////////////////////
"

.pmtP15<-"Part I: example #10
///////////////////////////////////////////
  We have an APR (Annual Percentage Rate) of 2.3%, 
    compounded semi-annually, what is the APR compounded 
    monthly?

  a)  3.83333%
  
  b)  2.3%

  c)  2.2890560%

  d)  1.2567901%

  e)  None of the above 
 
///////////////////////////////////////////
"

.pmtP16<-"Part I: example #11
///////////////////////////////////////////
 The Excel effect() funtion can be used to 
     estimate an effective monthly rate for
     a given APR and its corresponding frequency. 

  a) True

  b) False

///////////////////////////////////////////
"

.pmtP17<-"Part I: example #12
///////////////////////////////////////////
 To estimate an effective rate, we could apply one of 
    the following formulae. Assume that APR1, m1, and m2 are given. 
    APR1 is the Annual Percentage Rate 1
    m1   is the compouding frequency for APR1
    m2   is the compouding frequency for our targeted effective rate 

   a) effect(m2) = APR1/m1 * m2

   b) effect(m2) = (1+ APR1/m1)^ (m1/m2)

   c) effect(m2) = (1+ APR1/m1)^ (m1/m2) -1

   d) effect(m2) =(1+ APR1/m2)^ (m2/m1) -1

   e) None of the above 

////////////////////////////////
"

.pmtP18<-"Part I: example #13
///////////////////////////////////////////
  For companies, the cost of debt is lower than the cost of equity since 

      a)  banks usually have a high credit rating 

      b)  the debt has a lower risk 

      c)  the debt holders do not get dividends  

      d)  the debt holders receive interest payments 

/////////////////////////////////////////////////
"

.pmtP19<-"Part I: example #14
///////////////////////////////////////////
What is the present value of a perpetuity which has an equal payment of $80 at 
     the end of each year, the appropriate discount is 5.6% per year and the first 
     payment occurs at the end of 5th year?

      a)	 $14.29 

      b)	 $1428.57

      c)	 $1087.88

      d)	 $1148.81

/////////////////////////////////////////////////
"
.pmtP20<-"Part II: example #1
////////////////////////////////
Part II: Two questions (5 points each) plus a bonus (extra 2 points)

Q1. 
  After three-month intensive search, John Doe has found his dream house 
     with a price tag of $300,000. Assuming that the down payment is 20% 
    ($60,000), he has to borrow the rest ($240,000). Today, 2/9/2012, the
     annual rate quoted by a lender (bank) is 3.875% per year (compounded monthly). 

   a) What is his monthly payment for a fixed rate 30-year mortgage?

   b) If the lender (bank) charges 1% of the loan value as the origination fee,
      what is the true interest rate (APR, Annual Percentage Rate) John has to pay?

///////////////////////////////////////////
"

.pmtP21<-"Answers to the multiple-choice questions. 
///////////////////////////////////////////

6     e
7     a
8     c
9     e
10    b

11    b
12    b
13    d
14    b
15    c

16    b
17    c
18    b
19    d

///////////////////////////////////////////
"



.pmtP886<-"Part I: example #11
///////////////////////////////////////////
  The current ratio is defined as CA/CL, where CA is the Current
      Assets and CL is the Current Liability. It is used to 
      measure a company's 

     a) Profitability

     b) Liquidity
 
     c) leverage 

     d) Risk
   
     e) None of the above 

///////////////////////////////////////////
"
.pmtP887<-"Part I: example #12
///////////////////////////////////////////
  The debt/equity ratio is used to measure of one of the 
      following properties. 

     a) Profitability

     b) Liquidity
 
     c) leverage 

     d) Risk
   
     e) None of the above 

////////////////////////////////
"

" old one

     x<-paste('cat(.EX', .chapter,'P',i,')',sep='')

"
.printEachQ<-function(.chapter,i,.n){
   if(i<=.n){
      x<-paste('cat(.C', .chapter,'EXPLAIN',i,')',sep='')
      .runText(x)
   }else{
      cat("Invalid number: input value should between 1 and ",.n, "\n")
   }
}
.n_students=30
.rc<-function(){
"
 *---------------------------------------------------------*
 *  Randomly call a student                                *
 *---------------------------------------------------------*
 * .randomCall         .r1  # randomly call a student      *
 * .randomNum          .r2  # randomly generate an integer *
 * .showRemainder      .r3  # devided by n (default is 30) *
 * .showStudentPhoto   .r4  #                              *
 * .showWebPNG         .r5  # show a given png file online *
 *---------------------------------------------------------*
 * >.randomCall             # show its usage               *
 * >.r1                     # short-cut for .randomcall    *
 * >.rc                     # come back to this menu       *
 *---------------------------------------------------------*
";.rc_()
}

.rc_<-function(){
cat("
 *---------------------------------------------------------*
 *  Randomly call a student                                *
 *---------------------------------------------------------*
 * .randomCall         .r1  # randomly call a student      *
 * .randomNum          .r2  # randomly generate an integer *
 * .showRemainder      .r3  # devided by n (default is 30) *
 * .showStudentPhoto   .r4  #                              *
 * .showWebPNG         .r5  # show a given png file online *
 *---------------------------------------------------------*
 * >.randomCall             # show its usage               *
 * >.r1                     # short-cut for .randomcall    *
 * >.rc                     # come back to this menu       *
 *---------------------------------------------------------*
 * >.randomCall             # show its usage               *
 * >.aa                     # short-cut for .randomcall    *
 * >.rc                     # come back to this menu       *
 *---------------------------------------------------------*
")
}






.review<-function(i){
" i  Review before the final exam                i     Before the final exam
  -  -------------------------------------       --  ----------------------------------
  1  Present value of one future cash flow       21  Sharpe ratio
  2  Excel function for pv()?                    22  Treynor ratio
  3  definition of a perpetuity                  23  LPSD
  4  pv(perpetuity)                              24  LPSD VBA
  5  definition of annuity                       25  Sortino ratio
  6  pv(perpetuity) and the excel function       26  Effective annual rate: Excel effect() function
  7  usage of the Excel fv() function            27  Effective annual rate: formula
  8  due concept: perpetuity due/annuity due     28  Given APR1, m1, and m2, what is other effective rates
  9  Excel sign issue                            29  Given APR1, m1, and m2, what is APR2
 10  What is the definition of NPV               30  VBA 4 APR2effect
 11  What is the definition of a normal project  31
 12  What is NPV rule                            32
 13  Two methods to estimate NPV                 33
 14  is the Excel NPV a true NPV function        34  
 15  fv() for fv(one cash flow), fv(annuity)     35
 16  Definition of IRR and what is IRR rule?     36
 17  How to estimate IRR                         37
 18  Payback period and its rule                 38
 19  How to estimate a project's payback period  39 
 20  What is the definition of an effective rate 40
 
 Example #1:> .review   # find out the list 
 Example #2:> .rr       # same as the above 
 Example #3:> .rr(1)    # for the first question 

";.zreview(i)}

.rr<<-.review
.nreview<-40

.zreview<-function(i){
   if(i<=.nreview){
      .x<-paste('cat(.reviewP',i,')',sep='')
      .runText(.x)
   }else{
     cat("Invalid number: input value should between 1 ",.nreview, " \n")
   }
}

.reviewP1<-"Present value of one future cash flow
///////////////////////////////////////////

  Present value of one future cash flow

 1) what is the formula?

 2) What is the corresponding Excel function

  What is the equivalent present value for $500 received
     in 4 years with a 2.5% annual discount rate?

///////////////////////////////////////////
"

.reviewP2<-" Excel function for pv()?
///////////////////////////////////////////

 Excel function for pv()?


///////////////////////////////////////////
"

.reviewP3<-"
/////////////////////////////////////

  3  definitions of perpetuity

/////////////////////////////////////
"

.reviewP4<-"
/////////////////////////////////////

  4  pv(perpetuity)

/////////////////////////////////////
"

.reviewP5<-"
/////////////////////////////////////

  5  definition of annuity
  
/////////////////////////////////////
"

.reviewP6<-"
/////////////////////////////////////

  6  pv(perpetuity) and the excel function

/////////////////////////////////////
"

.reviewP7<-"
/////////////////////////////////////

  7  usage of the Excel fv() function

/////////////////////////////////////
"

.reviewP8<-"
///////////////////////////////////////////

  8  due concept: perpetuity due and annuity due

/////////////////////////////////////
"

.reviewP9<-"
/////////////////////////////////////

  9  Excel sign issue

/////////////////////////////////////
"

.reviewP10<-"
/////////////////////////////////////

 10  What is the definition of NPV

/////////////////////////////////////
"

.reviewP11<-"
///////////////////////////////////////////

 11  What is the definition of a normal project

///////////////////////////////////////////
"

.reviewP12<-"
///////////////////////////////////////////

 12  What is NPV rule

///////////////////////////////////////////
"

.reviewP13<-"
/////////////////////////////////////

 13  Two methods to estimate NPV

/////////////////////////////////////
"

.reviewP14<-"
/////////////////////////////////////

 14  is the Excel NPV a true NPV function 

/////////////////////////////////////
"

.reviewP15<-"
/////////////////////////////////////

 15  fv() for fv(one cash flow), fv(annuity)
  
/////////////////////////////////////
"

.reviewP16<-"
/////////////////////////////////////

 16  What is the definition of IRR and what is IRR rule?

/////////////////////////////////////
"

.reviewP17<-"
/////////////////////////////////////

 17  How to estimate IRR

/////////////////////////////////////
"

.reviewP18<-"
///////////////////////////////////////////

 18  Payperiod and its rule

/////////////////////////////////////
"

.reviewP19<-"
/////////////////////////////////////

 19  How to estimate a project's payback period

/////////////////////////////////////
"

.reviewP20<-"What is the definition of an effective rate
/////////////////////////////////////

  What is the definition of an effective rate

  1) only two cash flows
  2) if a rate is 10%, then an investment of 100 will lead to 110.  


 100               10%                      110
  |-----------------------------------------|
  0                                         1

/////////////////////////////////////
"

.reviewP21<-"Sharpe ratio
/////////////////////////////////////


                   R_mean - Rf
 Sharpe ratio =   ---------------
                       sigma 

 Sigma is the standard deviation of returns. 
   This is used to measure the total risk. 

/////////////////////////////////////
"

.reviewP22<-"Treynor ratio
/////////////////////////////////////

                   R_mean - Rf
 Sharpe ratio =   ---------------
                       beta

 Beta is the market risk


/////////////////////////////////////
"

.reviewP23<-"LPSD
///////////////////////////////////////////
 LPSD stands for Lower Partial Standard Deviation. 
     Assume that we have n returns, R1, R2, ..., Rn
     For a given benchmark return R_benchmark, we drop all
        the returns that are higher than this benchmark return. 


           (R1-R_mean)^2 + .... + (Rn-R_mean)^2
   var2 =  -----------------------------------   if(Ri<R_benchmark)   (3)  
                       n-1

   LPSD= sqrt(var2)                                                   (4)

/////////////////////////////////////
"

.reviewP24<-"VBA 4 LPSD
/////////////////////////////////////

Function LPSD(returns As Range, MAR As Variant) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim avgReturn As Double
   Dim mm2d As Double
   Dim downDev As Double
 
   n = returns.Rows.Count
   avgReturn = WorksheetFunction.Average(returns)
   moment2d = 0
   For i = 1 To n
      If returns(i) - MAR < 0 Then
         mm2d = mm2d + ((returns(i) - MAR) ^ 2)
    End If
  Next
  downDev = Sqr(mm2d / (n - 1))
  If downDev > 0 Then
     LPSD = downDev
  Else
     LPSD = \"undefined\"
  End If
End Function

Function LPSDhelp() As String
     LPSDhelp= \"usage:  =LPSD(returnMatrix, benchmarkRate)\"
End Function

/////////////////////////////////////
"

.reviewP25<-"Sortino ratio
/////////////////////////////////////

                        R_mean - Rf
        Sortino ratio= ----------------
                          LSPD

/////////////////////////////////////
"


.reviewP26<-"Effective annual rate: Excel effect() function
///////////////////////////////////////////

Effective annual rate: Excel effect() function

   Assume that a given APR (Annual Percentage Rate) is 10%, 
       compouded semiannually, what is the corresponding 
       Effective Annual Rate?

  100                 5                      5+100
  |-------------------|----------------------|
                     0.5                     1


 The Excel function called effect() can be applied. 

///////////////////////////////////////////
"

.reviewP27<-"Effective annual rate: formula
///////////////////////////////////////////

   Effective annual rate: formula

   EAR = (1+ APR/m) ^m -1


  APR: Annual Percentage Rate
       m compounded frequency 

///////////////////////////////////////////
"

.reviewP28<-"Other effective rates
/////////////////////////////////////
 Other effective rates

  Given: APR1, m1, m2, 
        what is APR2 with a compouding frequency of m2?

   Assume that a given APR1 (Annual Percentage Rate) is 10%, 
       compouded semiannually, what is the corresponding 
       Effective monthly rate?

/////////////////////////////////////
"

.reviewP29<-"Given APR1,m1,m2 --> effective rate=?
/////////////////////////////////////

 Given APR1,m1,m2 --> effective rate=?

   R_effect=(1+APR1/m1)^(m1/m2)-1

/////////////////////////////////////
"

.reviewP30<-"
/////////////////////////////////////

Function APR2effect(APR1,n1,n2) As Variant
   APR2effect=(1+APR1/n1)^(n1/n2)-1
End Function

Function APR2effectHelp() As String
   APR2effectHelp = \"usage: =APR2effect(APR1,n1,n2)\"
End Function  

/////////////////////////////////////
"



.reviewP31<-"
///////////////////////////////////////////

///////////////////////////////////////////
"
.reviewP32<-"
///////////////////////////////////////////

///////////////////////////////////////////
"

.reviewP33<-"
/////////////////////////////////////

/////////////////////////////////////
"

.reviewP34<-"
/////////////////////////////////////

/////////////////////////////////////
"

.reviewP35<-"
/////////////////////////////////////
  
/////////////////////////////////////
"

.reviewP36<-"
/////////////////////////////////////

/////////////////////////////////////
"

.reviewP37<-"
/////////////////////////////////////
/////////////////////////////////////
"

.reviewP38<-"
///////////////////////////////////////////

/////////////////////////////////////
"

.reviewP39<-"
/////////////////////////////////////

/////////////////////////////////////
"
.reviewP40<-"
/////////////////////////////////////

/////////////////////////////////////
"
.runText<-function(string){
"Objective: run a command expressed as a string


  Example 1: > x<-1:50
             > a<-'mean(x)'
             > .runText(a)
               [1] 25.5

  Example 2: > x<- double quotation mak here source('http://canisius.edu/~yany/adv.R')    double quotation mark here  
             >runText(x)




";.runText_(string)}

.runText_<-function(string){
    .cc = parse(text =string) 
    eval(.cc) 
}


# assume that both ..week and ..course exist

.saveWeeklyWorkSpace<-function(){
   .t1<-"c://yan/teaching/cf/"
   .t2<-paste(.t1,'R/w',..week,'.RData',sep='')
   base::save.image(.t2)
   cat("  File saved at\n  ", .t2, "\n")
}






.search<-function(n_or_name=2){
"Objective: find the DATA_ID for a specific data set 
   n_or_name: could be an integer or phrase 
              1) n> 0  -> show the first n lines (default is2)
              2) n< 0  -> show the last n lines
              3) phrase such as 'ff3m' 
         
 Example #1: > .search()
                  DIR             NAME
           1 data_csv   ^gspcDaily.csv
           2 data_csv ^gspcMonthly.csv

 Example #2: > .search(3)
                 DIR             NAME
          1 data_csv   ^gspcDaily.csv
          2 data_csv ^gspcMonthly.csv
          3 data_csv    aaplDaily.csv
 
 Example #3: > .search(-2)
                 DIR          NAME
         547 doc_pdf  yan1page.pdf
         548 doc_pdf yan1page2.pdf
 
 Example #4: > .search('ff3m')
                DIR            NAME
       17  data_csv   ff3Monthly.csv 
       47  data_excel ff3Monthly.xlsx
       226 data_txt   ff3Monthly.txt 
   
";.search_(n_or_name)}

.search_<-function(nOrName,data){
    .path3<-"http://datayyy.com/cfe/"

    if(exists('.data508')==FALSE){
           .tempPath<-paste(.path3,"data508",".RData",sep='')
           load(url(.tempPath))
          .data508<<-.x
     }

    if(typeof(nOrName)=="double"){
           .show_n_obs(.data508,nOrName)
    }else{
         .a<-toupper(nOrName)
         .b<-toupper(.data508$NAME)
         .z<-.data508[grep(.a,.b),]
         .z2<-format(.z, justify = "left")
         # rownames(.z2)<-NULL
         return(.z2)
    }
}



.searchData<-function(chapterOrName){
"Objective: find the numbers for data set given a chapter
   chapterOrName: integer or a name 
                  A list of all data sets (aa add later)

 Example #1: > .searchData(1)    # for chapter 1
    
     
";.searchData_(chapterOrName)}

.searchData_<-function(chapterOrName){
   if(exists('.chapterDataIDname')==FALSE){
       .tempPath<-paste(..path2,"RData/chapterDataIDname",".RData",sep='')
        load(url(.tempPath))
       .chapterDataIDname<<-.x
   }
   if(typeof(chapterOrName)=="double"){
       .n<-chapterOrName
       if(.n<1 | .n >19){
          cat("  Error message: chapter should be between 1 and 21 \n")
       }else{
          .z<-.chapterDataIDname[.chapterDataIDname$CHAPTER==.n,]
          .z2<-format(.z, justify = "left")
          rownames(.z2)<-NULL
          print(.z2)
        }
    }else{
       #.a<-paste("^",toupper(chapterOrName),sep='')
       .a<-paste(toupper(chapterOrName),sep='')
      .b<-toupper(.chapterDataIDname$NAME)
      .z<-.chapterDataIDname[grep(.a,.b),]
      .z2<-format(.z, justify = "left")
      rownames(.z2)<-NULL
      print(.z2)
   }
}





.searchWebs<-function(keyword){
"Objective: search web links for a given keyword

 Example #1:> .searchWebs('speech')
              ID                         NAME                                   WEBSITE
           1 257 Obama 2008 speech            http://datayyy.com/doc_txt/obama2008.txt 
           2 290 Reagan 1964 speech           http://datayyy.com/doc_txt/reagan1964.txt
           3 340 Trump 2018 acceptance speech http://datayyy.com/doc_txt/trump2016.txt 

 Example #2:>.sw('speech')   # .sw() is the short-cut of .searchWebs()

 Example #3> .sw(257)        # go to the web page

 Example #4> # Sometimes, you don't get the same output as your instructor
             # The reason is that you are using the old data set. 
             # Remove the old data set by issuing the following command. 
             > rm(.websites)
             # then call .sw() function again.
  
";.searchWebs_(keyword)}

.sw<-.searchWebs
.searchwebs<<-.searchWebs

.searchWebs_<-function(keyword){
     .path3<-"http://datayyy.com/cf/"
     if(exists('.websites')==FALSE){
           .tempPath<-paste0(.path3,"websites",".RData")
           x<-get(load(url(.tempPath)))
           x2<-data.frame(1:nrow(x),x)
           colnames(x2)<-c("ID","NAME","WEBSITE")
           .websites<<-x2
           
      }

     if(is.character(keyword)==TRUE){
       .a<-toupper(keyword)
       .b<-toupper(.websites$NAME)
       .b2<-toupper(.websites$WEBSITE)

       .z<-grep(.a,.b)
       .z2<-grep(.a,.b2)
       .z3<-c(.z,.z2)
       .z4<-unique(.z3)
       .z5<-.websites[.z4,]
       .z5$WEBSITE<-gsub(";",",",.z5$WEBSITE)
       .z6<-format(.z5, justify = "left")
       rownames(.z6)<-NULL
       #return(.leftAdj(.z6))
       print(.leftAdj(.z6),row.names=F)

    }else{
      .showWebs(keyword)
    }
}
 
.show_aaplMonthly<-function(n=2){
"Objective: show Apple (ticker=aapl) monthly historical data
        n  : n > 0 for the first n obs (default is 2)
             n < 0 for the last  n obs
             n = 0 for all observations

 Example 1:> .show_aaplMonthly()   

 Example 2:>.show_aaplMonthly(3)

 Example 3:>.show_aaplMonthly(-3)   # show the last 3 lines

 Example 4: > .show_aaplMonthly(0)  # get all to Excel
            # Launch Excel and paste
       
";.show_aaplMonthly_(n)}

.show_aaplMonthly_<-function(n){
   .path<-'http://datayyy.com/data_R/'
   .file<-'aaplMonthly.RData'
   if(exists('.aaplM')==FALSE){
      infile<-paste0(.path,.file)
      .aaplM<<-get(load(url(infile)))
   }
   .showNobs(.aaplM,n)
}


.show_creditSpread<-function(n=2){
"Objective : show the credit spread based on rating 
       n   : number of observations (default is 2)
             n > 0 for the first n obs
             n < 0 for the last  n obs
             n = 0 for all obs
             Unit: Basis-point, one basis point is 100th of 1%. 
                   .i.e., 5 = 5/100/100=0.0005
     
 Example 1:> .showCreditSpread()
               year1 year2 year3 year5 year7 year10 year30
       Aaa/AAA     5     8    12    18    28     42     65
       Aa1/AA+    10    18    25    34    42     54     77
       
 Example 2:> .showCreditSpread(-3)
             year1 year2 year3 year5 year7 year10 year30
    B2/B       452   478   502   527   552    578    612
    B3/B-      526   552   578   604   632    660    693
    Caa/CCC+   600   626   653   682   712    743    775

 Example 3:> .showCreditSpread(0)
             Launch Excel and paste

";.zshow_creditSpread(n)}

.zshow_creditSpread<-function(n){
   if(exists('.creditSpread')==FALSE)
      .creditSpread<<-get(load(url("http://datayyy.com/data_R/creditSpread.RData")))
   .showNobsWithRownames(.creditSpread,n)
}

.show_ff3daily<-function(n=2){
" Objective: show Fama-French daily 3 factors
        n  : n > 0 for the first n obs (default is 2)
             n < 0 for the last  n obs
             n = 0 for all observations

   source    : http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html
   frequency : daily 

 Example 1: > .show_ff3daily()
                 DATE MKT_RF     SMB     HML    RF
            1 1926-07-01 0.0010 -0.0024 -0.0028 9e-05
            2 1926-07-02 0.0045 -0.0032 -0.0008 9e-05

 Example 2: > .show_ff3daily(-5)

 Example 3: >.show_ff3daily(0)

";.zshow_ff3daily(n)}

.show_ff3Daily<<-.show_ff3daily

.zshow_ff3daily<-function(n){
   if(exists('.ff3Daily')==FALSE){
     .ff3Daily<<-get(load(url('http://datayyy.com/data_R/ff3daily.RData')))
   }
   .showNobs(.ff3Daily,n)
}

.show_ff3monthly<-function(n=2){
"Objective: show the Fama-French monthly 3 factors
        n  : n > 0 for the first n obs (default is 2)
             n < 0 for the last  n obs
             n = 0 for all observations

 Example 1:> .show_ff3monthly()
                      DATE MKT_RF    SMB     HML     RF
              1 1926-07-01 0.0296 -0.023 -0.0287 0.0022
              2 1926-08-01 0.0264 -0.014  0.0419 0.0025

 Example 2: > .show_ff3monthly(3)   # first 3
               DATE MKT_RF     SMB     HML     RF
          1 1926-07-01 0.0296 -0.0230 -0.0287 0.0022
          2 1926-08-01 0.0264 -0.0140  0.0419 0.0025
          3 1926-09-01 0.0036 -0.0132  0.0001 0.0023

 Example 3: > .show_ff3monthly(-2)  # last 2
                  DATE  MKT_RF    SMB     HML     RF
        1103 2018-05-01  0.0265 0.0524 -0.0313 0.0014
        1104 2018-06-01  0.0048 0.0115 -0.0241 0.0014

 Example 4:>.show_ff3monthly(0)     # get all 
      
";.zshow_ff3monthly(n)}

.show_ff3Monthly<<-.show_ff3monthly

.zshow_ff3monthly<-function(n){
   if(exists('.ff3Monthly')==FALSE){
     .ff3Monthly<<-get(load(url("http://datayyy.com/data_R/ff3monthly.RData")))

   }
   .showNobs(.ff3Monthly,n)
}

.show_ibmDaily<-function(n=2){
" Objective: show the IBM daily data 
        n  : n > 0 for the first n obs (default is 2)
             n < 0 for the last  n obs
             n = 0 for all observations

 Example 1: >.show_ibmDaily()
                DATE     OPEN     HIGH      LOW    CLOSE ADJ.CLOSE VOLUME
        1 1962-01-02 7.713333 7.713333 7.626667 7.626667  0.689273 387200
        2 1962-01-03 7.626667 7.693333 7.626667 7.693333  0.695299 288000

 Example 2: > .show_ibmDaily(-3)
               DATE   OPEN   HIGH    LOW  CLOSE ADJ.CLOSE  VOLUME
    14139 2018-03-02 152.79 154.76 151.88 154.49    154.49 3261100
    14140 2018-03-05 154.12 157.49 153.75 156.95    156.95 3670600
    14141 2018-03-06 157.28 157.89 155.16 155.72    155.72 3586600

 Example 3: # get all 
          x=.show_ibmDaily(0)
          Launch Excel and paste

";.show_ibmDaily_(n)}

.show_ibmDaily_<-function(n){
   if(exists('.ibmDaily')==FALSE){
       .infile<-"http://datayyy.com/data_R/ibmDaily.RData"
       .ibmDaily<<-get(load(url(.infile)))
    }
   .showNobs(.ibmDaily,n)
}



.show_ibmMonthly<-function(n=2){
"Objective: show Fama-French 3 monthly factors
        n  : n > 0 for the first n obs (default is 2)
             n < 0 for the last  n obs
             n = 0 for all observations

 Example 1:> .show_ibmMonthly()   
                  DATE     OPEN     HIGH      LOW    CLOSE ADJ.CLOSE  VOLUME
          1 1962-01-01 7.713333 7.713333 7.003334 7.226666  1.889625 8760000
          2 1962-02-01 7.300000 7.480000 7.093333 7.160000  1.872192 5737600

 Example 2:>.show_ibmMonthly(3)
               DATE     OPEN     HIGH      LOW    CLOSE ADJ.CLOSE  VOLUME
       1 1962-01-01 7.713333 7.713333 7.003334 7.226666  1.889625 8760000
       2 1962-02-01 7.300000 7.480000 7.093333 7.160000  1.872192 5737600
       3 1962-03-01 7.186666 7.413333 7.070000 7.103333  1.857628 5344000

 Example 3:>.show_ibmMonthly(-3)   # show the last 3 lines
                  DATE   OPEN   HIGH    LOW  CLOSE ADJ.CLOSE   VOLUME
         689 2019-05-01 140.55 141.81 126.85 126.99  125.4992 75536400
         690 2019-06-01 127.10 140.15 127.06 137.90  137.9000 61341600
         691 2019-07-01 139.60 141.49 139.28 139.88  139.8800  3377700

 Example 4: > .show_ibmMonthly(0)  # get all to Excel
            # Launch Excel and paste
       
";.show_ibmMonthly_(n)}

.show_ibmMonthly_<-function(n){
   .path<-'http://datayyy.com/data_R/'
   .file<-'ibmMonthly.RData'
   if(exists('.ibmMonthly')==FALSE){
      infile<-paste0(.path,.file)
      .ibmMonthly<<-get(load(url(infile)))
   }
   .showNobs(.ibmMonthly,n)
}



.show_jpg<-function(infile){
"Objective: show a jpg image
            Assume that the R 'jpeg' is preinstalled. To test it, issue the following command

            library(jpeg)

            install.packages('jpeg')

 Example 1:> infile<-'http://datayyy.com/images/milkyWay.jpg'
             .show_jpg(infile)

 Example 2: infile<-system.file('img', 'Rlogo.jpg', package='jpeg')
            .show_jpg(infile)

 
 Example 3: infile<-'http://datayyy.com/images/leaf.jpg'
             .show_jpg(infile)

";.zshow_jpg(infile)}

.zshow_jpg<-function(infile){
   a<-grep("http",infile)
   if(length(a)>0){
         outfile<-tempfile()
         download.file(infile,outfile,mode='wb',quiet=T)
         infile<-outfile
   }

   library(jpeg)
   img<-readJPEG(infile)
   # #
   if (exists("rasterImage")) { 
          plot(1:2, type='n')
          rasterImage(img, 1.01, 1.1, 1.95, 1.99)
    }else{
         cat('  function rasterImage() is missing \n')
    }
}

#rasterImage(image, xleft, ybottom, xright, ytop, angle = 0, interpolate = TRUE, ...)

.show_jpg0<-function(i){
"Objective: show a jpg image

";.zshow_jpg0(i)}

.zshow_jpg0<-function(i){

    path<-"http://datayyy.com/cf/images/"
    if(exists('.imageData')==FALSE){
         .tempPath<-paste0(path,"imageData",".RData")
         .imageData<<-get(load(url(.tempPath)))
    }

    loc<-.imageData$LOCATION[i]
    name_loc<-.imageData$NAME_LOC[i]

    if(loc==1) path<-"http://datayyy.com/images/"
    final<-paste0(path,name_loc)
    return(final)
}



.show_n_obs<-function(dataset,n=2){

  .show_n_obs_(dataset,n)
}


.show_n_obs_<-function(data,n){
   if(n>0){
        .x=head(data,n)
        return(.x)
   }else if(n<0){
        .x=tail(data,abs(n))
        return(.x)
    }else{
       # .a=data
       # names<-colnames(data)
       # .x<-data.frame(matrix(unlist(.a)))
       #.x<-.a
       # colnames(.x)<-names

        write.table(data,file="clipboard-16384", sep="\t", row.names=FALSE)
        cat(" Launch Excel and paste\n\n")
     
    }
}



.show_n_obsMac<-function(dataset,n=2){

  .show_n_obsMac_(dataset,n)
}

.show_n_obsMac_<-function(data,n){
   if(n>0){
        .x=head(data,n)
        return(.x)
   }else if(n<0){
        .x=tail(data,abs(n))
        return(.x)
    }else{
       # .a=data
       # names<-colnames(data)
       # .x<-data.frame(matrix(unlist(.a)))
       #.x<-.a
       # colnames(.x)<-names

      #  write.table(data,file="clipboard-16384", sep="\t", row.names=FALSE)

       write.table(data,pipe("pbpaste"))
       cat(" Launch Excel and paste\n\n")
     
    }
}



.show_sp500annual<-function(n=2){
"Objective : show SP500 annual data 
       n   : number of observations (default is 2)
             n > 0 for the first n obs
             n < 0 for the last  n obs
             n = 0 for all obs

      source:  http://www.usgovernmentspending.com/download_raw
      Unit   : billion 

 Example 1:> .show_sp500annual()
               YEAR    RETURN
             1 1950 0.1970675
             2 1951 0.1646252

 Example 2:> .show_sp500annual(-2)
               YEAR     RETURN
            69 2018 -0.0623726
            70 2019  0.1677005

 Example 3:> .show_sp500annual(0)
              Launch Excel and paste

";.show_sp500annual_(n)}

.show_sp500annual_<-function(n){
   if(exists('.sp500annual')==FALSE){
      path<-"http://datayyy.com/data_R/sp500annual.RData"
      load(url(path))
      .sp500annual<<-.x
   }
   .showNobs(.sp500annual,n)
}

.show_sp500daily<-function(n=2){
"Objective : show SP500 daily data 
       n   : number of observations (default is 2)
             n > 0 for the first n obs
             n < 0 for the last  n obs
             n = 0 for all obs

 Example 1:> .show_sp500daily()

 Example 2:> .show_sp500daily(-2)

 Example 3:> .show_sp500daily(0)
              Launch Excel and paste

";.show_sp500daily_(n)}

.show_sp500daily_<-function(n){
   if(exists('.sp500daily')==FALSE){
      path<-"http://datayyy.com/data_R/sp500daily.RData"
      load(url(path))
      .sp500daily<<-.x
   }
   .showNobs(.sp500daily,n)
}

.show_sp500monthly<-function(n=2){
"Objective: show the S&P500 monthly historical price data 
        n  : n > 0 for the first n obs (default is 2)
             n < 0 for the last  n obs
             n = 0 for all observations

 Example 1:> .show_sp500monthly()   

 Example 2:>.show_sp500monthly(3)

 Example 3:>.show_sp500monthly(-3)   # show the last 3 lines

 Example 4: > .show_sp500monthly(0)  # get all to Excel
       
";.show_sp500monthly_(n)}

.show_sp500monthly_<-function(n){
   .path<-'http://datayyy.com/data_R/'
   .file<-'sp500monthly.RData'
   if(exists('.sp500monthly')==FALSE){
      infile<-paste0(.path,.file)
      .sp500monthly<<-get(load(url(infile)))
   }

   .showNobs(.sp500monthly,n)

}



.show_usCPIannual<-function(n=2){
" Objective: show CPI annual CPI data
    n   : number of observations (default is 2)
             n > 0 for the first n obs
             n < 0 for the last  n obs
             n = 0 for all obs

     source: http://data.bls.gov/timeseries/CUSR0000SA0?output_view=pct_1mth  
     range : 1947 -2016

 Example 1: > .show_usCPIannual()
               YEAR    CPI
             1 1947 0.0074
             2 1948 0.0030

 Example 2: > .show_usCPIannual(-5)
               YEAR          CPI
            66 2012 0.0016363636
            67 2013 0.0012727273
            68 2014 0.0010000000
            69 2015 0.0006363636
            70 2016 0.0010000000

 Example 3: > .show_usCAPannual(0)

";.zshow_usCPIannual(n)}

.zshow_usCPI_annual_<-function(n){

  if(exists('.usCPIaData')==FALSE)
     .usCPIaData<<-get(load(url('http://datayyy.com/data_R/usCPIannua.RData')))
  .showNobs(.usCPIaData,n)

}
.show_usCPImonthly<-function(n=2){
" Objective: show CPI monthly CPI data
    n   : number of observations (default is 2)
             n > 0 for the first n obs
             n < 0 for the last  n obs
             n = 0 for all obs

 Example 1: > .show_usCPImonthly()
               YEAR    CPI
             1 1947 0.0074
             2 1948 0.0030

 Example 2: > .show_usCPImonthly(-5)
               YEAR          CPI
            66 2012 0.0016363636
            67 2013 0.0012727273
            68 2014 0.0010000000
            69 2015 0.0006363636
            70 2016 0.0010000000

 Example 3: > .show_usCAPmonthly(0)

";.zshow_usCPImonthly(n)}

.zshow_usCPImonthly<-function(n){

  if(exists('.usCPImData')==FALSE)
     .usCPImData<<-get(load(url('http://datayyy.com/data_R/usCPImonthly.RData')))
  .showNobs(.usCPImData,n)
}
.show_usDebtAnnual<-function(n=2){
  "  Objective: show US natinal debt (Annual)
            n : number of obs shownd, default value is 2

   source :https://fred.stlouisfed.org/series/FYGFD
           Units: Billions of Dollars,Not Seasonally Adjusted
 
 Example 1: > .show_usDebtAnnual()
                   DATE FYGFD
           1 1939-06-30  48.2
           2 1940-06-30  50.7

 Example 2:>.show_usDebtAnnual(-2)
                    DATE   FYGFD
           82 2020-09-30 26902.5
           83 2021-09-30 28385.6
 
 Example #3:> .show_usDebtAnnual(0)
             Windows users: launch Excel and paste
 
";.zshow_usDebtAnnual(n)}

.show_usDebtannual<<-.show_usDebtAnnual

.zshow_usDebtAnnual<-function(n){
   if(exists('.usDebtDataA')==FALSE)
       .usDebtDataA<<-read.csv('http://datayyy.com/data_csv/FYGFD.csv')
  .showNobs(.usDebtDataA,n)
}


.show_usDebtQuarterly<-function(n=2){
  "  Objective: show US natinal debt (Quarterly)
            n : number of obs shownd, default value is 2

   source :https://fred.stlouisfed.org/series/GFDEBTN
           Units: Millions of Dollars,Not Seasonally Adjusted
 
 Example 1: > .show_usDebtQuarterly()
 
 Example 2: > .show_usDebtQuarterly(-5)
 
 Example #3: > .show_usDebtQuarterly(0)

";.zshow_usDebtQuarterly(n)}

.show_usDebtQuarterly<<-.show_usDebtQuarterly

.zshow_usDebtQuarterly<-function(n){
   if(exists('.usDebtDataQ')==FALSE)
       .usDebtDataQ<<-read.csv('http://datayyy.com/data_csv/GFDEBTN.csv')
  .showNobs(.usDebtDataQ,n)
}


.show_usGDPquarterly<-function(n=2){
"Objective: show the US quarterly GDP
      n   : number of observations (default is 2)
             n > 0 for the first n obs
             n < 0 for the last  n obs
             n = 0 for all obs

      source:  http://www.usgovernmentspending.com/download_raw
      range  : 1929 -2015
      Unit   : billion 

 Example 1: > .show_usGDPquarterly()
            DATE GDP_CURRENT GDP2009DOLLAR
            1 1947Q1       243.1        1934.5
            2 1947Q2       246.3        1932.3

 Example 2: > .show_usGDPquarterly(-5)
              DATE GDP_CURRENT GDP2009DOLLAR
        273 2015Q1     17649.3       16177.3
        274 2015Q2     17913.7       16333.6
        275 2015Q3     18060.2       16414.0
        276 2015Q4     18164.8       16470.6
        277 2016Q1     18229.5       16505.1

  Example 3: > .show_usGDPquarterly(0)

";.zshow_usGDPquarterly(n)}

.zshow_usGDPquarterly<-function(n){

   if(exists('.usGDPqData')==FALSE){
      .infile<-'http://datayyy.com/data_R/usGDPquarterly.RData'  
      .usGDPqData<<-get(load(url(.infile)))
   }
   .showNobs(.usGDPqData,n)
}

.show_wmtMonthly<-function(n=2){
"Objective: show Fama-French 3 monthly factors
        n  : n > 0 for the first n obs (default is 2)
             n < 0 for the last  n obs
             n = 0 for all observations

 Example 1:> .show_wmtMonthly()   

 Example 2:>.show_wmtMonthly(3)

 Example 3:>.show_wmtMonthly(-3)   # show the last 3 lines

 Example 4: > .show_wmtMonthly(0)  # get all to Excel
            # Launch Excel and paste
       
";.show_wmtMonthly_(n)}

.show_wmtMonthly_<-function(n){
   .path<-'http://datayyy.com/data_R/'
   .file<-'wmtMonthly.RData'
   if(exists('.wmtM')==FALSE){
      infile<-paste0(.path,.file)
      .wmtM<<-get(load(url(infile)))
   }
   .showNobs(.wmtM,n)
}



.showCreditSpread<-function(n=2){
"Objective : show credit spread by using Rating
       n   : number of observations (default is 2)
             n > 0 for the first n obs
             n < 0 for the last  n obs
             n = 0 for all obs

 Example 1:> .showCreditSpread()
         Rating year1 year2 year3 year5 year7 year10 year30
     1 Aaa/AAA     5     8    12    18    28     42     65
     2 Aa1/AA+    10    18    25    34    42     54     77
       
 Example 2:> .showCreditSpread(-3)
          Rating year1 year2 year3 year5 year7 year10 year30
    15     B2/B   452   478   502   527   552    578    612
    16    B3/B-   526   552   578   604   632    660    693
    17 Caa/CCC+   600   626   653   682   712    743    775
 
Example 3:>.showCreditSpread(0)
         Windows users: launch Excel and paste

";.zshowCreditSpread(n)
}
.zshowCreditSpread<-function(n){
   if(exists('.creditData')==FALSE){
      .creditData<<-get(load(url("http://datayyy.com/data_R/creditSpread2.RData")))
    }
  
   .showNobs(.creditData,n)
}

.showFormula<-function(i){
"Objective: show formula  
  i  NAME                                     i NAME
 --- ------------------------------------    -- -----------------------------
  1  Install png package                     31 Present value of annuity due
  2  2-stock variance                        32 Present value of growing annuity
  3  Adjusted beta                           33 Present value of growing perpetuity
  4  Annualized Variance/standard deviation  34 Present value of one future value
  5  APR to another APR                      35 Present value of perpetuity
  6  APR to EAR                              36 Profitability ratios
  7  APR to Rc                               37 ROA vs. ROE  
  8  Bond price                              38 Sharpe ratio
  9  Call and put options                    39 Sortino ratio
 10  CAPM (Capital Asset Pricing Model)      40 Total returns with two components      
 11  Covariance                              41 Treynor ratio
 12  Cumulative standard normal distribution 42 Variance
 13  Distribution of a normal distribution
 14  Distribution of a standard normal
 15  DuPont identity
 16  Fama-French 3-factor model
 17  Financial leverage ratios
 18  Free cash flows
 19  Future value of annuity
 20  Future value of annuity due
 21  Future value of growing annuity
 22  Future value of one present value
 23  Geometric Mean with just 3 values
 24  Liquidity ratio (accounting)
 25  Nominal vs. real rates
 26  Percentage vs. log returns
 27  Portfolio beta     
 28  Portfolio return 
 29  Portfolio variance
 30  Present value of annuity           
     
 Example #1>.sf      # see this list
 Example #2>.sf(1)   # how to install png
 Example #2>.sf(2)   # see the fv formula

";.showFormula_(i)
}

.notice<-"\n\n  .showingFormula function  needs R package called 'png'\n  Please install it by issuing \n  install.packages('png')\n\n"

.showFormula_<-function(.i){
     # get the names from the list above
     if("png" %in% .packages(all.available=TRUE)==FALSE){
           cat("Please install an R package by issuing the following command\n install.packages(\"png\")\n")
     }else{
       library(png)
     }
  
     if(exists('.formulae')==FALSE){
          .load_yan('formulae')
          .n_formulae<<-nrow(.formulae)
      }else{
          .n_formulae<<-nrow(.formulae)
      }

      if(.i>.n_formulae | .i<1){
         cat("The input value should be between 1 and ",.n_formulae,"\n")
       }else{
       if(.i==1){
         cat(.notice)
       }else{
          .formula<-toString(.formulae[.i,2])
          .formula2<-gsub(" ","",.formula)
         .showPicture(.formula2)
        }
 }
}
.sf<-.showFormula






.showHTTPlink<-function(i){
"Objective      : find the website for data sets 
   chapterOrName: integer or a name 

 Example #1: > .search('ff3mon')
                      DIR            NAME
             17  data_csv   ff3Monthly.csv 
             47  data_excel ff3Monthly.xlsx
             226 data_txt   ff3Monthly.txt 

            > .showHTTPlink(226)
              The link is:  http://datayyy.com/data_txt/ff3Monthly.txt 
              You can copy the above link and download the data/file manually.

";.showHTTPlink_(i)}

.showHTTPlink_<-function(i){
     .path3<-"http://datayyy.com/"
     if(exists('.data508')==FALSE){
          .tempPath<-paste(.path3,"cfe/data508",".RData",sep='')
           load(url(.tempPath))
           #load(.tempPath)
          .data508<<-.x
      }
      .nData508<<-nrow(.data508)
      if(i<1 | i >.nData508){
           cat("  Error message: input integer should be between 1 and ",.nData508,"\n")
     }else{
          dir2<-as.character(.data508[i,1])
          name<-as.character(.data508[i,2])
          .loc<-paste0(.path3,dir2,"/",name)
          cat("   The link is: ",.loc, "\n")
          cat("   You can copy the above link and download the data/file manually.\n")
    }
}








.showImageCF<-function(name){
"Objective: show an image for CF (Corporate Finance)

 Example #1>

 Example 2:>

";.zshowImageCF(name)}

.zshowImageCF<-function(i){
   library(png)
   .td = tempdir()        
   .tf = tempfile(tmpdir=.td, fileext=".png")

   .path3<-"http://datayyy.com/cf/images/"
   if(exists('.imageData')==FALSE){
        .tempPath<-paste0(.path3,"imageData.RData")
        .imageData<<-get(load(url(.tempPath)))
   }

   n<-nrow(.imageData)
   if(i>=1 & i<=n){
         path<-"http://datayyy.com/images/"
         loc<-.imageData$LOCATION[i]
         if(loc==2){
             path<-"http://datayyy.com/cf/images/"
         }
        .myPNG <- paste0(path,.imageData$NAME_LOC[i])
        download.file(.myPNG, .tf, quiet = TRUE,mode = 'wb')
        graphics.off()
       .img <- readPNG(.tf)
       grid::grid.raster(.img)
   }else{
       cat(" Input interger should be between 1 and ", n,"\n")
  }

}




.showNobs<-function(dataset,n=2){

.zshowNobs(dataset,n)}


.zshowNobs<-function(data,n){
   if(n>0){
        .x=head(data,n)
        return(.x)
   }else if(n<0){
        .x=tail(data,abs(n))
        return(.x)
    }else{


     a<-.getOS()
      if(a=="windows"){
           write.table(data,file="clipboard-16384", sep="\t", row.names=FALSE)
           cat(" Windows users: launch Excel and paste\n\n")
      }else{
           clip <- pipe("pbcopy", "w")                       
           write.table(data,row.names=F,file=clip)         # row.names = TRUE                      
           close(clip)
           cat(" Mac users: launch Excel and paste\n\n")
      }
    }
}



.showNobsKeepRownames<-function(dataset,n=2){

.zshowNobsKeepRownames(dataset,n)}


.zshowNobsKeepRownames<-function(data,n){
   if(n>0){
        .x=head(data,n)
        return(.x)
   }else if(n<0){
        .x=tail(data,abs(n))
        return(.x)
    }else{


     a<-.getOS()
      if(a=="windows"){
           write.table(data,file="clipboard-16384", sep="\t", row.names=FALSE)
           cat(" Windows users: launch Excel and paste\n\n")
      }else{
           clip <- pipe("pbcopy", "w")                       
           write.table(data,row.names=T,file=clip)         # row.names = TRUE                      
           close(clip)
           cat(" Mac users: launch Excel and paste\n\n")
      }
    }
}



.showNobsWithRownames<-function(dataset,n=2){

.zshowNobsWithRownames(dataset,n)}

.zshowNobsWithRownames<-function(data,n){
   if(n>0){
        .x=head(data,n)
        return(.x)
   }else if(n<0){
        .x=tail(data,abs(n))
        return(.x)
    }else{


     a<-.getOS()
      if(a=="windows"){
           write.table(data,file="clipboard-16384", sep="\t")
           cat(" Windows users: launch Excel and paste\n\n")
      }else{
           clip <- pipe("pbcopy", "w")                       
           write.table(data,file=clip)         # row.names = TRUE                      
           close(clip)
           cat(" Mac users: launch Excel and paste\n\n")
      }
    }
}



.showRpackages<-function(n=2){
"Objective: show chicken-egg data 

 Example 1:> .showRpackages()
              DATE    PACKAGE                                                            DESCRIPTION
         1 2019-05-14     alpaca                    Fit GLM's with High-Dimensional k-Way Fixed Effects
         2 2019-05-14 ASSOCShiny Interactive Document for Working with Association Rule Mining Analysis

 Example 2: > .showRpackages(-3)
                   DATE       PACKAGE                                   DESCRIPTION
        14196 2006-05-24       allelic A fast, unbiased and exact allelic exact test
        14197 2006-03-30 BayesValidate                         BayesValidate Package
        14198 2006-03-15     coxrobust                Robust Estimation in Cox Model

 Example 3: > .showRpackages(0)
              Launch Excel and paste

";.showRpackages_(n)
}
.showRpackages_<-function(n){
   if(exists('.allRpackages')==FALSE).load_yan("allRpackages")
   .show_n_obs(.allRpackages,n)
}





.showVideo<-function(i,type=1){
"Show a video during the lecture 
     i: video ID
  type: 1: watch it now (default value)
        2: show the corresponding website

 i   Chapter Description 
---  ------  -------------------
  1*    1    R installation [for windows]  (t6:39,2010)  
  2*    1    R installation [on a Mac]     (t5:59,2014)  
  3          Strong Dollar Index           (t3:42, 1/7/2022) 
  4     3    Bond yields                   (t5:16,1/25/2022)
  5*    3    Stocks vs. Fixed Income       (t1:1,1/11/2022)
  6     3       [same as above]                                
  7     3    Stock vs. bond                (v13k,t2:53,2020)     
  8          Biden economy-past,yet 2 come (t5:24,1/23/2022) 
  9          S&P Global ESG score                             
 10          Financial Woes for Nobel      (t3:45,2012)       
 11          How Does SWIFT Work?          (t2:17,2018)       
 12          What is GDP?                  (t4:10,2018)       
 13          Fed Chair Powell 'has to walk (t7:33,1/27/2022)  
 14          Powell                        (t1:01,1/26/2022)  
 15     8    What's an Index? The Dow, S&P 500, and Nasdaq Explained (t3:32,2019)
 16*    8    Understanding Beta | Investopedia (t4:00,2019)
 17     8    What is beta?                  (t2:36,2018)
 18*         What Is the Federal Funds Rate?(t2:05,2018) 
 19          The Fed and the Dual Mandate                                  (t3:51,2021)    
 20    10    Calculating stock beta using Excel                            (t4:28)
 21    10    What is Beta? - MoneyWeek Investment Tutorials                (t5:29)
 22    11    What Is the Efficient Market Hypothesis?                      (t2:34,2018)
 23    11    Efficient Market Theory (AND WHAT ARE THE 3 DIFFERENT FORMS?) (t5:10,2021)
 24    11    The January Effect                                            (t1:44,2015)
 25    14    Dupont Identity Overview - Ryerson University                 (t7:49,2017)                                      

  Example #1> .showVideo(1)   # show video 1
  Example #2> .v2(1)          # same as above 
  Example #3> .v2(1,2)        # see the link for video 1

  Note * done [watched already]

";.showVideo_(i,type)}

.sv<<-.showVideo
.v2<<-.showVideo

.showVideo_<-function(i,type){
  
.allVideos<<-c(
  "https://www.youtube.com/watch?v=ZoPJGmpYJzw",
  "https://www.youtube.com/watch?v=Ywj6yNfc5nM",
  "http:/datayyy.com/webs/strongDollarIndex.html",
  "http://datayyy.com/webs/bondYield.html",
  "http://datayyy.com/webs/stockVSbond.html",

  "http://datayyy.com/videos/stockVSbond.mp4",
  "https://www.youtube.com/watch?v=OaCmJPyEWUw",
  "http://datayyy.com/webs/biden.html",
  "http://datayyy.com/webs/esg.html",
  "http://datayyy.com/webs/novwl.html",

  "https://www.youtube.com/watch?v=uvZRZ8t6utQ",
  "https://www.youtube.com/watch?v=iLom1WlqwS0",
  "http://datayyy.com/webs/gdp69.html",
  "http://datayyy.com/videos/powell26jan.mp4",
  'https://www.youtube.com/watch?v=WA3Jhvm4W9k',

  'https://www.youtube.com/watch?v=0QX1EHV2Ml8',
  'https://www.youtube.com/watch?v=s27-UKEqN4I',
  'https://www.youtube.com/watch?v=C31c1sF9iys',
  'https://www.youtube.com/watch?v=vHurDbCAfkA',
   'https://www.youtube.com/watch?v=zlClflcSrM8',
 
   'https://www.youtube.com/watch?v=etlv7qTQUSY',
   'https://www.youtube.com/watch?v=AEv9AszJ4_U',
   'https://www.youtube.com/watch?v=BNLPHZjY0pc',
   'https://www.youtube.com/watch?v=9wz-0NbkWDY',
   'https://www.youtube.com/watch?v=YgZ4FnApo58'
)

.nShowVideo<-length(.allVideos)

   if(i>=1 & i<=.nShowVideo){
      .x<-.allVideos[i]
      #print(.x)
      if(type==1){
          browseURL(.x)
      }else{
          cat(" The link for the video is: \n")
          cat("    ",.x, "\n")
      }

   
   }else{
     cat("Invalid number: input value should between 1 ", "and ", .nShowVideo, " \n")
   }
}


.showWebs<-function(ID){
"Objective: show a website or using the browseURl() function. 
   wordOrN: keyword or a ID

";.showWebs_(ID)}

.showWebs_<-function(ID){
     .path3<-"http://datayyy.com/data_R/"
     if(exists('.websites')==FALSE){
           .tempPath<-paste0(.path3,"websites",".RData")
           x<-get(load(url(.tempPath)))
           x2<-data.frame(1:nrow(x),x)
           colnames(x2)<-c("ID","NAME","WEBSITE")
           .websites<<-x2
        }

    a<-.websites[ID,]$WEBSITE

    b<-grep("https?",a)
    if(length(b)>=1){
       browseURL(a)
    }else{
      cat("this is not a website\n")
    }
}


.slides<-function(i,format=1){
"Objective: download related slides 
       i  : integer (see below)
  format  : 1 for PDF (default value)
            2 for pptx

  Source: https://book.ivo-welch.info/slides/

 Example 1>.slides(2)
           Files called  c02-tvm-1.pdf, c02-tvm-2.pdf 
             are under  c:/temp 

 Example 2>.ds(4)    # .ds is a short-cut: downloadSlides
           File called  c04-capbudgrules.pdf 
           is under  c:/temp 

 Example 3>.ds(2,2)  # the second input is not 1
           Files called  c02-tvm-1.pptx, c02-tvm-2.pptx 
           are under  c:/temp 

";.slides_(i, format)}

.ds<-.slides
.slide<-.slides

.slides_<-function(i, format){
   .path3<-"http://datayyy.com/cf/"
    path<-'https://book.ivo-welch.info/slides/'

   if(i==1)stop('No files for chapter 1')
#   i<-2
   if(i<10){
       i2<-paste0("C0",i)
   }else{
       i2<-paste0("C",i)
   }

   if(format==1){
       if(exists('.slidePDF')==FALSE){
           .tempPath<-paste0(.path3,"slidePDF.RData")
           .slidePDF<-get(load(url(.tempPath)))
       }
       ext<-'.pdf'
       a<-.slidePDF[grep(i2,toupper(.slidePDF$SLIDE)),]

   }else{
       if(exists('.slidePPTX')==FALSE){
           .tempPath<-paste0(.path3,"slidePPTX.RData")
           .slidePPTX<-get(load(url(.tempPath)))
       }
       ext<-'.pptx'
       a<-.slidePPTX[grep(i2,toupper(.slidePPTX$SLIDE)),]
   }

   n<-length(a)
   for(i in 1:n){
      outfile<-paste0(a[i],ext)
      infile<-paste0(path,outfile)
      download.file(infile,outfile,mode='wb',quiet=T)
   }
   a2<-paste0(a,ext)
   if(n>1){
      a3<-toString(a2)
       cat("\n Files called ",a3,"\n")
       cat("    are under ",getwd(),"\n")
   }else{
       cat("\n File called ",a2,"\n")
       cat("     is under ",getwd(),"\n")

   }
}

.toASCII<- function(x) {


 strtoi(charToRaw(x),16L) 



}





.vba<-function(i){
" i              Simple VBAs                          i    Descriptin                      i   Description 
  -  ----------------------------------------------   -- --------------------              --  -------------
  1 VBA If 'Developer' is not available               26 VBA 4 finding duplicates (2)      51 VBA 4 Sortino ratio
  2 VBA How to copy-and-paste other's VBA?            27 VBA 4 freqGivenNumber             52 VBA 4 todayPrice() 
  3 VBA After you copy and paste other's VBA          28 VBA 4 fvGrowingAnnuity            53 VBA 4 varGivenProb
  4 VBA 4 APR2APR                                     29 VBA 4 fvNoSign() function         54 VBA 4 matrix2column 
  5 VBA 4 APR2effect                                  30 VBA 4 generating a var-cov matrix 55 VBA 4 =mean
  6 VBA 4 Black-Scholes-Merton call option            31 VBA 4 geomeanYan() geomean 4 ret  56 VBA 4 weightedMean
  7 VBA 4 Black-Scholes-Merton put (no dividend)      32 VBA 4 Linear reg: T,R,E           57 VBA 4 covGivenProb 
  8 VBA 4 Black pricing European options on futures   33 VBA 4 Linear reg:T,R,E
  9 VBA 4 bond bond price                             34 VBA 4 links 
 10 VBA 4 bond convexity                              35 VBA 4 LPSD
 11 VBA 4 Bond duration                               36 VBA 4 meanGivenProb
 12 VBA 4 Cholesky decomposition                      37 VBA 4 Modified duration 
 13 VBA 4 converting 23.23 to words                   38 VBA 4 noRepeats
 14 VBA 4 converting miles to km                      39 VBA 4 npvTrue()/npvYan() functions 
 15 VBA 4 doubling an input value                     40 VBA 4 others 
 16 VBA 4 downloading several years' fin statements   41 VBA 4 payback period 
 17 VBA 4 durationYan                                 42 VBA 4 pGivenT_1sided()
 18 VBA 4 DW test (Durin-Watson autocorrelation test) 43 VBA 4 pGivenT2sided()
 19 VBA 4 EAR (Effective Annual Rate)                 44 VBA 4 pv of growing perpeturity
 20 VBA 4 effective rate conversion: EFFECTyan()      45 VBA 4 pvGrowingAnnuity
 21 VBA 4 estimating a correlation matrix             46 VBA 4 pvNoSign() fucntion 
 22 VBA 4 estimating mean                             47 VBA 4 pvPerpetuity
 23 VBA 4 estimating the area                         48 VBA 4 removing errors
 24 VBA 4 financial statements (2)                    49 VBA 4 secondHighestValue 
 25 VBA 4 finding duplicates                          50 VBA 4 showFormula() function 

 Example #1:>.c28     # find out the above list 
 Example #2:>.c28(1)  # see the first explanation

";.zvba(i)}

.nVBAs<-57

.zvba<-function(i){
   if(i<=.nVBAs){
      x<-paste0('cat(.VBA',i,')')
      .runText(x)
   }else{
      cat("Invalid number: input value should between 1 and ",.nVBAs, "\n")
   }
}

.VBA1<-"VBA 0 If \"Developer\" is not available
/////////////////////////////

Windows users
--------------
  Step 1: click 'File' 
  Step 2: click 'Options' 
  Step 3: click 'Customize Ribbon' 
  Step 4: Activate 'developer' and click 'OK'

Mac users
-------------------------
    Select Excel > Preferences > Ribbon & Toolbar.
    Under Customize the Ribbon, select Main Tabs and then check Developer.
    Click Save and then close Excel Preferences.

       http://datayyy.com/webs/developerMac.html

  Video: Enable Developer Tab In Excel 2016 for Mac
         (53second)
          https://www.youtube.com/watch?v=KZ4xTecAxZ4

/////////////////////////////
"
.VBA2<-"VBA 1 How to copy-and-paste other's VBA?
/////////////////////////////

   Step 1: Highlight and copy others' VBA
   Step 2: Click \"Developer\" on your menu bar
   Step 3: Click \"VBA\" -> Insert -> Module 
   Step 4: Right click your mouse and paste
   Step 5: Click \"File\" -> Close and Return to Microsoft Excel 

/////////////////////////////
"
.VBA3<-"VBA 2 After you copy and paste other's VBA
/////////////////////////////

        or generate your own macros, you have to save your Excel 
        as macro-enable file. The extension is .xlsm

/////////////////////////////
"
.VBA4<-"VBA 4 APR2APR
////////////////////////////////

Function APR2APR(APR1,n1, n2) As Variant
   APR2APR=((1+APR1/n1)^(n1/n2)-1)*n2
End Function

Function APR2APRhelp() As String
   APR2APRhelp = \"usage: =APR2APR(APR1,n1,n2)\"
End Function

//////////////////////////
"
.VBA5<-"VBA 4 APR2effect
////////////////////////////////

Function APR2effect(APR1,n1,n2) As Variant
   APR2effect=(1+APR1/n1)^(n1/n2)-1
End Function

Function APR2effectHelp() As String
   APR2effectHelp = \"usage: =APR2effect(APR1,n1,n2)\"
End Function

//////////////////////////
"
.VBA6<-"VBA 4 Black-Scholes-Merton call option
/////////////////////////////

Function bsCall(S, X, T, r, sigma) As Single
    d1 = (Log(S / X) + (r + 0.5 * sigma ^ 2) * T) / (sigma * (Sqr(T)))
    d2 = d1 - sigma * Sqr(T)
    Nd1=Application.NormSDist(d1)
    Nd2=Application.NormSDist(d2)
    bsCall = S *Nd1 - X * Exp(-r * T) * Nd2
End Function

Function bsCallHelp() As String
     bsCallHelp = \"usage:  =bsCall(S,X,T,rf,sigma)\"
End Function

/////////////////////////////
"
.VBA7<-"VBA 4 Black-Scholes-Merton put (no dividend)
/////////////////////////////

Function bsPut(S, X, T, r, sigma) As Single
    d1=(Log(S/X)+(r+0.5*sigma^2)*T)/(sigma*(Sqr(T)))
    d2=d1-sigma * Sqr(T)
    Nd1=Application.NormSDist(-d1)
    Nd2= Application.NormSDist(-d2)
    bsPut = X * Exp(-r * T) *Nd2 - S * Nd1
End Function

Function bsPutHelp() As String
  bsPutHelp = \"usage:  =bsPut(S,X,T,rf,sigma)\"
End Function

/////////////////////////////
"
.VBA8<-"VBA 4 Black pricing European options on futures 
/////////////////////////////

Function callFutures(f0, X, T, r, sigma) As Single
    d1 = (Log(f0 / X) + 0.5 * sigma ^ 2 * T) / (sigma * (Sqr(T)))
    d2 = d1 - sigma * Sqr(T)
    callFutures = Exp(-r * T) * (f0 * Application.NormSDist(d1) - X * Application.NormSDist(d2))
End Function

Function callFuturesHelp() As String
     callFuturesHelp = \"usage: =callFutures(f0, X, T, r, sigma)\"
End Function

/////////////////////////////
"
.VBA9<-"VBA 4 bond bond price 
////////////////////////////////

Function bondPrice(faceValue As Double, Years As Integer, CouponRate As Double, Yield As Double, Frequency As Integer)
 date1 = \"1/1/2010\"
 date2 = WorksheetFunction.EDate(date1, Years * 12)
 bondPrice = faceValue / 100 * WorksheetFunction.Price(date1, date2, CouponRate, Yield, 100, Frequency)
End Function

Function bondPriceHelp() As String
   bondPriceHelp = \"usage: =bondPrice(faceValue,YearsToMaturity,couponRate,Yield,freq)\"
End Function

//////////////////////////
"
.VBA10<-"VBA 4 bond convexity 
////////////////////////////////
Function Convex(Price As Double, ParValue As Double, CouponRate As Double, Frequency As Double, TimeToMaturity As Double)
Dim i As Integer, P(10000) As Double, r(10000) As Double, rate As Double

If Frequency > 0 Then
    'Approximates the YTM using the secant method
        P(1) = 0
        r(1) = 1
        For j = 2 To 9999
            For i = 1 To (Frequency * TimeToMaturity)
                P(j) = P(j) + ((CouponRate * ParValue / Frequency) / ((1 + (r(j) / Frequency)) ^ (i)))
            Next i
            P(j) = P(j) + ParValue / ((1 + (r(j) / Frequency)) ^ (Frequency * TimeToMaturity))
        
            If P(j) = P(j - 1) Then
                rate = r(j)
                Exit For
            Else
                r(j + 1) = r(j) - (P(j) - Price) * (r(j) - r(j - 1)) / _
                    (P(j) - (P(j - 1)))
            End If
        Next j
    '

    'Finds the Bond's Convexity
        For i = 1 To (Frequency * TimeToMaturity)
            Convex = Convex + (i / Frequency) * ((i + 1) / Frequency) * ((ParValue * CouponRate / Frequency) / (1 + (rate / Frequency)) ^ i)
        Next i
        Convex = Convex + TimeToMaturity * (((TimeToMaturity * Frequency) + 1) / Frequency) * ((ParValue) / (1 + (rate / Frequency)) ^ (Frequency * TimeToMaturity))
        Convex = Convex / (1 + (rate / Frequency)) ^ 2
        Convex = Convex / Price
    '
Else
    'Approximates the YTM using the secant method
        P(1) = 0
        r(1) = 1
        For j = 2 To 9999
            P(j) = P(j) + ParValue / ((1 + (r(j))) ^ (TimeToMaturity))
        
            If P(j) = P(j - 1) Then
                rate = r(j)
                Exit For
            Else
                r(j + 1) = r(j) - (P(j) - Price) * (r(j) - r(j - 1)) / _
                    (P(j) - (P(j - 1)))
            End If
        Next j
    Convex = (TimeToMaturity ^ 2 + TimeToMaturity) / (1 + rate) ^ 2
End If
End Function

source of VBA: http://www.ronakke.com/YTM-Duration-Convexity-VBA.html
//////////////////////////
"
.VBA11<-"VBA 4 Bond duration 
////////////////////////////////

Public TimeToMaturity As Double, CouponRate As Double, ParValue As Double, y As Double
Public Frequency As Double, P() As Double, r() As Double, Price As Double
Public i As Integer, j As Integer, rate As Double
Public ChangeInYield As Double

Function YTM(Price As Double, ParValue As Double, CouponRate As Double, Frequency As Double, TimeToMaturity As Double)
Dim i As Integer, j As Integer, P(10000) As Double, r(10000) As Double

'Approximates the YTM using the secant method
    If Frequency > 0 Then
        P(1) = 0
        r(1) = 1
        For j = 2 To 9999
            For i = 1 To (Frequency * TimeToMaturity)
                P(j) = P(j) + ((CouponRate * ParValue / Frequency) / ((1 + (r(j) / Frequency)) ^ (i)))
            Next i
            P(j) = P(j) + ParValue / ((1 + (r(j) / Frequency)) ^ (Frequency * TimeToMaturity))
        
            If P(j) = P(j - 1) Then
                YTM = r(j)
                Exit For
            Else
                r(j + 1) = r(j) - (P(j) - Price) * (r(j) - r(j - 1)) / _
                    (P(j) - (P(j - 1)))
            End If
        Next j
    Else
        YTM = (1 + ((ParValue - Price) / Price)) ^ (1 / TimeToMaturity) - 1
    End If
'

End Function

Function MacDur(Price As Double, ParValue As Double, CouponRate As Double, Frequency As Double, TimeToMaturity As Double)
Dim i As Integer, P(10000) As Double, r(10000) As Double, rate As Double

If Frequency > 0 Then
    'Approximates the YTM using the secant method
        P(1) = 0
        r(1) = 1
        For j = 2 To 9999
            For i = 1 To (Frequency * TimeToMaturity)
                P(j) = P(j) + ((CouponRate * ParValue / Frequency) / ((1 + (r(j) / Frequency)) ^ (i)))
            Next i
            P(j) = P(j) + ParValue / ((1 + (r(j) / Frequency)) ^ (Frequency * TimeToMaturity))
        
            If P(j) = P(j - 1) Then
                rate = r(j)
                Exit For
            Else
                r(j + 1) = r(j) - (P(j) - Price) * (r(j) - r(j - 1)) / _
                    (P(j) - (P(j - 1)))
            End If
        Next j
    '

    'Calcultes the Macaulay Duration
        For i = 1 To (Frequency * TimeToMaturity)
            MacDur = MacDur + (i / Frequency) * ((ParValue * CouponRate / Frequency) / (1 + (rate / Frequency)) ^ i)
        Next i
        MacDur = MacDur + TimeToMaturity * ((ParValue) / (1 + (rate / Frequency)) ^ (Frequency * TimeToMaturity))
        MacDur = MacDur / Price
    '
Else
    MacDur = TimeToMaturity
End If
End Function

source of VBA: http://www.ronakke.com/YTM-Duration-Convexity-VBA.html
//////////////////////////
"
.VBA12<-"VBA 4 Cholesky decomposition 
//////////////////////////////////////

Function CHOL(matrix As Range)
  Dim i As Integer, j As Integer, k As Integer, N As Integer
  Dim a() As Double 'the original matrix
  Dim element As Double
  Dim L_Lower() As Double

  N = matrix.Columns.Count
  ReDim a(1 To N, 1 To N)
  ReDim L_Lower(1 To N, 1 To N)
  For i = 1 To N
      For j = 1 To N
         a(i, j) = matrix(i, j).Value
         L_Lower(i, j) = 0
      Next j
  Next i

  For i = 1 To N
      For j = 1 To N
          element = a(i, j)
          For k = 1 To i - 1
             element = element - L_Lower(i, k) * L_Lower(j, k)
          Next k
          If i = j Then
             L_Lower(i, i) = Sqr(element)
          ElseIf i < j Then
             L_Lower(j, i) = element / L_Lower(i, i)
         End If
      Next j
  Next i

  CHOL = Application.WorksheetFunction.Transpose(L_Lower)
End Function

Function CHOLhelp() As String
   CholHelp = \"usage:  =CHOL(returnMatrix)\"
End Function

//////////////////////////////////////
"
.VBA13<-"VBA 4 converting 23.23 to words
/////////////////////////////

Option Explicit
Function spellNumber(ByVal MyNumber)
   Dim Dollars, Cents, Temp
   Dim DecimalPlace, Count
   ReDim Place(9) As String
   Place(2) = \" Thousand \"
   Place(3) = \" Million \"
   Place(4) = \" Billion \"
   Place(5) = \" Trillion \"
   ' String representation of amount.
    MyNumber = Trim(Str(MyNumber))
    ' Position of decimal place 0 if none.
    DecimalPlace = InStr(MyNumber, \".\")
    ' Convert cents and set MyNumber to dollar amount.

 If DecimalPlace > 0 Then
  Cents = GetTens(Left(Mid(MyNumber, DecimalPlace + 1) & \"00\", 2))
   MyNumber = Trim(Left(MyNumber, DecimalPlace - 1))
 End If
 Count = 1
     Do While MyNumber <> \"\"
        Temp = GetHundreds(Right(MyNumber, 3))
        If Temp <> \"\" Then Dollars = Temp & Place(Count) & Dollars
        If Len(MyNumber) > 3 Then
            MyNumber = Left(MyNumber, Len(MyNumber) - 3)
            Else
              MyNumber = \"\"
       End If
    Count = Count + 1
        Loop
          Select Case Dollars
              Case \"\"
                  Dollars = \"No Dollars\"
              Case \"One\"
                  Dollars = \"One Dollar\"
              Case Else
                  Dollars = Dollars & \" Dollars\"
          End Select
          Select Case Cents
              Case \"\"
                  Cents = \" and No Cents\"
              Case \"One\"
                  Cents = \" and One Cent\"
              Case Else
                  Cents = \" and \" & Cents & \" Cents\"
          End Select
          spellNumber = Dollars & Cents
      End Function
      

      Function GetHundreds(ByVal MyNumber)
          Dim Result As String
          If Val(MyNumber) = 0 Then Exit Function
          MyNumber = Right(\"000\" & MyNumber, 3)
          ' Convert the hundreds place
          If Mid(MyNumber, 1, 1) <> \"0\" Then
              Result = GetDigit(Mid(MyNumber, 1, 1)) & \" Hundred \"
          End If
          ' Convert the tens and ones place.
          If Mid(MyNumber, 2, 1) <> \"0\" Then
              Result = Result & GetTens(Mid(MyNumber, 2))
          Else
              Result = Result & GetDigit(Mid(MyNumber, 3))
          End If
          GetHundreds = Result
      End Function
      '*********************************************
      ' Converts a number from 10 to 99 into text. *
      '*********************************************
     Function GetTens(TensText)
          Dim Result As String
          Result = \"\"           ' Null out the temporary function value.
          If Val(Left(TensText, 1)) = 1 Then   ' If value between 10-19...
              Select Case Val(TensText)
                  Case 10: Result = \"Ten\"
                  Case 11: Result = \"Eleven\"
                  Case 12: Result = \"Twelve\"
                  Case 13: Result = \"Thirteen\"
                  Case 14: Result = \"Fourteen\"
                  Case 15: Result = \"Fifteen\"
                  Case 16: Result = \"Sixteen\"
                  Case 17: Result = \"Seventeen\"
                  Case 18: Result = \"Eighteen\"
                  Case 19: Result = \"Nineteen\"
                  Case Else
              End Select
          Else                                 ' If value between 20-99...
              Select Case Val(Left(TensText, 1))
                  Case 2: Result = \"Twenty \"
                  Case 3: Result = \"Thirty \"
                  Case 4: Result = \"Forty \"
                  Case 5: Result = \"Fifty \"
                  Case 6: Result = \"Sixty \"
                  Case 7: Result = \"Seventy \"
                  Case 8: Result = \"Eighty \"
                  Case 9: Result = \"Ninety \"
                  Case Else
              End Select
        Result = Result & GetDigit(Right(TensText, 1))  ' Retrieve ones place.
          End If
          GetTens = Result
      End Function

      Function GetDigit(Digit)
          Select Case Val(Digit)
              Case 1: GetDigit = \"One\"
              Case 2: GetDigit = \"Two\"
              Case 3: GetDigit = \"Three\"
              Case 4: GetDigit = \"Four\"
              Case 5: GetDigit = \"Five\"
              Case 6: GetDigit = \"Six\"
              Case 7: GetDigit = \"Seven\"
              Case 8: GetDigit = \"Eight\"
              Case 9: GetDigit = \"Nine\"
              Case Else: GetDigit = \"\"
          End Select
      End Function

/////////////////////////////
"
.VBA14<-"VBA 4 converting miles to km
/////////////////////////////

Function mile2km(mile As Single)
    mile2km = mile * 1.6
End Function

Function mile2kmHelp() As String
         mile2kmHelp= \"usage: =mile2km(mile)\"
End Function

/////////////////////////////
"
.VBA15<-"VBA 4 doubling an input value
/////////////////////////////

Function dd(x As Single) As Single
     dd=x*2
End Function

Function ddHelp() As String
      ddHelp= \"usage: =dd(value)\"
End Function

/////////////////////////////
"
.VBA16<-"VBA 4 downloading several years' fin statements
//////////////////////////

Sub getFinStatements()

 sTicker = Range(\"A2\").Value
  If sTicker = \"\" Then
    MsgBox \"No ticker in A2\"
    Exit Sub
  End If
  
  Path = \"URL;http://www.advfn.com/stock-market/NASDAQ/\" & sTicker
  Path2 = Path & \"/financials?btn=annual_reports&mode=company_data\"
  With ActiveSheet.QueryTables.Add(Connection:=Path2, Destination:=Range(\"B3\"))
     .Name = \"financials?btn=annual_reports&mode=company_data\"
    .FieldNames = True
    .RowNumbers = False
    .FillAdjacentFormulas = False
    .PreserveFormatting = False
    .RefreshOnFileOpen = False
    .BackgroundQuery = True
    .RefreshStyle = xlInsertDeleteCells
    .SavePassword = False
    .SaveData = True
    .AdjustColumnWidth = True
    .RefreshPeriod = 0
    .WebSelectionType = xlSpecifiedTables
    .WebFormatting = xlWebFormattingAll
    .WebTables = \"6\"
    .WebPreFormattedTextToColumns = True
    .WebConsecutiveDelimitersAsOne = True
    .WebSingleBlockTextImport = False
    .WebDisableDateRecognition = False
    .WebDisableRedirections = False
    .Refresh BackgroundQuery:=False
End With
End Sub

//////////////////////////
"
.VBA17<-"VBA 4 durationYan
//////////////////////////

Function durationYan(YTM As Double,CouponRate As Double, Frequency As Double, maturityYears As Double) As Variant
Dim i As Integer, rate As Double,coupon As Double, pv As Double, D As Double, bondPrice As Double

bondPrice = 0
D = 0
coupon =100*CouponRate / Frequency
rate = YTM / Frequency
 
For i = 1 To (Frequency * maturityYears)
           pv = coupon / (1 + rate) ^ i
           D = D + pv * 1 / Frequency * i
           bondPrice = bondPrice + pv
Next i
pv = 100/ (1 + rate) ^ (i - 1)
D = D + pv * 1 / Frequency * (i - 1)
bondPrice = bondPrice + pv
durationYan = D / bondPrice

End Function

Function durationYanHelp() As String
   durationYanHelp= \"usage: =durationYan(YTM,ConponRate,paymentsPerYear,matuirtyInYears)\"
End Function

//////////////////////////
"
.VBA18<-"VBA 4 DW test (Durin-Watson autocorrelation test)
////////////////////////////////

Function dwTest(errors As Variant) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim temp1 As Double
   Dim temp2  As Double
     
   n = errors.Rows.Count
   temp2 = WorksheetFunction.SumSq(errors)
   temp1 = 0
   For i = 1 To (n - 1)
   
        temp1 = temp1 + (errors(i + 1) - errors(i)) ^ 2
        'temp1 = n * 2
   Next
   dwTest = temp1 / temp2
End Function

Function dwTestHelp() As String
   dwTestHelp = \"usage: =dwTest(error_column)\"
End Function

//////////////////////////

"
.VBA19<-"VBA 4 EAR (Effective Annual Rate)
////////////////////////////////

Function EAR(APR,npery) As Variant
   EAR=(1+APR/npery)^npery-1
End Function

Function EARhelp() As String
   EARhelp = \"usage: =EAR(APR,compounding_freq)\"
End Function

//////////////////////////
"
.VBA20<-"VBA 4 effective rate conversion: EFFECTyan() 
/////////////////////////////

Function EFFECTyan(APR1 As Variant, n1 As Integer, n2 As Integer) As Variant
' author yuxing.yan at canisius dot edu 
' date : 2/4/2013
     Dim i, n, roduct As String
     If n1 > 365 And n2 > 365 Then
          EFFECTyan = APR1
     ElseIf n1 > 365 And n2 < 365 Then
          EFFECTyan = Exp(APR1) ^ (1 / n2) - 1
     ElseIf n1 < 365 And n2 > 365 Then
          EFFECTyan = n1 * Log(1 + APR1 / n1)
     Else
          EFFECTyan = (1 + APR1 / n1) ^ (n1 / n2) - 1
     End If
End Function

Function effectYanHelp() As String
    effectYanHelp= \"usage: =effectYan(APR1,n1,n2)\"
End Function

/////////////////////////////
"
.VBA21<-"VBA 4 estimating a correlation matrix 
//////////////////////////////////////

Function corrMatrix(dataRange As Object) As Variant 
    On Error Goto 20 
    Dim r As Integer, n As Integer, rr As Integer, i As Integer, j As Integer, k As Integer, doit As Integer 
    Dim x() As Variant, mc() As Double, ss() As Double, m() As Double, ob As Object 
    r = dataRange.Rows.Count 
    n = dataRange.Columns.Count 
    Redim ss(1 To n, 1 To n), m(1 To n), x(1 To n), mc(1 To n, 1 To n) 
    rr = r 
    For i = 1 To r 
        doit = 0 
        For j = 1 To n 
            Set ob = dataRange.Cells(i, j) 
            doit = doit + Application.Count(ob) 
            x(j) = ob.Value 
        Next j 
        If doit = n Then 
            For j = 1 To n 
                m(j) = m(j) + x(j) 
                For k = 1 To j 
                    ss(j, k) = ss(j, k) + x(j) * x(k) 
                Next k 
            Next j 
        Else 
            rr = rr - 1 
        End If 
    Next i 
    For j = 1 To n 
        ss(j, j) = (ss(j, j) - m(j) * m(j) / rr) ^ 0.5 
        mc(j, j) = 1 
        For k = 1 To j - 1 
            ss(j, k) = ss(j, k) - m(j) * m(k) / rr 
            mc(j, k) = ss(j, k) / (ss(j, j) * ss(k, k)) 
            mc(k, j) = mc(j, k) 
        Next k 
    Next j 
    corrMatrix = mc 
    Exit Function 
    20 corrMatrix = CVErr(xlErrValue) 
End Function

Function corrMatrixHelp() As String
    corrMatrixHelp= \"usage: =corrMatrix(returnMatrix)\"
End Function

//////////////////////////////////////
"
.VBA22<-"VBA 4 estimating mean 
/////////////////////////////

Function mean(x As Range) As Variant
  mean = Application.Average(x)
End Function

Function meanHelp() As String
         meanHelp= \"usage: =mean(range)\"
End Function

/////////////////////////////
"
.VBA23<-"VBA 4 estimating the area 
/////////////////////////////

Function Area(Length As Double, Width As Double)
    Area = Length * Width
End Function

Function areanHelp() As String
         areaHelp= \"usage: =area(length,width)\"
End Function

/////////////////////////////
"
.VBA24<-"VBA 4 financial statements (2)
//////////////////////////
1) enter a ticker in cell A2, such as ibm
2) enter a staring position in cell A3, e.g., C10

Sub getFinStatements()
 sTicker = Range(\"A2\").Value
  If sTicker = \"\" Then
    MsgBox \"No ticker in A2\"
    Exit Sub
  End If
  
  starting = Range(\"A3\").Value
  If starting = \"\" Then
    MsgBox \"No starting cell in A3, such as C10\"
    Exit Sub
  End If

  Path = \"URL;http://www.advfn.com/stock-market/NASDAQ/\" & sTicker
  Path2 = Path & \"/financials?btn=annual_reports&mode=company_data\"
  With ActiveSheet.QueryTables.Add(Connection:=Path2, Destination:=Range(starting))
    .Name = \"financials?btn=annual_reports&mode=company_data\"
    .FieldNames = True
    .RowNumbers = False
    .FillAdjacentFormulas = False
    .PreserveFormatting = False
    .RefreshOnFileOpen = False
    .BackgroundQuery = True
    .RefreshStyle = xlInsertDeleteCells
    .SavePassword = False
    .SaveData = True
    .AdjustColumnWidth = True
    .RefreshPeriod = 0
    .WebSelectionType = xlSpecifiedTables
    .WebFormatting = xlWebFormattingAll
    .WebTables = \"6\"
    .WebPreFormattedTextToColumns = True
    .WebConsecutiveDelimitersAsOne = True
    .WebSingleBlockTextImport = False
    .WebDisableDateRecognition = False
    .WebDisableRedirections = False
    .Refresh BackgroundQuery:=False
End With
End Sub

//////////////////////////
"
.VBA25<-"VBA 4 finding duplicates
////////////////////////////////

Sub sbFindDuplicatesInColumn()
Dim lastRow As Long
Dim matchFoundIndex As Long
Dim iCntr As Long
lastRow = Range(\"A65000\").End(xlUp).Row
For iCntr = 1 To lastRow
   If Cells(iCntr, 1) <> \"\" Then
      matchFoundIndex = WorksheetFunction.Match(Cells(iCntr, 1), Range(\"A1:A\" & lastRow), 0)
      If iCntr <> matchFoundIndex Then
         Cells(iCntr, 2) = \"Duplicate\"
      End If
   End If
Next
End Sub

 Source:
    https://analysistabs.com/vba/find-duplicate-values-column/

///////////////////////////////////////////
"
.VBA26<-"VBA 4 finding duplicates (2)
////////////////////////////////

Sub sbFindDuplicatesInColumn_C()
'Declaring the lastRow variable as Long to store the last row value in the Column1
Dim lastRow As Long
'matchFoundIndex is to store the match index values of the given value
Dim matchFoundIndex As Long
'iCntr is to loop through all the records in the column 1 using For loop
Dim iCntr As Long
'Finding the last row in the Column 1
lastRow = Range(\"A65000\").End(xlUp).Row
'looping through the column1
For iCntr = 1 To lastRow
'checking if the cell is having any item, skipping if it is blank.
If Cells(iCntr, 1) <> \"\" Then
'getting match index number for the value of the cell
matchFoundIndex = WorksheetFunction.Match(Cells(iCntr, 1), Range(\"A1:A\" & lastRow), 0)            
'if the match index is not equals to current row number, then it is a duplicate value
If iCntr <> matchFoundIndex Then
'Printing the label in the column B
Cells(iCntr, 2) = \"Duplicate\" 
End If
End If
Next
End Sub 

 Source:
    https://analysistabs.com/vba/find-duplicate-values-column/

///////////////////////////////////////////
"
.VBA27<-"VBA 4 freqGivenNumber
////////////////////////////////
Function freqGivenNumber(numbers As Range, myNumber As Integer) As Variant
   Dim n As Integer, i As Integer
   Dim countValue As Integer
   n = numbers.Rows.Count
   countValue = 0
  
   For i = 1 To n
       If numbers(i) = myNumber Then
           countValue = countValue + 1
       End If
   Next
   freqGivenNumber = countValue
End Function

//////////////////////////
"
.VBA28<-"VBA 4 fvGrowingAnnuity 
/////////////////////////////

Function fvGrowingAnnuity(C As Single, R As Single, g As Single, n As Integer) As Single

' Estimtae the future value of a growing annuity
' by Yuxing.yan@canisius.edu   3/3/2016
'
'  C : the first cash flow at the end of the first period
'  R : the discount rate
'  g : the period growth rate
'  n : the number of periods
     fvGrowingAnnuity = C / (R - g) * (((1 + g) / (1 + R)) ^ n-1)
End Function

Function fvGrowingAnnuityHelp() As String
         fvGrowingAnnuityHelp= \"usage: =fvGrowingAnnuity(pmt,discountRate,growthRate,nper)\"
End Function

/////////////////////////////
"
.VBA29<-"VBA 4 fvNoSign() function 
////////////////////////////////

Function fvNoSign(rate As Single, nper As Integer, pmt As Single, Optional fv As Single, Optional myType As Single) As Variant
         fvNoSign = -PV(rate, nper, pmt, fv, myType)
End Function

Function fvNoSignHelp() As String
     fvNoSignHelp = \"usage: = fvNoSign(rate, nper, pmt, [fv],[type] )\"
End Function

//////////////////////////"
.VBA30<-"VBA 4 generating a var-cov matrix
//////////////////////////////////

 Step 1: highlight and copy the following VBA

Function VarCov(rng As Range) As Variant
    Dim i As Integer
    Dim j As Integer
    Dim colnum As Integer
    Dim matrix() As Double
    Dim x As Double
    Dim nrow As Integer
    
    colnum = rng.Columns.Count
    ReDim matrix(colnum - 1, colnum - 1)
    nrow = rng.Rows.Count
    
    For i = 1 To colnum
        For j = 1 To colnum
            x = Application.WorksheetFunction.Covar(rng.Columns(i), rng.Columns(j))
            matrix(i - 1, j - 1) = x * nrow / (nrow - 1)
            
        Next j
    Next i
    VarCov = matrix

End Function

Function varCovHelp() As String
    varCovHelp= \"usage: =varCov(returnMatrix)\"
End Function

/////////////////////////////
"
.VBA31<-"VBA 4 geomeanYan() geomean 4 ret
/////////////////////////////

Function GEOMEANyan(x As Range) As Variant
' author yuxing.yan at canisius dot edu 
' date : 2/4/2013
     Dim i, n, n2 As Integer, product As String
     product = x(1, 1) + 1
     i = 2
     n = x.Rows.Count
     n2 = x.Columns.Count
     If n > 1 Then
          Do While i <= n
              product = product * (x(i, 1) + 1)
              i = i + 1
          Loop
          product = (product) ^ (1 / n)
      Else
         Do While i <= n2
             product = product * (x(1, i) + 1)
              i = i + 1
          Loop
          product = (product) ^ (1 / n2)
      End If
     GEOMEANyan = product - 1
     'GEOMEANyan = n2
End Function

Function geomeanYanHelp() As String
         geomeanYanHelp= \"usage: =GEOMEANyan(range)\"
End Function

/////////////////////////////
"
.VBA32<-"VBA 4 Linear reg: T,R,E
////////////////////////////////

Function T_SST(y As Range) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim avgReturn As Double
   Dim sum2 As Double
 
   n = y.Rows.Count
   avgReturn = WorksheetFunction.Average(y)
   sum2 = 0
   For i = 1 To n
         k = y(i) - avgReturn
         sum2 = sum2 + k * k
   Next
   T_SST = sum2
End Function

Function R_SSR(y As Range, yHat As Range) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim sum2 As Double
   Dim mean As Double
   
   mean = WorksheetFunction.Average(y)
   n = yHat.Rows.Count
   sum2 = 0
   For i = 1 To n
         k = yHat(i) - mean
         sum2 = sum2 + k * k
   Next
   R_SSR = sum2
End Function

Function E_SSE(y As Range, yHat As Range) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim sum2 As Double
   n = yHat.Rows.Count
   sum2 = 0
   For i = 1 To n
         k = yHat(i) - y(i)
         sum2 = sum2 + k * k
   Next
   E_SSE = sum2
End Function

Function T_SST_help() As String
     T_SST_help = \"usage:  =T_SST(y)\"
End Function

Function R_SSR_help() As String
     R_SSR_help = \"usage:  =R_SSR(y,yHat)\"
End Function

Function E_SSE_help() As String
     E_SSE_help = \"usage:  =E_SSE(y,yHat)\"
End Function

//////////////////////////
"
.VBA33<-"VBA 4 Linear reg:T,R,E
////////////////////////////////

Function h_leverage(all_x As Range, one_x As Variant) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim mean As Double
   Dim sum As Double
   
   n = all_x.Rows.Count
   mean = WorksheetFunction.Average(all_x)
   sum = 0
   For i = 1 To n
        sum = sum + (all_x(i) - mean) ^ 2
   Next
   h_leverage = 1 / n + (one_x - mean) ^ 2 / sum
End Function

Function h_leverageHelp() As String
     h_leverageHelp = \"usage:  =h_leverage(all_x,one_x)\"
End Function

//////////////////////////
"
.VBA34<-"VBA 4 links 
////////////////

   http://www.freevbcode.com/office-vba

   https://analysistabs.com/excel-vba/codes-examples-macros-how-tos-most-useful-basics-advanced/

/////////////////////////////
"
.VBA35<-"VBA 4 LPSD
//////////////////////////////////////

Function LPSD(returns As Range, MAR As Variant) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim avgReturn As Double
   Dim mm2d As Double
   Dim downDev As Double
 
   n = returns.Rows.Count
   avgReturn = WorksheetFunction.Average(returns)
   moment2d = 0
   For i = 1 To n
      If returns(i) - MAR < 0 Then
         mm2d = mm2d + ((returns(i) - MAR) ^ 2)
    End If
  Next
  downDev = Sqr(mm2d / (n - 1))
  If downDev > 0 Then
     LPSD = downDev
  Else
     LPSD = \"undefined\"
  End If
End Function

Function LPSDhelp() As String
     LPSDhelp= \"usage:  =LPSD(returnMatrix, benchmarkRate)\"
End Function

//////////////////////////////////////
"
.VBA36<-"VBA 4 meanGivenProb
///////////////////////////////////////////

Function meanGivenProb(returns As Range, prob As Range) As Variant
  'by pyan@geneseo.edu 8/31/2017, modifed 9/26/2020
  Dim n1, n2, n As Integer
  Dim i As Integer
  Dim mean As Double
  n1 = returns.Rows.Count
  n2 = returns.Columns.Count
  n = Application.Max(n1, n2)
  
  mean = 0
  For i = 1 To n
        mean = mean + prob(i) * returns(i)
  Next
  meanGivenProb = mean
End Function

Function meanGivenProbHelp() As String
         meanGivenProbHelp = \"usage: =meanGivenProb(x_column, prob_column)\"
End Function

///////////////////////////////////////////
"
.VBA37<-"VBA 4 Modified duration 
////////////////////////////////

Function ModDur(Price As Double, ParValue As Double, CouponRate As Double, Frequency As Double, TimeToMaturity As Double)
Dim i As Integer, P(10000) As Double, r(10000) As Double, rate As Double, MacaulayDur As Double

If Frequency > 0 Then
    'Approximates the YTM using the secant method
        P(1) = 0
        r(1) = 1
        For j = 2 To 9999
            For i = 1 To (Frequency * TimeToMaturity)
                P(j) = P(j) + ((CouponRate * ParValue / Frequency) / ((1 + (r(j) / Frequency)) ^ (i)))
            Next i
            P(j) = P(j) + ParValue / ((1 + (r(j) / Frequency)) ^ (Frequency * TimeToMaturity))
        
            If P(j) = P(j - 1) Then
                rate = r(j)
                Exit For
            Else
                r(j + 1) = r(j) - (P(j) - Price) * (r(j) - r(j - 1)) / _
                    (P(j) - (P(j - 1)))
            End If
        Next j
    '

    'Calcultes the Macaulay Duration
        For i = 1 To (Frequency * TimeToMaturity)
            MacaulayDur = MacaulayDur + (i / Frequency) * ((ParValue * CouponRate / Frequency) / (1 + (rate / Frequency)) ^ i)
        Next i
        MacaulayDur = MacaulayDur + TimeToMaturity * ((ParValue) / (1 + (rate / Frequency)) ^ (Frequency * TimeToMaturity))
        MacaulayDur = MacaulayDur / Price
    '

    'Calculates the Modified Duration
        ModDur = MacaulayDur / (1 + (rate))
    '
Else
    'Approximates the YTM using the secant method
        P(1) = 0
        r(1) = 1
        For j = 2 To 9999
            P(j) = P(j) + ParValue / ((1 + (r(j))) ^ (TimeToMaturity))
        
            If P(j) = P(j - 1) Then
                rate = r(j)
                Exit For
            Else
                r(j + 1) = r(j) - (P(j) - Price) * (r(j) - r(j - 1)) / _
                    (P(j) - (P(j - 1)))
            End If
        Next j
    '
    
    ModDur = TimeToMaturity / (1 + rate)
End If

End Function
source of VBA: http://www.ronakke.com/YTM-Duration-Convexity-VBA.html
//////////////////////////
"
.VBA38<-"VBA 4 noRepeats
////////////////////////////////
Step 1: generate 20 different names (or values) from A1:A20
Step 2: copy and paste the following Macro
Step 3: highlight B1:B10, =NoRepeat(B1:B10), ctrl-shfit-enter

Public Function NoRepeats(inpt As Range) As Variant
   Dim ary(), nItems As Long, i As Long
   Dim r As Range
   nItems = inpt.Count
   ReDim ary(1 To nItems)

   i = 1
   For Each r In inpt
      ary(i) = r.Value
      i = i + 1
   Next r

   Call Shuffle(ary)

   ReDim temp(1 To nItems, 1 To 1)
   For i = 1 To nItems
      temp(i, 1) = ary(i)
   Next i

   NoRepeats = temp

End Function

Sub Shuffle(InOut() As Variant)
    Dim HowMany As Long, i As Long, J As Long
    Dim tempF As Double, temp As Variant

    Hi = UBound(InOut)
    Low = LBound(InOut)
    ReDim Helper(Low To Hi) As Double
    Randomize

    For i = Low To Hi
        Helper(i) = Rnd
    Next i

    J = (Hi - Low + 1) \ 2
    Do While J > 0
        For i = Low To Hi - J
          If Helper(i) > Helper(i + J) Then
            tempF = Helper(i)
            Helper(i) = Helper(i + J)
            Helper(i + J) = tempF
            temp = InOut(i)
            InOut(i) = InOut(i + J)
            InOut(i + J) = temp
          End If
        Next i
        For i = Hi - J To Low Step -1
          If Helper(i) > Helper(i + J) Then
            tempF = Helper(i)
            Helper(i) = Helper(i + J)
            Helper(i + J) = tempF
            temp = InOut(i)
            InOut(i) = InOut(i + J)
            InOut(i + J) = temp
          End If
        Next i
        J = J \ 2
    Loop
End Sub

 Source
   https://stackoverflow.com/questions/34693434/random-selection-of-cells-without-duplicates
///////////////////////////////////////////
"
.VBA39<-"VBA 4 npvTrue()/npvYan() functions 
/////////////////////////////

Function NPVyan(rate As Single, x As Range) As Variant
     Dim i, n, n2 As Integer, sum As Single
     sum = x(1, 1)
     i = 2
     n = x.Rows.Count
     n2 = x.Columns.Count
     If n > 1 Then
          Do While i <= n
              sum = sum + x(i, 1) / (1 + rate) ^ (i - 1)
              i = i + 1
          Loop
      Else
         Do While i <= n2
             sum = sum + x(1, i) / (1 + rate) ^ (i - 1)
              i = i + 1
          Loop
      End If
     NPVyan = sum
End Function

Function npvYanHelp() As String
    npvYanHelp= \"usage: =npvYan(rate,range)\"
End Function

# another one

Function npvTRUE(rate As Double, cashFlows As Range) As Variant
    npvTRUE = Application.NPV(rate, cashFlows) * (1 + rate)
End Function

Function npvTrueHelp() As String
    npvTrueHelp= \"usage: =npvTrue(rate,range)\"
End Function

/////////////////////////////
 "
.VBA40<-"VBA 4 others 
//////////////////////////

 http://www.freevbcode.com/office-vba

Function MPG(StartMiles As Integer, FinishMiles As Integer, Litres As Single)
    MPG = (FinishMiles - StartMiles) / Litres * 4.546
End Function

//////////////////////////
"
.VBA41<-"VBA 4 payback period 
////////////////////////////////

Function PAYBACK(invest, finflow)
    Dim x As Double, v As Double
    Dim c As Integer, i As Integer
    x = Abs(invest)
    i = 1
    c = finflow.Count
    Do
        x = x - v
        v = finflow.Cells(i).Value
        If x = v Then
            PAYBACK = i
            Exit Function
        ElseIf x < v Then
            P = i - 1
            Z = x / v
            PAYBACK = P + Z
            Exit Function
        End If
        i = i + 1
    Loop Until i > c
    PAYBACK = \"no payback\"
End Function

Function paybackHelp() As String
   PaybackHelp = \"usage: =PAYBACK(Invest, cashFlows)\"
End Function
//////////////////////////
"
.VBA42<-"VBA 4 pGivenT_1sided()
////////////////////////////////

Function pGivenT_1sided(T As Double, df As Double) As Double
  pGivenT_1sided = WorksheetFunction.T_Dist(T, df, False)
End Function

Function pGivenT_1sidedHelp() As String
  pGivenT_1sidedHelp = \"usage: =pGivenT1_sided(T,df)\"
End Function

//////////////////////////
"
.VBA43<-"VBA 4 pGivenT2sided()
////////////////////////////////
Function pGivenT2sided(T As Double, df As Double) As Double
  pGivenT2sided = WorksheetFunction.T_Dist_2T(T, df)
End Function

Function pGivenT2sidedHelp() As String
  pGivenT2sidedHelp = \"usage: =pGivenT2sided(T,df)\"
End Function

//////////////////////////
"
.VBA44<-"VBA 4 pv of growing perpeturity
/////////////////////////////

Function pvGrowingPerpeturity(cashFlow As Double, Rate As Double, Growth As Double)
    pvGrowingPerpeturity = cashFlow/(Rate-Growth)
End Function

Function pvGrowingPerpeturityHelp() As String
    pvGrowingPerpeturityHelp= \"usage: =pvGrowingPerpeturity(pmt,rate,growthRate)\"
End Function

/////////////////////////////
"
.VBA45<-"VBA 4 pvGrowingAnnuity
/////////////////////////////

Function pvGrowingAnnuity(C As Single, R As Single, g As Single, n As Integer) As Single
  ' Estimtae the present value of a growing annuity
  ' by Yuxing.yan@canisius.edu   3/3/2016
  '  C : the first cash flow at the end of the first period
  '  R : the discount rate
  '  g : the period growth rate
  '  n : the number of periods
     pvGrowingAnnuity = C / (R - g) * (1 - ((1 + g) / (1 + R)) ^ n)
End Function

Function pvGrowingAnnuityHelp() As String
         pvGrowingAnnuityHelp= \"usage: =pvGrowingAnnuity(pmt,discountRate,growthRate,nper)\"
End Function

/////////////////////////////
"
.VBA46<-"VBA 4 pvNoSign() fucntion 
////////////////////////////////

Function pvNoSign(rate As Single, nper As Integer, pmt As Single, Optional fv As Single, Optional myType As Single) As Variant
         pvNoSign = -PV(rate, nper, pmt, fv, myType)
End Function

Function pvNoSignHelp() As String
     pvNoSignHelp = \"usage: = pvNoSign(rate, nper, pmt, [fv],[type] )\"
End Function

//////////////////////////
"
.VBA47<-"VBA 4 pvPerpetuity
/////////////////////////////
                        C
    PV(perpeturity) = ----
                        R

Function pvPerpeturity(cashFlow As Double, Rate As Double)
    pvPerpeturity = cashFlow/Rate
End Function

Function pvPerpeturityHelp() As String
    pvPerpeturityHelp= \"usage: =pvPerpeturity(pmt,rate)\"
End Function

/////////////////////////////
"
.VBA48<-"VBA 4 removing errors
//////////////////////////
Here is the problem. 
Assume that our price data is sorted from newest to the oldest. 
When estimaing return, the last one would be an error, see below. 

 #DIV/0!

When estimate mean and standard deviation, we have to 
avoid this observations. If our sample is smaller and we have just one such error
, we could get rid it easily. However, it our sample is big or with many such errors, 
it is quite time comsuming to do so. 


1
2
3
#DIV/0!

Function removeErr(x As Variant) As Variant
    Dim result As Variant
      If Not IsError(x) Then
           result = x
      Else
           result = \"\"
           End If
      removeErr = result
End Function

//////////////////////////
"
.VBA49<-"VBA 4 secondHighestValue 
////////////////////////////////

Function secondHighestValue(returns As Range) As Variant
 
Dim n As Integer, i As Integer
Dim maxValue As Double, secondH As Double, x As Double
 
n = returns.Rows.Count
maxValue = WorksheetFunction.Max(returns)
secondH = -9999

For i = 1 To n
   x = returns(i)
   If x < maxValue And x > secondH Then
      secondH = x
   End If
Next
  secondHighestValue = secondH

End Function

//////////////////////////
\"
"
.VBA50<-"VBA 4 showFormula() function 
/////////////////////////////

Function showFormula(x As Range)
    If x.HasFormula Then
        showFormula = x.Formula
    Else: showFormula = x
    End If
End Function

Function showFormulaHelp() As String
         showFormulaHelp= \"usage: =showFormula(cell with a formula)\"
End Function

/////////////////////////////
"
.VBA51<-"VBA 4 Sortino ratio (performance measure)
//////////////////////////////////////
Function SortinoRatio(returns As Range, MAR As Variant) As Variant
   Dim n As Integer
   Dim i As Integer
   Dim avgReturn As Double
   Dim mm2d As Double
   Dim downDev As Double
 
   n = returns.Rows.Count
   avgReturn = WorksheetFunction.Average(returns)
   moment2d = 0
   For i = 1 To n
      If returns(i) - MAR < 0 Then
         mm2d = mm2d + ((returns(i) - MAR) ^ 2)
      End If
   Next
   downDev = Sqr(mm2d / (n-1))
   If downDev > 0 Then
      'SortinoRatio = (avgReturn - MAR)
       SortinoRatio = (avgReturn - MAR) / downDev
   Else
      SortinoRatio = \"undefined\"
   End If
End Function

Function SortinoRatioHelp() As String
     SortinoRatioHelp=\"usage: =SortinoRatio(returnMatrix,benchmarkRate)\"
End Function

Source: http://investexcel.net/calculate-the-sortino-ratio-with-excel/
//////////////////////////////////////
"
.VBA52<-"VBA 4 todayPrice() from Yahoo!Finance  
//////////////////////////

Function TodayPrice(strTicker As String, Optional dtDate As Variant)
' Date is optional - if omitted, use today. If value is not a date, throw error.
If IsMissing(dtDate) Then
dtDate = Date
Else
If Not (IsDate(dtDate)) Then
StockQuote = CVErr(xlErrNum)
End If
End If

Dim dtPrevDate As Date
Dim strURL As String, strCSV As String, strRows() As String, strColumns() As String
Dim dbClose As Double

dtPrevDate = dtDate - 7

' Compile the request URL with start date and end date
strURL = \"http://ichart.finance.yahoo.com/table.csv?s=\" & strTicker & _
\"&a=\" & Month(dtPrevDate) - 1 & _
\"&b=\" & Day(dtPrevDate) & _
\"&c=\" & Year(dtPrevDate) & _
\"&d=\" & Month(dtDate) - 1 & _
\"&e=\" & Day(dtDate) & _
\"&f=\" & Year(dtDate) & _
\"&g=d&ignore=.csv\"

' Debug.Print strURL

Set http = CreateObject(\"MSXML2.XMLHTTP\")
http.Open \"GET\", strURL, False
http.Send
strCSV = http.responseText

' Debug.Print strCSV

' The most recent information is in row 2, just below the table headings.
' The price close is the 5th entry
strRows() = Split(strCSV, Chr(10)) ' split the CSV into rows
strColumns = Split(strRows(1), \",\") ' split the relevant row into columns. 1 means 2nd row, starting at index 0
dbClose = strColumns(4) ' 4 means: 5th position, starting at index 0

' Debug.Print vbLf
' Debug.Print strRows(1)
' Debug.Print \"dbClose: \" & dbClose

TodayPrice = dbClose

Set http = Nothing

End Function

//////////////////////////
"

.VBA53<-"VBA 4 varGivenProb
////////////////////////////////

Function varGivenProb(returns As Range, prob As Range) As Variant
'by payn@geneseo.edu  8/31/2017, modifed 9/25/2020
Dim n1, n2, n, i As Integer
Dim mean, final As Double
n1 = returns.Rows.Count
n2 = returns.Columns.Count
n = n1 * n2

mean = 0
For i = 1 To n
      mean = mean + prob(i) * returns(i)
Next
final = 0
For i = 1 To n
      final = final + prob(i) * (returns(i) - mean) ^ 2
Next
varGivenProb = final
End Function

Function varGivenProbHelp() As String
         varGivenProbHelp =\"usage: =varGivenProb(x_range, prob_range)\"
End Function

///////////////////////////////////////////
"


.VBA54<-"VBA 4 matrix2column
////////////////////////////////

Function matrix2columnHelp() As String
   matrix2columnHelp =\"1) name matrix as 'data';2)=matrix2column(); 3) copy it to a cell,then to Q1\"
End Function
Function matrix2column() As String
   matrix2column = \"=OFFSET(data,MOD(ROW()-ROW($Q$1),ROWS(data)),TRUNC((ROW()-ROW($Q$1))/ROWS(data)),1,1)\"
End Function

///////////////////////////////////////////
"

.VBA55<-"VBA 4 mean
////////////////////////////////

Function mean(data As Variant) As Variant
      mean = Application.Average(data)
End Function

Function meanHelp() As String
      meanHelp = \"Usage: =mean(data)\"
End Function

///////////////////////////////////////////
"


.VBA56<-"VBA 4 weightedMean
////////////////////////////////

Function weightedMean(x As Range, w As Range) As Variant
  'by pyan@geneseo.edu, 9/15/2020
  Dim n, m, k, i As Integer
  Dim sum, wTotal As Double
  n = x.Rows.Count
  m = x.Columns.Count
  k = Application.Max(m, n)
  sum = 0
  wTotal = 0
  For i = 1 To k
        sum = sum + x(i) * w(i)
        wTotal = wTotal + w(i)
   Next
  weightedMean = sum / wTotal
End Function

Function weightedMeanHelp() As String
    weightedMeanHelp = \"usage: =weightedMean(x_column, weight_column)\"
End Function

///////////////////////////////////////////
"

.VBA57<-"VBA 4 covGivenProb 
////////////////////////////////

Function covGivenProb(xColumn As Range, yColumn As Range, prob As Range) As Variant
'by payn@geneseo.edu, modifed 9/25/2020
Dim n,n1,n2, i As Integer
Dim mean1, mean2, final, devX, devY As Double

n1 = xColumn.Rows.Count
n2 = xColumn.Columns.Count
n = Application.Max(n1, n2)

mean1 = 0
mean2 = 0
For i = 1 To n
      mean1 = mean1 + prob(i) * xColumn(i)
      mean2 = mean2 + prob(i) * yColumn(i)
Next
final = 0
For i = 1 To n
      devX = xColumn(i) - mean1
      devY = yColumn(i) - mean2
      final = final + prob(i) * devX * devY
2
Next
   covGivenProb = final
End Function

Function  covGivenProbHelp() As String
         covGivenProbHelp=\"usage: =covGivenProb(x_column, y_column, prob_column)\"
End Function

///////////////////////////////////////////
"
.videos<-function(i){
" i   Chapter: description                           # of videos
 ---  -----------------------------------            ----------
  1    1: Introduction                                   3   
  2    2: Time value of money (I)                        3 
  3    3: Stock & Bond valuation:Annuities/perpetuities  3
  4    4: Capital budgeting                              2
  5    5: Interest rate and yield curve                  3
  6    6: Uncertainty, default and risk                  3
  7    7: A first look at investments                    4
  8    8: Investor choice: Risk and Reward               2
  9    9: Benchmarked cost of capital                    4
 10   10: Capital Assett Pricing Model                   4
 11   11: Market imperfections                           2
 12   12: Perfect/Efficient Market, Behavioral finance   4
 13   14: Financial Statements/cash flows                5
 14   15  Ratio Analysis for Financial Statements        *

 Example #1:> .v    # get the above list
 Example #2:> .v(1) # see the first explanation

";.videos_(i)}

.maxI<-14   # maximum i 

.videos_<-function(.i){
   if(.i<=.maxI){
      .x<-paste('cat(.videoP',.i,')',sep='')
      .runText(.x)
   }else{
       cat("Invalid number: input value should between 1 ", "and ", .maxI, " \n")
   }
}

.v<-.videos

.videoP1<-"R installation and basics 
////////////////////////////////
 How to download and install R (6m39s) [for windows)
      https://www.videoP.com/watch?v=ZoPJGmpYJzw

 Programming in R - Getting Started - Installing R and RStudio on a Mac (5m59s)
      https://www.videoP.com/watch?v=Ywj6yNfc5nM

FNCE311, chapter 1: introduction 
   https://youtu.be/jHkkmbVEpYQ

////////////////////////////////
"

.videoP2<-"Write simple R functions 
////////////////////////////////
 FNCE311: chapter 2: Time value of money
     https://youtu.be/uOYT1WXdwX8

 Excel tutorial: Present value (PV) in excel 2010 (v115k,s10k,t4:1)
     https://www.videoP.com/watch?v=C3huNohGo0g

 TeachExcel,2009,Finance Basics 6 - Present Value Examples in Excel - How much something is worth today. (v70k,s79k,t7:49)
       https://www.videoP.com/watch?v=J4J5o-1JM24

////////////////////////////////
"

.videoP3<-"Stock & Bond valuation:Annuities/perpetuities
////////////////////////////////
 Codible,2014,Gordon Dividend Model on Excel,2014 (v7k,s3,t10:33)
     https://www.videoP.com/watch?v=RC2ZCKJ6lGk

 Greene,Jasonm 2012, Implementing the DDM in Excel (v42k,s4k,t4:23)
     https://www.videoP.com/watch?v=FBuUchkJT9A

////////////////////////////////
"

.videoP4<-"Capital budgeting
////////////////////////////////
 Coram,2011, Calculate IRR using Excel
     (v545k,s4k,t1:24)
     https://www.videoP.com/watch?v=Ug74NbL81CE

 Mursau, Allen, 2012, Internal Rate Of Return (Using Excel IRR Function)
    (v10l,s10k,t5:16)
     https://www.videoP.com/watch?v=tabGWMpNxxk

////////////////////////////////
"

.videoP5<-"Interest rate and yield curve 
////////////////////////////////

 Wall Street Survisor, 2013, Interest Rates | by Wall Street Survivor
    (v193k,s58,t2:16)
    https://www.videoP.com/watch?v=GHHesANT6OM

 Wall Street Journal, 2015, How Interest Rates Are Set: The Fed's New Tools Explained
    (v213k,s1.5m,t3:34) 
    https://www.videoP.com/watch?v=Oz5hNemSdWc

 Moy, Ronald, 2012,Term Structure of Interest Rates
    (37k,s10k,t9:16) 
    https://www.videoP.com/watch?v=Hl5zOAxBoDw

////////////////////////////////
"

.videoP6<-"Uncertainty, default and risk   
////////////////////////////////
 Moy,Ronald, 2013, Utility and Risk Preferences Part 1 - Utility Function
   (v186k,s10k,t8:54)
   https://www.videoP.com/watch?v=tCreeXzCNRc

 Business Tutorials, 2015,What is Risk Aversion 
   (v9k,s19k,t1:35)
   https://www.videoP.com/watch?v=xlrmxoOwIU4

 Moy, Ronald, 2013, Risk Aversion 
   (v45k,s10k,t10:28)
   https://www.videoP.com/watch?v=1kU4pvdIdT4

////////////////////////////////
"

.videoP7<-"A first look at investments
////////////////////////////////
 MoneyWeek, 2012, What is beta?
    (v185k,s196k,t11:46)
    https://www.videoP.com/watch?v=etlv7qTQUSY

 Sasha Evdakov: Tradersfly, 2016, What is \"Beta\" [Stock Market Terms] + How to Use it for Trading Decisions
    (v48,s126k,t7:26)
    https://www.videoP.com/watch?v=jvk-Lkwd6S4

 Lambert, Ben, 2013, Covariance and correlation
    (v315k,s0,t5:55)
    https://www.videoP.com/watch?v=KDw3hC2YNFc
  
  Khan Academy, 2010, Covariance and the regression line
    (v327,s4.9m,t17:07)
    https://www.videoP.com/watch?v=ualmyZiPs9w

////////////////////////////////
"
.videoP8<-"Investor choice: Risk and Reward
////////////////////////////////
 Evdakov,Sasha: Tradersfly,What is \"Beta\" [Stock Market Terms] + How to Use it for 
    Trading Decisions
    (v48k,s126k,t7:26)
    https://www.videoP.com/watch?v=jvk-Lkwd6S4&t=1s

 MondyWeek, 2012, MoneyWeek,  What is Beta? - MoneyWeek Investment Tutorials
    (v185k,s197k,t11:46)
    https://www.videoP.com/watch?v=etlv7qTQUSY&t=1s

////////////////////////////////
"

.videoP9<-"Benchmarked cost of capital
////////////////////////////////
  Dragonfly Statistics,2013, Introduction to Statistics : Geometric Mean
     (v81k,s7.7k,t3:02)
     https://www.videoP.com/watch?v=PKWVAIP17pw

  I Hate Math Group, Inc, 2013, How to find the Expected Return and Risk
     (v226k,s19k,t6:52)
     https://www.videoP.com/watch?v=h7Fqk529BP0

  patrickJMT,2011,The Geometric Mean
    (v343k,s1m,t3:34)
     https://www.videoP.com/watch?v=_UdGUULKN-E

  Spoon Feed Me,2014, Expected Return and Standard Deviation | Portfolio Management
   (v91k,s3.4k,t11:19)
     https://www.videoP.com/watch?v=lvOYpTTORQs

////////////////////////////////
"

.videoP10<-"Capital Assett Pricing Model
////////////////////////////////
 Calculating stock beta using Excel (4m28s)
       https://www.videoP.com/watch?v=zlClflcSrM8
 
 What is Beta? - MoneyWeek Investment Tutorials (5m29s)
       https://www.videoP.com/watch?v=etlv7qTQUSY

 Beta Calculation on Excel (9m48s)
       https://www.videoP.com/watch?v=7LiK-qbmPsw

 How to Calculate Beta with Excel, Calculation of Beta (18m43s)
       https://www.videoP.com/watch?v=LRyFn_T94IU

////////////////////////////////
"

.videoP11<-"Market imperfections
////////////////////////////////
 Now This World, 2012, What Is Insider Trading And Why Is It Illegal?
    (v179k,s2m,t3:2)
    https://www.videoP.com/watch?v=2BtawLeS5fM
 
 Hirsch, Paddy, 2014, Insider trading, explained
    (v35k,s14k,t3:35)
    https://www.videoP.com/watch?v=2nEH8zRSyAM

////////////////////////////////
"

.videoP12<-"Perfect/Efficient Market, Behavioral finance
////////////////////////////////
 Duomo Initiative-Trdaing & Investing, 2019, Are Markets Efficient? (Discussing the Efficient Market Hypothesis)
   (v3k,s91k,t13:32)
   https://www.videoP.com/watch?v=xG8FY1TAj8s

 Chegg, 2016, Efficient Markets Hypothesis (EMH) | Finance | Chegg Tutors
   (v43k,s16k,t8:46)
   https://www.videoP.com/watch?v=iR7agdiPLoQ&t=89s

 Investor Trading Academy, 2016, What is The Efficient Market Hypothesis - EMH?
   (v21k,s50k,t1:57)
   https://www.videoP.com/watch?v=e-BoCacmkM8

 MBAsullshitDotCom,2011, Efficient Market Hypothesis in 2 Easy Steps: What is Efficient Market Hypothesis Lecture EMH
    (v173k,s116k,t11:53)
    https://www.videoP.com/watch?v=h5JDftgykcg&t=8s

////////////////////////////////
"


.videoP13<-"Financial Statements/cash flows
////////////////////////////////
  Edspira, 2013, The Income Statement, defined and explained
    (v84k,s106k,t5:5)
    https://www.videoP.com/watch?v=-__bUSEls5Y

  Khan Academy, 2012,Introduction to Income Statements 
    (v706,v2.9m,t15:26)
    https://www.videoP.com/watch?v=Z7C4cz2HkeY

  Khan Academy, 2012,Introduction to Balance Sheets 
    (v751k,v2.9m,t9:53)
    https://www.videoP.com/watch?v=mxsYHiDVNlk

  Plain Bagel, Plain, 2019, Cash flows
    (v24k,s38k,t10:24)
    https://www.videoP.com/watch?v=hefAHWvrFDQ

  Hodder,Hamish, 2019, How to Read an Income Statement | Financial Statement Analysis (1/3)
    (v3k,s6.7k,t16:0)
    https://www.videoP.com/watch?v=3wsT0yHeKfk

////////////////////////////////
"

.videoP14<-"Ratio analysis 
////////////////////////////////
add soon

////////////////////////////////
"

.videoP17<-"Capital structure in a perfect world
////////////////////////////////
 Marketplace APM, 2009, Capital structure explained
   (v143k,s62k,t6:42)
    https://www.videoP.com/watch?v=6uB1eWJz9jI

 Openmichigan,2009, Capital structure
    (v64k,s25k,t43:32)
     https://www.videoP.com/watch?v=s5QrYrv7bWY
 
  Khan Academy, 2011, Basic capital structure differences
     (v144k,s4.9m,t4:00)
     https://www.videoP.com/watch?v=YEZMReBbkP0

////////////////////////////////
"


.videoP13333<-"Capital budgeting Application
////////////////////////////////
 I Hate Math Group, Inc,2013, How to find the Expected Return and Risk
   (v226k,s18k,t6:52)
   https://www.videoP.com/watch?v=h7Fqk529BP0&t=1s

 Learnto invest,2018,Hedging a Stock Portfolio - Hedging Strategies for a Market Crash
   (v3k,s25k,t18:12)
   https://www.videoP.com/watch?v=Wj5Q3GxGiG8

 Tastytrade,2016,Hedging Positions | Options Trading Concepts
   (v63k,s129kt13:52)
   https://www.videoP.com/watch?v=1iYQ0XOLHNU

////////////////////////////////
"



.virtualLab<-function(i){

"Objective: introduction to Geneseo Virtual Computer Lab

  i    Description 
 --   --------------------
  1   What is a virtual computer lab?
  2   Procedure to connect with Geneseo virtual lab
  3   One line
  4   Link for a more detailed online help 
  5   Transferring files between your machine and the virtual lab
  6   Launch R from the virtual lab
  7   Launch Python from the virtual lab
  8   Generate an R icon on your desktop 
  9   Generate an Spyder (Python) icon on your desktop 

      Note: short-cut .vl (lowercase letter L)
                   or .v1 (number 1)

";.virtualLab_(i)}

.vl<-.virtualLab   # letter L
.v1<-.virtualLab   # number 1 

.nVirtualLab<-9

.virtualLab_<-function(.i){

   if(.i<=.nVirtualLab){
      .x<-paste0('cat(.vP',.i,')')
      .runText(.x)

   }else{
       cat("Invalid number: input value should be between 1 ", "and ", .nVirtualLab, " \n")

   }
}

.vP1<-"Geneseo Virtual Computer Lab
////////////////////////////////////////////////////////////

 The Geneseo Virtual Computer Lab is available to anyone with a Geneseo account. 
    The Virtual Lab is a cloud-based Windows computer lab that provides users 
    remote access to hardware and software that they would otherwise have to 
    install themselves on their own systems, or visit a computer lab to use. 
 
 Visit go.geneseo.edu/virtualLab for instructions on accessing the Virtual
     Lab and details about the available software. If you have questions or
     feedback about the Virtual Lab, Ask CIT. Contact the HelpDesk by calling 
     (585) 245-5588 or visiting our online service desk.

////////////////////////////////////////////////////////////
"


.vP2<-"Procedure of connecting with Geneseo Virtual Computer Lab
////////////////////////////////////////////////////////////

  Step 1: http://go.geneseo.edu/publicvirtuallab

  Step 2: Click 'Public lab' under VirtualDesktops 

  Step 3: Click 'Allow' 

  Step 4: login username and password

  Step 5: Click R icon on your desktop

////////////////////////////////////////////////////////////
"

.vP3<-"one line website 
////////////////////////////////////////////////////////////

    http://go.geneseo.edu/publicvirtuallab

////////////////////////////////////////////////////////////
"

.vP4<-"Link for a more detailed online help 
////////////////////////////////////////////////////////////

  Accessing the Geneseo Virtual Lab
     https://wiki.geneseo.edu/display/cit/Accessing+the+Geneseo+Virtual+Lab

////////////////////////////////////////////////////////////
"

.vP5<-"Transferring files between your machine and virtual lab
////////////////////////////////////////////////////////////
Just image that the virtual lab is a remote  website. 
   We 'upload'  a data set (file) to  that  website. 
   we 'download' a data set (file) from that website. 

1) Upload or copy our data/files to the virtual machine 
        Click on [small up arrow on the top-right menu bar]
                     --> Choose your file 

        Location of your file
                     --> Remote Desktop Virtual Drive on RDWebClient 
                     --> Uploads [directory]

2) Download a data set/file to your computer from the virtual machine
        Copy your data set or file 
                     --> Go to 'Remote Desktop Virtual Drive on RDWebClient'
                     --> Downloads [directory] 
                     --> [paste it there]

        Location of the data on your machine
                     --> [the same location when downloading a remote file
                         i.e., User/userName/Downloads

////////////////////////////////////////////////////////////
"

.vP6<-"Launch R from the virtual lab
////////////////////////////////////////////////////////////
1) If the R icon is on the desktop, just click on it. 

2) Click on the window icon
      --> [you will see a list]
      --> R
      --> [Click on one of the entries ]

////////////////////////////////////////////////////////////
"

.vP7<-"Launch Python from the virtual lab
////////////////////////////////////////////////////////////
1) If the Spyder icon is on the desktop, just click on it. 

2) Click on the window icon
      --> [you will see a list]
      --> Anacomda3(64-bit)
      --> Click o 'Spyder (Anaconda3)'

////////////////////////////////////////////////////////////
"

.vP8<-"Generate an R icon on your desktop 
////////////////////////////////////////////////////////////
How to generate R icon on your desktop?

      Click on the window icon

      --> [you will see a list]

      --> R

      --> [right click on one of the entries ]

      --> Choose 'Open file location'

      --> [Right click the R]

      --> [Go to desktop and paste it there]

////////////////////////////////////////////////////////////
"

.vP9<-"Generate an Spyder (Python) icon on your desktop 
////////////////////////////////////////////////////////////
How to generate Spyder icon on your desktop?

      Click on the window icon

      --> Anacomda3(64-bit)

      --> [right click on Spyder(Anaconda3)]

      --> Choose 'Open file location'

      --> [Right click the file]

      --> [Go to desktop and paste it there]

////////////////////////////////////////////////////////////
"






.watchVideo<-function(i){
"Videos for various courses
 i   Description   [ * watched already ]
---  ---------------------------------
  1*  R installation [for windows]   (6m39s,2010)       https://www.youtube.com/watch?v=ZoPJGmpYJzw
  2*  R installation [on a Mac]      (5m59s,2014)       https://www.youtube.com/watch?v=Ywj6yNfc5nM
  3   Strong Dollar Index            (3m:42s, 1/7/2022) http://datayyy.com/webs/strongDollarIndex.html
  4   Bond yields                    (5m:16s,1/25/2022) http://datayyy.com/webs/bondYield.html
  5   Stocks vs. Fixed Income        (1m:1s,1/11/2022)  http://datayyy.com/webs/stockVSbond.html
  6   Biden economy-past,yet 2 come  (5m:24s,1/23/2022) http://datayyy.com/webs/biden.html
  7   S&P Global ESG score                              http://datayyy.com/webs/esg.html
  8   Financial Woes for Nobel       (t3:45,2012)       http://datayyy.com/webs/novwl.html
  9   How Does SWIFT Work?           (t2:17,2018)       https://www.youtube.com/watch?v=uvZRZ8t6utQ
 10   What is GDP?                   (t4:10,2018)       https://www.youtube.com/watch?v=iLom1WlqwS0
 11   Fed Chair Powell 'has to walk  (t7:33,1/27/2022)  http://datayyy.com/webs/gdp69.html
 12   Powell                         (t1:01,1/26/2022)  http://datayyy.com/videos/powell26jan.mp4
 13   The Gold Standard, Explained   (t4:21,2013)       https://www.youtube.com/watch?v=LdyHso5iSZI
 14   The Fed Explains Monetary Policy (t4:38,2016)     https://www.youtube.com/watch?v=wOfQPn9Jwpo
 15   Monetary/Fiscal Policy Explained (t6:06,2021)     https://www.youtube.com/watch?v=m9gRqxK0FKE
 16   What Is the Federal Funds Rate? (t2:05,2018)      https://www.youtube.com/watch?v=C31c1sF9iys
 17   Real Effective Exchange Rate    (t1:28)           https://www.investopedia.com/terms/r/reer.asp
 18   Swift                           (t3:22)           http://datayyy.com/webs/russiaSWIFT.html         
 19   Brent oil breaks $110 a barrel  (t0:57)           https://www.youtube.com/watch?v=a5ZheSbCNUw
 20   Oil Futures Explained           (t7:52)           https://www.youtube.com/watch?v=Pqj5mgIXBr4
 21   Russian ruble drops to record   (t1:52 with ad)   https://www.youtube.com/watch?v=l_iYPwAaNDw
 22   low after sanctions,2/28/2022 (t1:52)             http://datayyy.com/if/ruble28feb2022.mp4
 23   Sanctions hit Russia          (t3:37,3/5/2022)    https://www.youtube.com/watch?v=g_-vfS8z4NI
 24   How the Federal Reserve Raises (t5:14,3/15/2022)  http://datayyy.com/web/rate3mar2022.html 
 25      Interest Rates                                 http://datayyy.com/videos/rate15mar2022.mp4    
 26  What is stagflation? Why economists                http://datayyy.com/webs/stagflation.html
 27  Big mac index                  (t2:44,2020)        https://www.youtube.com/watch?v=b71uzrr8hUs
 28  Big mac index (2)              (t4:30,2016)        https://www.youtube.com/watch?v=5XdYbmova_s
 29  VaR Explained in 5 Minutes     (t5:08,2021)        https://www.youtube.com/watch?v=2SMkbMDypXI

";.zwatchVideo(i)}

#  30  How to Calculate VaR in Excel  (t3:11,2019)        https://www.youtube.com/watch?v=WJWlHJuEUss

.nWatchVideo<-29

.wv<<-.watchVideo
.v2<<-.watchVideo

.watchVideos<<-.watchVideo

.zwatchVideo<-function(.i){
   if(.i<=.nWatchVideo){
      .x<-paste0('.svP',.i)
      browseURL(.runText(.x))
   }else{
     cat("Invalid number: input value should between 1 ", "and ", .nShowVideo, " \n")
   }
}


.svP1<-"https://www.youtube.com/watch?v=ZoPJGmpYJzw"
.svP2<-"https://www.youtube.com/watch?v=Ywj6yNfc5nM"

.svP3<-"http://datayyy.com/webs/strongDollarIndex.html"
.svP4<-"http://datayyy.com/webs/bondYield.html"
.svP5<-"https://www.barrons.com/video/stocks-vs-fixed-income/9EBCADCF-2169-4B6A-96A5-2A0007224495.html"
.svP6<-"https://www.wsj.com/video/series/journal-editorial-report/wsj-opinion-the-biden-economypast-and-yet-to-come/97EBFD1A-CB60-4A74-A161-D0545919D3DB"
.svP7<-"https://www.spglobal.com/marketintelligence/en/campaigns/i-need-esg-insight"
.svP8<-"https://www.wsj.com/video/financial-woes-for-nobel-as-prize-money-is-reduced/470D8968-16ED-4573-AEF8-D24EA4ADD875.html"
.svP9<-"https://www.youtube.com/watch?v=uvZRZ8t6utQ"
.svP10<-"https://www.youtube.com/watch?v=iLom1WlqwS0"
.svP11<-"https://finance.yahoo.com/video/fed-chair-powell-walk-very-183630240.html?fr=yhssrp_catchall"
.svP12<-"http://datayyy.com/videos/powell26jan.mp4"
.svP13<-"https://www.youtube.com/watch?v=LdyHso5iSZI"
.svP14<-"https://www.youtube.com/watch?v=wOfQPn9Jwpo"
.svP15<-"https://www.youtube.com/watch?v=m9gRqxK0FKE"

.svP16<-"https://www.youtube.com/watch?v=C31c1sF9iys"
.svP17<-"https://www.investopedia.com/terms/r/reer.asp"
.svP18<-"https://www.wsj.com/video/series/news-explainers/swift-sanctions-how-cutting-off-banks-pressures-russia/45E6FA72-C148-4771-B3A5-668E0929562C?mod=djem10point"
.svP19<-"https://www.youtube.com/watch?v=a5ZheSbCNUw"
.svP20<-"https://www.youtube.com/watch?v=Pqj5mgIXBr4"
.svP21<-"https://www.youtube.com/watch?v=l_iYPwAaNDw"
.svP22<-"http://datayyy.com/if/ruble28feb2022.mp4"

.svP23<-"https://www.youtube.com/watch?v=g_-vfS8z4NI"
.svP24<-"https://www.wsj.com/video/series/wsj-glossary/how-the-federal-reserve-raises-interest-rates/BF522D96-72FE-40A0-B599-8EE8CDF3799F"
.svP25<-"http://datayyy.com/videos/rate15mar2022.mp4"
.svP26<-"https://www.foxbusiness.com/economy/what-is-stagflation-why-economists-are-worrying-about-a-1970s-style-catastrophe"
.svP27<-"https://www.youtube.com/watch?v=b71uzrr8hUs"
.svP28<-"https://www.youtube.com/watch?v=5XdYbmova_s"

.svP29<-"https://www.youtube.com/watch?v=2SMkbMDypXI"
.svP30<-"https://www.youtube.com/watch?v=WJWlHJuEUss"

.zoom<-function(i){
"Objective: show a few things related to zoom meeting 
  i       : an integer 

  i    Description
  ---  ------------
  1    zoom link for office hours  
  2    help students debug their code when teaching

";.zoom_(i)}

.nZoom<-3
.z<<-.zoom

.zoom_<-function(i){
   if(i<=.nZoom){
      x<-paste0('cat(.zoomP',i,')')
      .runText(x)
   }else{
      cat("Invalid number \n")
   }
}

.zoomP1<-"Zoom link for the office hours 
///////////////////////////
Topic: DANL100, FNCE311 and FNCE316 
Time: Jan 26, 2022 10:00 AM Eastern Time (US and Canada)
        Every week on Mon, Wed, Fri, until May 18, 2022, 49 occurrence(s)
        Jan 26, 2022 10:00 AM,       Jan 28, 2022 10:00 AM,       Jan 31, 2022 10:00 AM
        Feb 2, 2022 10:00 AM,        Feb 4, 2022 10:00 AM,        Feb 7, 2022 10:00 AM
        Feb 9, 2022 10:00 AM,        Feb 11, 2022 10:00 AM,       Feb 14, 2022 10:00 AM
        Feb 16, 2022 10:00 AM,       Feb 18, 2022 10:00 AM,       Feb 21, 2022 10:00 AM
        Feb 23, 2022 10:00 AM,       Feb 25, 2022 10:00 AM,       Feb 28, 2022 10:00 AM
        Mar 2, 2022 10:00 AM,        Mar 4, 2022 10:00 AM,        Mar 7, 2022 10:00 AM
        Mar 9, 2022 10:00 AM,        Mar 11, 2022 10:00 AM,       Mar 14, 2022 10:00 AM
        Mar 16, 2022 10:00 AM,       Mar 18, 2022 10:00 AM,       Mar 21, 2022 10:00 AM
        Mar 23, 2022 10:00 AM,       Mar 25, 2022 10:00 AM,       Mar 28, 2022 10:00 AM
        Mar 30, 2022 10:00 AM,       Apr 1, 2022 10:00 AM,        Apr 4, 2022 10:00 AM
        Apr 6, 2022 10:00 AM,        Apr 8, 2022 10:00 AM,        Apr 11, 2022 10:00 AM
        Apr 13, 2022 10:00 AM,       Apr 15, 2022 10:00 AM,       Apr 18, 2022 10:00 AM
        Apr 20, 2022 10:00 AM,       Apr 22, 2022 10:00 AM,       Apr 25, 2022 10:00 AM
        Apr 27, 2022 10:00 AM,       Apr 29, 2022 10:00 AM,       May 2, 2022 10:00 AM
        May 4, 2022 10:00 AM,        May 6, 2022 10:00 AM,        May 9, 2022 10:00 AM
        May 11, 2022 10:00 AM,       May 13, 2022 10:00 AM,       May 16, 2022 10:00 AM
        May 18, 2022 10:00 AM

Join Zoom Meeting
https://geneseo.zoom.us/j/82259544407?pwd=eWNnQWl5ZUpqWVd5dzlGNTJWcHo2dz09

Meeting ID: 822 5954 4407
Passcode: aaa
   Alternatively, http://datayyy.com/doc_txt/officeHours2022sring.txt 
///////////////////////////
"

.zoomP2<-"help students debug their code when teaching
///////////////////////////
 This is new method to help students to debug their programs 
    during lectures. If you have an issue, do the following steps. 
  
  Step 1: Search for the zoom meeting link by issuing the following code:
           .sw('zoom')
           Assume that we have the following results
             ID           NAME                                                                    WEBSITE
           1  9 zoom lecture   https://geneseo.zoom.us/j/88404268306?pwd=VE8vc3BMMThFSU1CNEoxRzJ4K05wUT09
           2 10 zoom lecture 2 http://datayyy.com/zoom.html                                              
           3 11 zoom lecture 3 http://datayyy.com/rpy/zoomLecture.txt    

          To launch the zoom meeting, just enter the ID
            .sw(9)

  Step 2: Mute your microphone
  Step 3: Share your screen
  Step 4: Raise your hand and ask me to check your code

  Step 5: After done, unshare your screen

///////////////////////////
"

.zoomP3<-"
///////////////////////////
///////////////////////////
"


.zoomP4<-"
///////////////////////////
///////////////////////////
"

.zoomP5<-"
///////////////////////////
///////////////////////////
"
.zoomP6<-"
///////////////////////////
///////////////////////////
"

.zoomP7<-"
///////////////////////////
///////////////////////////
"
.zoomP8<-"
///////////////////////////
///////////////////////////
"

.zoomP9<-"
///////////////////////////
///////////////////////////
"



